
<!-- saved from url=(0049)http://jasondoucette.com/books/pw5/pw5errata.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Programming Windows, 5th Edition, Errata Addendum - Jason Doucette</title>
<meta name="description" content="Programming Windows, 5th 
	Edition, The definitive guide to the Win32 API, by Charles Petzold. FAQ / Errata 
	by Jason Doucette. Contains source code bug list, source code comment 
	corrections, typos in the text, misleading text corrections, additional 
	information for better understanding, and updated URLs.">
<meta name="keywords" content="Programming, Windows, 5th, Edition, FAQ, Errata Charles, Petzold, 
	win32, api, definitive, guide, fifth, erratum, source, code, bug, list, typos, 
	corrections, misleading, Jason, Allen, Doucette, Resume, objective, 
	Curriculum Vitae, CV, Computer, Graphics, Video, Games, Real, Time, Artificial, 
	Intelligence, Physics, Simulation, Acadia, University, Transcript, Marks, 
	Courses, Downloads, Pictures, Samples, education, college, geographic, sciences, 
	cogs, yarmouth, high, school, canadian, mathematics, competition, american, 
	science, 441, 541, highest, standing, euclid, ahsme, amc12, fermat, aime, 
	cayley, pascal, achievement, test, work, experience, employed, extracurricular, 
	activities, world, record, hobbies, skills, references">
<style>
	a:link    { color: #0000ff; }
	a:visited { color: #800080; }
	a:hover   { color: #ff0000; }
	body
	{
	scrollbar-arrow-color: 060182;
	scrollbar-track-color: B6B5CC;
	scrollbar-face-color: D1D0DF;
	scrollbar-highlight-color: E9E8F0;
	scrollbar-3dlight-color: ffffff;
	scrollbar-shadow-color: B2B1C4;
	scrollbar-darkshadow-color: 89879D;
        font-family: Georgia, Verdana, Arial;
	}
</style></head>




<body text="000000" link="0000ff" alink="FF0000" vlink="000080" bgcolor="C2C2D4" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/backgr1.gif" leftmargin="0" rightmargin="0" topmargin="0" bottommargin="0" frameborder="0" marginwidth="0" marginheight="0">
	
<font face="arial">

<center>

<table width="100%" bgcolor="336699" cellspacing="2" cellpadding="0"><tbody><tr><td bgcolor="E5E5E5" align="center">

<table width="100%" cellspacing="0" cellpadding="3">
<tbody><tr>
	<td align="left">

		<table width="100%" cellspacing="0" cellpadding="0"><tbody><tr>
			<td width="66%" valign="top">
				<font face="verdana" size="+2">
				<b><a href="http://jasondoucette.com/">Jason Doucette</a></b> /
				 <a href="http://xona.com/"><b>Xona Games</b></a>
				</font>
			</td>
			<td width="33%" align="right" valign="top">
				<font face="verdana">
				<form method="GET" action="http://google.com/search" target="_top">
				<input type="text" name="q" size="27" maxlength="255" value="">&nbsp;<input type="submit" value="Search">
				<input type="hidden" name="sitesearch" value="jasondoucette.com">
				</form>
				</font>
			</td>
		</tr></tbody></table>

		<table cellpadding="0" cellspacing="0">
		<tbody><tr>
			<td>
				<font face="verdana" size="-1">

				<b>hometown –</b> Yarmouth, NS, Canada<br>
				<b>residence –</b> Seattle, WA, USA <br>
				<b>university –</b> <a href="http://www.acadiau.ca/">Acadia University</a><br>
				<b>college –</b> <a href="http://www.cogs.ns.ca/">COGS</a><br>
				<b>contact –</b>

				<script type="text/javascript">
				<!-- // Xona.com
				eval(unescape('%50K%49CzsBm%46%20%3D%20%22%26%23106%3B%61so%26%2311%30%3B%22%3B'));
				eval(unescape('%52T%4AY%79E%49G%74%76q%6A%20%3D%20%22%26%23120%3Bo%26%23110%3Ba%22%3B'));
				eval(unescape('c%74%79%4Bo%66NF%20%3D%20%22%26%2399%3B%26%231%311%3B%26%23%3109%3B%22%3B'));
				eval(unescape('%47a%53TN%52J%45%63%20%3D%20PKIC%7As%42mF%20%2B%20%22%26%2364%3B%22%20%2B%20%52%54JYyE%49Gtvqj%20%2B%20%22%26%23%346%3B%22%20%2B%20%63ty%4Bof%4EF%3B'));
				eval(unescape('%6CO%4Dk%46BX%4FWV%71YU%20%3D%20%22%22%3B'));
				eval(unescape('XX%59T%44%42If%20%3D%20doc%75%6Dent%3B'));
				eval(unescape('X%58%59T%44%42If%2E%77rit%65%28%27%3Ca%20%27%20%2B%20lOMkF%42%58O%57VqY%55%20%2B%20%27%20%27%29%3B'));
				eval(unescape('%58X%59T%44BI%66%2Ewr%69%74%65%28%27hr%65f%3D%22mail%27%20%2B%20%27to%26%2358%3B%27%20%2B%20%50%4BICz%73%42mF%20%2B%20%27%26%236%34%3B%27%20%2B%20R%54JYy%45I%47t%76%71%6A%20%2B%20%27%26%234%36%3B%27%20%2B%20c%74yKofNF%20%2B%20%27%22%3E%27%29%3B'));
				eval(unescape('%58X%59T%44BI%66%2Ewrite%28Ga%53T%4ERJEc%29%3B'));
				eval(unescape('X%58Y%54D%42%49%66%2E%77ri%74e%28%27%3C%2F%61%3E%27%29%3B'));
				// -->
				</script><a href="mailto:jason@xona.com">jason@xona.com</a><noscript>[<a href='http://google.com/search?q=enable+javascript'>Enable JavaScript</a> for email address]</noscript>

				(<a href="http://jasondoucette.com/contact.html">other methods</a>)<br>
				
				</font>
			</td>
			
			<td>&nbsp;&nbsp;&nbsp;</td>
			
			<td valign="top">
				<font face="verdana" size="-1">

				<b>social networks</b><br>

				<a href="http://facebook.com/jdoucette"><img border="0" alt="" src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/facebook.png" width="32" height="32"></a>
				<a href="http://twitter.com/JasonADoucette"><img border="0" alt="" src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/twitter.png" width="32" height="32"></a>
				<a href="http://youtube.com/JDoucette"><img border="0" alt="" src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/youtube.png" width="32" height="32"></a>
				<a href="https://www.linkedin.com/in/jasonadoucette"><img border="0" alt="" src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/linkedin.png" width="32" height="32"></a>
				<a href="https://plus.google.com/+JasonDoucetteX"><img border="0" alt="" src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/googleplus.png" width="32" height="32"></a>
				<a href="http://stackoverflow.com/users/135218/jason-doucette"><img border="0" alt="" src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/stackoverflow.png" width="32" height="32"></a>
				</font>
			</td>
			
			<td>&nbsp;&nbsp;&nbsp;</td>
			
			<td valign="top" align="left">
				<font face="verdana" size="-1">
				<b>tech –</b>
				<a target="_top" href="http://jasondoucette.com/games.html">Project/Games</a> ·
				<a target="_top" href="http://jasondoucette.com/graphics.html">Graphics Tech</a> ·
				<a target="_top" href="http://jasondoucette.com/ai.html">Artificial Intelligence</a> ·
				<a target="_top" href="http://jasondoucette.com/worldrecords.html">World Records/Number Theory</a>

				<br>

				<b>personal –</b>
				<a target="_top" href="http://jasondoucette.com/">Home</a> ·
				<a target="_top" href="http://jasondoucette.com/resume.html">Resume</a> ·
				<a target="_top" href="http://jasondoucette.com/transcript.html">Transcripts</a> ·
				<a target="_top" href="http://jasondoucette.com/contact.html">Contact</a>

				<br>

				<b>twin –</b>
				<a href="http://matthewdoucette.com/">Matthew Doucette</a> of <a href="http://xona.com/">Xona Games</a>

				<br>

				<b>old –</b>
				<a target="_top" href="http://jasondoucette.com/books/pw5/pw5errata.html">Petzold's Programming Windows <small>5th ed</small> Errata</a> ·
				<a href="http://xona.com/domainhacks/suggest">Domain Hacks</a> ·
				<a target="_top" href="http://jasondoucette.com/wallpapers.html">Wallpapers</a>
				
				</font>
			</td>
		</tr>
		</tbody></table>

	</td>
</tr>
</tbody></table>

<!-- TODO: remove the following, as it's required from owner, but isn't contained in this file. -->
</td>
</tr>
</tbody></table>

<br>
<br>

<table cellpadding="10">
<tbody><tr>
<td align="center">
<font size="-2">
<a href="http://www.amazon.com/exec/obidos/ASIN/157231995X/stephenhawkin-20"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/pw5cover.jpg" width="125" height="170" alt="Click to purchase Programming Windows, Fifth Edition by Charles Petzold"><br>
Click to Purchase Book<br>
</a>
</font>
</td>
<td align="center">
<b><font size="+3"><i>Programming Windows</i>, Fifth Edition</font><br>
<font size="-1">by <a href="http://www.charlespetzold.com/pw5/">Charles Petzold</a> - The definitive guide to the Win32<sup>®</sup> API</font></b><br>
<font size="+3"><b>Errata Addendum</b></font><br>
<br>
<font size="-1">(<i>Contains
additional errata from
<a href="http://www.charlespetzold.com/pw5/pw5faq.html">Charles Petzold's</a>
and
<a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin's</a> errata lists,<br>
with my own detailed explanations for completeness and to ensure understandability.</i>)<br>
<b>Last Update: Sunday, July 23<sup>rd</sup>, 2006<br></b></font>
</td>
</tr>
</tbody></table>

<br>

<a href="http://jasondoucette.com/index.html"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/back.gif" width="19" height="18" border="0"> Back to Jason Doucette's Resume Page <img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/back.gif" width="19" height="18" border="0"></a><br>

<script src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/urchin.js.download" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-767921-3";
urchinTracker();
</script>


<br>

<table border="1" cellspacing="0" cellpadding="5" bgcolor="e0e0e0">
<tbody><tr>
<th colspan="2" valign="top">
Quick Links:
</th>
</tr>
<tr>
<th valign="top">
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#section-1">Pre Section</a>
</th>
<th valign="top">
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#section0">All Sections</a>
</th>
</tr>
<tr>
<td>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter-1">About Author</a>
</td>
<td>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter0">All Chapters</a>
</td>
</tr>
<tr>
<th>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#section1">Section I - The Basics</a><br>
</th>
<th>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#section2">Section II - More Graphics</a><br>
</th>
</tr>
<tr>
<td valign="top" rowspan="3">
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter1">Chapter 1 - Getting Started</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter2">Chapter 2 - An Introduction to Unicode</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter3">Chapter 3 - Windows and Messages</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter4">Chapter 4 - An Exercise in Text Output</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter5">Chapter 5 - Basic Drawing</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter6">Chapter 6 - The Keyboard</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter7">Chapter 7 - The Mouse</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter8">Chapter 8 - The Timer</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter9">Chapter 9 - Child Window Controls</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter10">Chapter 10 - Menus and Other Resources</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter11">Chapter 11 - Dialog Boxes</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter12">Chapter 12 - The Clipboard</a><br>
</td>
<td valign="top">
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter13">Chapter 13 - Using the Printer</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter14">Chapter 14 - Bitmaps and Bitblts</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter15">Chapter 15 - The Device-Independent Bitmap</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter16">Chapter 16 - The Palette Manager</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter17">Chapter 17 - Text and Fonts</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter18">Chapter 18 - Metafiles</a><br>
</td>
</tr>
<tr>
<th>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#section3">Section III - Advanced Topics</a><br>
</th>
</tr>
<tr>
<td valign="top">
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter19">Chapter 19 - The Multiple-Document Interface</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter20">Chapter 20 - Multitasking and Multithreading</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter21">Chapter 21 - Dynamic-Link Libraries</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter22">Chapter 22 - Sound and Music</a><br>
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#chapter23">Chapter 23 - A Taste of the Internet</a><br>
</td>
</tr>
</tbody></table>
</center>

<br>

<table border="0" cellpadding="5" cellspacing="0" bgcolor="545285">
<tbody><tr>
<td>

<table border="0" cellpadding="10" cellspacing="0" bgcolor="AAA9C3">
<tbody><tr>

<td valign="top" align="center">
<a name="section-1"><font size="+1"><b>Pre <br>Section</b></font></a>
</td>

<td>

	<table border="0" cellpadding="0" cellspacing="0">
	
	<tbody><tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter-1"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;About Author</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Incorrect URL</b><br>
<br>
On page xxiii, <i>Author's Note</i>, the first line states:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page xxiii, <i>Author's Note</i>
</th>
</tr>
<tr>
<td>
<i>Visit my web site <a href="http://www.cpetzold.com/">www.cpetzold.com</a>
for updated information regarding this book, including possible bug reports and new code listings.</i>
</td>
</tr>
</tbody></table>

<br>

The domain <i>cpetzold.com</i> does not load, anymore.
Please visit Charles Petzold's new domain at
<i><a href="http://www.charlespetzold.com/">www.charlespetzold.com</a></i>.
Also, the email address listed on the same page
is no longer valid.  Please visit his new domain for an up-to-date email address.
If you wish to write him concerning a problem with the book,
you may also like to review the web page you are viewing right now
to see if the problem has already been resolved.  If not,
you can contact me via the email address listed at the bottom
of this page.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="3" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/horiz.gif" height="12"></td>
	</tr>
	
	</tbody></table>

</td>

</tr>
<tr>

<td valign="top" align="center">
<a name="section0"><font size="+1"><b>All<br>Sections</b></font></a>
</td>

<td>

	<table border="0" cellpadding="0" cellspacing="0">
	
	<tbody><tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter0"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;All Chapters</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>	
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: GetMessage() not checked for errors</b><br>
<br>
This 'bug' regards the Message Loop in every program in the book.
I should point out that Charles Petzold states for the purposes of clarity,
he does <i>not</i> check a lot of functions for errors:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 57, Chapter 3, <i>A Window of One's Own</i>
</th>
</tr>
<tr>
<td>
<i>I do a minimum of error checking in the sample programs in this
book. This is not because I don't think error checking is a good idea, but
because it would distract from what the programs are supposed to
illustrate.</i>
</td>
</tr>
</tbody></table>

<br>

I have decided to write this in my Errata Addendum because I believe
most people are not aware that <i>GetMessage()</i> is one of those
functions that they should be testing for errors.
The Message Loop is important, as it is the core
of just about every Windows program created.<br>
<br>
The <i>Message Loop</i> is poorly documented in the MSDN that comes with MSVC++ 6.0.
For example, in
<i>/Platform SDK/Windows Programming Guidelines/Win32 Programming/A Generic Win32 Sample Application/The Entry Point Function/Entering the Message Loop</i>
it shows:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Various MSVC++ 6.0 MSDN Pages - Error
</th>
</tr>
<tr>
<td>
<pre>while( GetMessage( &amp;msg, NULL, 0, 0 ) ) {
   TranslateMessage( &amp;msg );
   DispatchMessage( &amp;msg );
}
</pre>
</td>
</tr>
</tbody></table>

<br>

It shows the same thing in 
<i>/Platform SDK/User Interface Services/Windowing/Messages and Message Queues/About Messages and Message Queues/Message Handling/Message Loop</i>,
as well as in
<i>/Platform SDK/User Interface Services/Windowing/Messages and Message Queues/Using Messages and Message Queues/Creating a Message Loop</i>.
These are all in contradiction to the MSVC++ 6.0 MSDN page for the <i>GetMessage()</i> function itself, which explains:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
MSVC++ 6.0 MSDN page for <i>GetMessage()</i>
</th>
</tr>
<tr>
<td>

<i>Note that the function return value can be nonzero, zero, or -1. Thus, you
should avoid code like this:</i><br>
<br>
<code>
while (GetMessage( lpMsg, hWnd, 0, 0)) ...<br>
</code>
<br>
<i>The possibility of a -1 return value means that such code can lead to fatal
application errors.</i>
</td>
</tr>
</tbody></table>

<br>

The fact that any nonzero number is equivalent to <i>true</i>,
means that when there is an
error, the loop will not quit, but will attempt to translate and dispatch
the message in <i>msg</i>, which probably still contains the last message
information (<i>it is undocumented what it actually contains</i>).<br>
<br>
A proper message loop is explained in the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/getmessage.asp">online MSDN page for <i>GetMessage()</i></a>:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/getmessage.asp">online MSDN page for <i>GetMessage()</i></a>
- Correction
</th>
</tr>
<tr>
<td>

<i>Because the return value can be nonzero, zero, or -1, avoid code like this:</i><br>
<br>
<code>
while (GetMessage( lpMsg, hWnd, 0, 0)) ...<br>
</code>
<br>
<i>The possibility of a -1 return value means that such code can lead to fatal
application errors. Instead, use code like this:</i><br>
<br>

<code>
<pre><b>BOOL bRet;</b>

while ( <b>(bRet =</b> GetMessage( &amp;msg, NULL, 0, 0 )<b>) != 0</b>)
{
    <b>if (bRet == -1)
    {
        // handle the error and possibly exit
    }
    else
    {</b>
        TranslateMessage(&amp;msg);
        DispatchMessage(&amp;msg);
    <b>}</b>
}
</pre>
</code>

</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: CreateWindow() not checked for errors</b><br>
<br>
This 'bug' regards the <i>CreateWindow()</i> call in every program in the book.
Again, I should point out that Charles Petzold states for the purposes of clarity,
he does <i>not</i> check a lot of functions for errors:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 57, Chapter 3, <i>A Window of One's Own</i>
</th>
</tr>
<tr>
<td>
<i>I do a minimum of error checking in the sample programs in this
book. This is not because I don't think error checking is a good idea, but
because it would distract from what the programs are supposed to
illustrate.</i>
</td>
</tr>
</tbody></table>

<br>

However, since the <i>CreateWindow()</i> call is so important,
each program would be better if it checked the
return value from <i>CreateWindow()</i> before using
it in the subsequent call to <i>ShowWindow()</i>
from within the <i>WinMain()</i> function.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Code Change Option</b><br>
<br>

All programs whose
<a href="http://msdn.microsoft.com/library/en-us/gdi/pantdraw_88ac.asp">WM_PAINT</a>
message handler
redraws the <i>entire</i> client area
(<i>that is, in <b>all</b> cases of repainting,
without using ROPs (raster operations)
that merge with the background</i>),
do not require a background brush.<br>
<br>
Windows automatically fills the client area
with the background brush selected when a window is resized.
It does so by sending a
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/icons/iconreference/iconmessages/wm_erasebkgnd.asp">WM_ERASEBKGND Notification</a>
to the window, and the default processing of this message,
via the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowprocedures/windowprocedurereference/windowprocedurefunctions/defwindowproc.asp">DefWindowProc() Function</a>,
is that the background is 'erased' by using the class background brush specified by the <i>hbrBackground</i> member
of the <i>WNDCLASS</i> structure.  If this is NULL, the background is not erased
(<i>although the application could process the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/icons/iconreference/iconmessages/wm_erasebkgnd.asp">WM_ERASEBKGND Notification</a>
and erase it manually</i>).<br>
<br>
Thus, for programs that are going to fill the client area
themselves in their
<a href="http://msdn.microsoft.com/library/en-us/gdi/pantdraw_88ac.asp">WM_PAINT</a>
handler, this will result in a slower application that flickers needlessly.
The flicker occurs because the application fills the client area completely
<i>immediately after</i> Windows has just finished filling it in with the background brush.<br>
<br>
To remove the background brush in any of these programs
in the text book, change this line in <i>WinMain()</i>:<br>
<br>
<code>
wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;<br>
</code>
<br>
to this line:<br>
<br>
<code>
wndclass.hbrBackground = NULL ;<br>
</code>
<br>
and the window will no longer flicker.<br>
<br>
The following programs are known to not require a background brush:<br>
<br>
<i>Chapter 14:</i><br>
BITBLT.C (<i>page 649</i>)<br>
STRETCH.C (<i>page 653</i>)<br>
<br>
<i>Chapter 16:</i><br>
GRAYS1.C (<i>page 823</i>)<br>
GRAYS2.C (<i>page 826</i>)<br>
GRAYS3.C (<i>page 833</i>)<br>
SYSPAL2.C (<i>page 843</i>)<br>
SYSPAL3.C (<i>page 847</i>)<br>
PALANIM.C (<i>page 852</i>) (<i>all programs that use it redraw their entire client area themselves</i>)<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Speeding Up Build Times</b><br>
<br>

As explained on the MSDN page
<a href="http://msdn.microsoft.com/library/en-us/vcce/htm/evc_guide10_4.asp">Speeding up the Build Process</a>,
you can define the macro WIN32_LEAN_AND_MEAN to
reduce the size of the Win32 header files by
excluding some of the less common APIs
(<i>Application Programming Interfaces</i>).
You can define the WIN32_LEAN_AND_MEAN macro like so at the top of your program:<br>
<br>
<code>
#define WIN32_LEAN_AND_MEAN<br>
</code>
<br>
Almost all of Charles Petzold's examples can have this macro to speed up build times.
If there are programs that report errors because they use certain functions that
require headers excluded by this macro, you can either not define the macro,
or define that specific header.  You can find out what particular headers are
required for these functions by looking at their MSDN pages.  If you have a local
copy of MSDN, place the cursor on the function name, and press F1 to load its MSDN page.<br>
<br>
For example, the <i>rand()</i> function becomes
unavailable when you define WIN32_LEAN_AND_MEAN.
Looking at
<a href="http://msdn.microsoft.com/library/en-us/vclib/html/_CRT_rand.asp">its MSDN page</a>,
you can see that it requires the <i>stdlib.h</i> header.  You can include this header
like so:<br>
<br>
<code>
#include &lt;stdlib.h&gt;<br>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Security Issues</b><br>
<br>
On page 36, Chapter 2, <i>Using printf in Windows</i>,
there is a table that displays a number of different
<a href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_printf.2c_.wprintf.asp"><i>printf()</i></a>
style functions.
One that is used very often in Charles Petzold's examples is the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/wsprintf.asp">wsprintf()</a>
function.
While his examples are just for demonstration purposes,
real world applications should avoid using functions in the list that are <i>not</i>
listed under 'Max-length Version'.
Writing formatted data to a string that does not ensure data will not
be written outside of a specified range can cause a
<a href="http://www.joelonsoftware.com/articles/fog0000000319.html">buffer overflow security problem</a>.
A security note posted within
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/wsprintf.asp">wsprintf()</a>'s
MSDN page states:<br>

<br>

<blockquote>
"<i><b>Security Alert:</b>
Using this function incorrectly can compromise the security of your application.
The string returned in lpOut is not guaranteed to be NULL-terminated.
Also, avoid the %s format -- it can lead to a buffer overrun.
If an access violation occurs it causes a denial of service against your application.
In the worse case, an attacker can inject executable code.</i>"
</blockquote>

You should always play it safe and use the 'Max-length Version' of the function you wish.
This ensures buffer overflows will never occur.<br>

<br>

When using the 'Max-length Version' functions,
please note that most, if not all, do not ensure NULL termination.
I have posted an errata
<a target="_top" href="http://jasondoucette.com/books/pw5/pw5errata.html#chap2page37">elsewhere in this list</a>
about the improper use of such a function
in the coding example on page 37, Chapter 2.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<a name="simulatebuttonpress"><b>Erratum 6: Simulating a Button Press Message</b></a><br>
<br>
There are several places in the book which has code
whose purpose is to emulate a button press.
To do such a thing, you need two pieces of information:<br>

<ol>
<li>a handle to the button's parent window.<br>

<br>

This is normally a dialog box,
whose handle is stored in a variable called <i>hdlg</i>,
which means 'handle to dialog'.
Some of the examples in the book create a dialog box
as the program's main window.  Since Charles Petzold
has been consistent in that the main window's handle is
stored in a variable called <i>hwnd</i>, some of these
examples have buttons whose parent's handle is <i>hwnd</i>.<br>

<br>

</li><li>the button's identifier.<br>

<br>

This is the identifier that you give the button when
you create it inside of a dialog using the resource editor.
For the default 'OK' and 'Cancel' buttons, they are
IDOK and IDCANCEL, respectively.  The examples in the book
use the notation IDC_NAME, where 'IDC' means 'ID of a control',
as explained on page 504, Chapter 11, <i>A More Complex Dialog Box</i>,
and 'NAME' is whatever you prefer to call your button.
These identifiers are defined in RESOURCE.H as a result of
their creation in the resource editor.
</li></ol>

Let us assume that we wish to emulate the pressing of a button
whose identifier is IDC_MYBUTTON, and whose parent has a window
handle stored in the variable <i>hdlg</i>. Charles Petzold's
method of creating this event is as follows:<br>
<br>

<code>
<pre>SendMessage(hdlg, WM_COMMAND, IDC_MYBUTTON, 0) ;
</pre>
</code>

He does so in the following locations in the book:<br>
<ul>
<li>Page 1012, Chapter 17, PICKFONT.C
</li><li>Page 1013, Chapter 17, PICKFONT.C
</li><li>Twice on page 1303, Chapter 22, RECORD1.C
</li><li>Three times on page 1317, Chapter 22, RECORD2.C
</li><li>Page 1318, Chapter 22, RECORD2.C
</li><li>Twice on page 1324, Chapter 22, RECORD3.C
</li><li>Twice on page 1412, Chapter 23, NETTIME.C
</li><li>Twice on page 1413, Chapter 23, NETTIME.C
</li></ul>
I should note that his code <i>works</i>, but it is not entirely proper.
It is not good code, as it obfuscates what is actually happening.
The process that this 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessage.asp">SendMessage()</a>
call is emulating is the following:<br>
<br>
A user clicks on the button and releases it.
The button handles these mouse messages in its own window procedure,
and responds by sending a message to its parent.  The parent, knowing the button has been clicked,
can respond appropriately.
The message it sends is a 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_command.asp">WM_COMMAND</a>
notification with three pieces of information passed in the
<i>wParam</i> and <i>lParam</i>
parameters.  The information is as follows:<br>
<ol>
<li>wParam: The high-order word specifies the notification code.
</li><li>wParam: The low-order word specifies the identifier of the button. 
</li><li>lParam: Handle to the button sending the message.
</li></ol>
The notification code of a button press is
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bn_clicked.asp">BN_CLICKED</a>,
as explained on page 365, Chapter 9, <i>The Child Talks to Its Parent</i>.
The identifier of the button, in this example, is IDC_MYBUTTON.
The handle to the button sending the message can be found using the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxfunctions/getdlgitem.asp">GetDlgItem()</a>
function.
It takes two parameters:
the handle to the dialog who is the button's parent,
and the identifier of the button.
Therefore, we would call it in the following manner:<br>

<code>
<pre>HWND hctrl = GetDlgItem(hdlg, IDC_MYBUTTON);
</pre>
</code>

One problem of passing three pieces of information
required by the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_command.asp">WM_COMMAND</a>
message,
is that we must combine two of these pieces of information into one,
for the <i>wParam</i> parameter.
We can use the predefined
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/makewparam.asp">MAKEWPARAM Macro</a>
for this.
It takes two words as its parameters and combines them into a WPARAM type.
We would use the macro as follows:<br>

<code>
<pre>WPARAM wParam = MAKEWPARAM(IDC_MYBUTTON, BN_CLICKED);
</pre>
</code>

We now have both the <i>wParam</i> and <i>lParam</i> parameters for our
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_command.asp">WM_COMMAND</a>
message that is to be sent to the dialog window.  Putting this all together
results in the following:<br>

<code>
<pre>SendMessage (
	hdlg,                                 // handle to window we are sending message to
	WM_COMMAND,                           // message we are sending
	MAKEWPARAM(IDC_MYBUTTON, BN_CLICKED), // control identifier, and notification code
	GetDlgItem(hdlg, IDC_MYBUTTON));      // handle to window that is sending the message
</pre>
</code>

Let us analyze Charles Petzold's method to see what is different.<br>

<br>

Firstly, he does not combine two pieces of information into
one to be passed into the <i>wParam</i> parameter.  He simply passes
the identifier of the control.  You will notice that because
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bn_clicked.asp">BN_CLICKED</a>
is defined as 0, that our
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/makewparam.asp">MAKEWPARAM</a>
call results in just being the identifier of the control.
So, his code was logically correct.  However, it is still bad code,
as it obfuscates what is actually happening.  When you look at
the fixed code above, you <i>know</i> that you are sending a 
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bn_clicked.asp">BN_CLICKED</a>
notification code to this control's parent.<br>

<br>

Secondly, he passes NULL for the <i>lParam</i> parameter.
As explained on the
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bn_clicked.asp">BN_CLICKED</a>
page, the <i>lParam</i> parameter is the handle to the button.
To properly emulate a user pressing the button,
everything should remain identical to the real thing.<br>

<br>

Logically, the only difference in the code was the lack of passing
the handle to the control sending the message.  Since the original
code works, does this really matter?
It matters only to the code that handles the message.  Since this
code exists in your own dialog box window procedure, it is up to
you whether it uses this information or not.  None of the examples
in the book have any reason to use such information, therefore
it does not matter whatsoever, in these cases.
However, I would like to stress
again that it is better code to explicitly pass all information,
so that you and others who read your code will understand exactly
what is going on.<br>

<br>

There is another method to simulate a user pressing a button,
which is far easier than the above code.
It is to use the 
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bm_click.asp">BM_CLICK Message</a>.
As stated on its 
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bm_click.asp">MSDN page</a>,
it simulates the user clicking a button by sending
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/mouseinput/mouseinputreference/mouseinputmessages/wm_lbuttondown.asp">WM_LBUTTONDOWN</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/mouseinput/mouseinputreference/mouseinputmessages/wm_lbuttonup.asp">WM_LBUTTONUP</a>
messages
in succession to the button, which will cause the button to think it has been pressed,
to which it responds by sending the button's parent window a
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bn_clicked.asp">BN_CLICKED</a>
notification message exactly identical to what we have created above.
You will notice that, to send this message, it only requires the handle to the button.
We must use the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxfunctions/getdlgitem.asp">GetDlgItem()</a>
function to find this.  Thus, we can simulate a button press with the following code:<br>

<code>
<pre>SendMessage(
	GetDlgItem(hdlg, IDC_MYBUTTON),	// handle to button to be pressed
	BM_CLICK,                       // message ID   
	0,                              // wParam = 0; not used, must be zero   
	0);                             // lParam = 0; not used, must be zero   
</pre>
</code>

If this is so much simpler, why don't we use it, instead?
Because, it causes a button press by emulating a mouse click.
This is done by sending mouse messages to the button,
expecting the button to respond appropriately.
Which it does, by sending the desired 
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bn_clicked.asp">BN_CLICKED</a>
notification to the button's parent, 
but, it also responds appropriately to a mouse click
by giving the button the focus.
In almost every case that we wish to emulate a button press,
we merely wish to run the handler code for the button,
and do nothing more.
Often, the handler code for a particular button will
wish to run the handler code for another button.
Instead of making identical code (<i>which causes two places for code to be updated,
if it ever changes, introducing a higher probability of bugs</i>),
the button emulates a button press to run it.
But, imagine how annoying it would be if the user presses the
original button, and the focus changes to the <i>other</i> button.
This is especially annoying if
the user is using the keyboard for control.
A user could potentially be scrolling up and down in a list box,
and suddenly, because a button press was emulated, the
focus moves to the button, and now the up and down arrow keys
merely change button focus from one to another, rather than
scroll through the list.
This is why it is best to stay away from this method.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: WM_PAINT Handler</b><br>
<br>
There is a handler for WM_PAINT in just about every program in the book.
However, there is something missing from every WM_PAINT handler that is explained within
<a href="http://msdn.microsoft.com/library/en-us/gdi/pantdraw_88ac.asp">MSDN's documentation for WM_PAINT</a>:<br>
<br>
"<i>A window may receive internal paint messages as a result of calling
<a href="http://msdn.microsoft.com/library/en-us/gdi/pantdraw_81pz.asp">RedrawWindow</a>
with the RDW_INTERNALPAINT flag set. In this case, the window
may not have an update region. An application should call the
<a href="http://msdn.microsoft.com/library/en-us/gdi/pantdraw_4dkk.asp">GetUpdateRect</a>
function to determine whether the window has an update region.
If GetUpdateRect returns zero, the application should not call the
<a href="http://msdn.microsoft.com/library/en-us/gdi/pantdraw_7b78.asp">BeginPaint</a>
and
<a href="http://msdn.microsoft.com/library/en-us/gdi/pantdraw_1th0.asp">EndPaint</a> functions.</i>"<br>

<br>

<p align="right"><i>Credit: <a href="http://edais.mvps.org/">Mike Sutton</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<a name="cplusplus"><b>Erratum 8: C++ Type Checking</b></a><br>
<br>

<i>Programming Windows, 5th Edition</i> was written for
the C programming language.
However, most people reading it today
likely have a C++ compiler.  While a lot of the programs will compile
fine in C++, some will return errors due to C++'s type checking.<br>
<br>

For instance all calls to
<a href="http://msdn.microsoft.com/library/en-us/vclib/html/_CRT_malloc.asp">malloc</a>
and variants will return
<a href="http://msdn.microsoft.com/library/en-us/vccore/html/C2440.asp">Compiler Error C2440</a>:
'=' : cannot convert from 'void *' to '<i>Data_Type_Of_Pointer</i> *'.
In C, the compiler would merely type cast the return value of malloc into the data
type of the pointer (<i>or even some other variable type</i>) receiving its value.
In C++, you must explicitly type cast the return value into the proper type.
This is good, because it helps catch coding mistakes, like trying to store a pointer
value into an integer.  You can do a type cast as follows:<br>
<br>

Original C code:
<code>
<pre>static PMSG pmsg ; 
pmsg = malloc (cLinesMax * sizeof (MSG)) ; 
</pre>
</code>

C++ code with type cast:
<code>
<pre>static PMSG pmsg ; 
pmsg = <b>(PMSG)</b>malloc (cLinesMax * sizeof (MSG)) ;
</pre>
</code>

However, when adding explicit typecasting for C++,
you should be aware of the
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#64bit">64-bit Portability Issues</a>
elsewhere in this errata list.
You do not want to typecast a pointer or handle to <i>int</i>,
because it is a 32-bit integer, even on 64-bit machines.
On a 64-bit machine, you'll lose 32-bits of the pointer,
and the compiler will not complain since it assumes you
know what you are doing if you are supplying the typecast explicitly.<br>

<br>

<p align="right"><i>Credit: every C++ coder</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Missing Index Items</b><br>
<br>

The following items are missing from the index:<br>
<br>
<ul>
<li>GetMenu (should exist on page 1437)
</li></ul>

The following items are misprinted in the index:<br>
<br>
<ul>
<li>GetDialog<b>Box</b>Units on page 1437 should be GetDialog<b>Base</b>Units.
</li></ul>

Additional note from Jason Doucette:<br>
Any errata listing misprints in the text,
such as the incorrect function name is used,
has resulted in the index stating that location
of that incorrect name.  Thus, the index is
incorrect in all of these errata.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<a name="64bit"><b>Erratum 10: 64-bit Portability Issues</b></a><br>

<br>

<i>Programming Windows, 5th Edition</i> was written for 32-bit machines.
You will run into issues for <i>all</i> programs
when compiling them on a 64-bit machine,
or when attempting to detect 64-bit portability issues
with a compiler switch such as Visual C++'s
<a href="http://msdn2.microsoft.com/en-us/library/yt4xw8fh.aspx">/Wp64 (Detect 64-Bit Portability Issues)</a>
switch.<br>

<br>

You will note that the Win32 API has upgraded many
of its functions to handle new data types that change in size
depending on whether you are using a 32-bit or a 64-bit compiler.
Thus, you will need to typecast parameters into these data types
for them to work on both architectures.
Please see
<a href="http://msdn.microsoft.com/library/en-us/winprog64/winprog64/getting_ready_for_64_bit_windows.asp">Getting Ready for 64-bit Windows</a>
for more information.<br>

<br>


<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="3" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/horiz.gif" height="12"></td>
	</tr>
	
	</tbody></table>

</td>

</tr>
<tr>

<td valign="top" align="center">
<a name="section1"><font size="+1"><b>Section<br>I<br><br>The<br>Basics</b></font></a>
</td>

<td>

	<table border="0" cellpadding="0" cellspacing="0">
	
	<tbody><tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter1"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 1 - Getting Started</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Typo</b><br>
<br>
On page 16, Chapter 1, <i>The MessageBox Function</i>,
on the very last line, the text mentions the HELLMSG.C program.
The correct name is HELL<b>O</b>MSG.C.<br>

<br>

<p align="right"><i>Credit: Scott Blackledge</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter2"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 2 - An Introduction to Unicode</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Typo</b><br>
<br>
On page 30, Chapter 2, <i>Maintaining a Single Source</i>, it states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
page 30, Chapter 2, <i>Maintaining a Single Source</i>
</th>
</tr>
<tr>
<td>
<i>If an identifier named _UNICODE is defined and the TCHAR.H header file is
included in your program, </i>_tcslen<i> is defined to be </i>wcslen<i>:</i><br>

<br>

<code>
#define _tcslen wcslen<br>
</code>

<br>
<i>If UNICODE isn't defined, </i>_tcslen<i> is defined to be </i>strlen<i>:</i><br>
<br>

<code>
#define _tcslen strlen
</code>
</td>
</tr>
</tbody></table>

<br>

UNICODE is supposed to be <b>_</b>UNICODE.<br>
<br>
Also, the differences between UNICODE and _UNICODE are not explained until
the very last section of this chapter, even though the chapter mentions both
several times.  This may give the reader worries about what the exact differences
between the two are, until the end of the chapter.  Then, it would be required
to re-read the entire chapter again for proper understanding of these terms
throughout the chapter.<br>
<br>
Basically, to maintain a single source that compiles in both ASCII and Unicode,
you will need to define some identifiers.
The UNICODE (<i>without the underscore</i>) identifier is recognized by the Win32 API.
The _UNICODE (<i>with the underscore</i>) identifier is recognized by the C run-time library.
Define it if you use any C run-time functions that have strings as parameters.<br>

<br>

You can read more details regarding this on Raymond Chen's blog,
<a href="http://weblogs.asp.net/oldnewthing/"><i>The Old New Thing</i></a>,
in his
<a href="http://weblogs.asp.net/oldnewthing/archive/2004/02/12/71851.aspx">TEXT vs. _TEXT vs. _T, and UNICODE vs. _UNICODE</a>
article.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Correction</b><br>
<br>
On page 27, Chapter 2, <i>The </i>char<i> Data Type</i>,
the book states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
page 27, Chapter 2, <i>The </i>char<i> Data Type</i>
</th>
</tr>
<tr>
<td>
<i>If you define this array as a local variable to a function,
it must be defined as a static variable, as follows:</i><br>
<br>
<code>
static char a[] = "Hello!" ;
</code>
</td>
</tr>
</tbody></table>

<br>

However, this has not been true since the adoption of ANSI C in 1990.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<a name="chap2page37"><b>Erratum 3: Source Code Bug</b></a><br>
<br>
On page 37, Chapter 2, <i>A Formatting Message Box</i>,
the code listing shows a method to allow formatted text,
in 
<a href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_printf.2c_.wprintf.asp"><i>printf()</i></a>
style, to be displayed in a message box.

You will notice the use of the
<a href="http://msdn.microsoft.com/library/en-us/vccore98/html/_crt__vsnprintf.2c_._vsnwprintf.asp"><i>_vs<b>n</b>tprintf()</i></a>
function.  This is a variant of the printf() function which allows,
among other things, a restriction on the number of characters written
to the output (<i>signified by the 'n' within the function name</i>).  This is good, as it avoids the
<a href="http://www.joelonsoftware.com/articles/fog0000000319.html">dreaded buffer overflow security problem</a>.
However, it does not guarantee the output is NULL terminated.
This occurs when what you write to the buffer is larger than the buffer.
It writes as many characters as it can before it runs out of room,
without stopping one character sooner to append a NULL as the final character.
Therefore, you must do this yourself.<br>
<br>
The code can be fixed with one addition line of code.  Place
this code after the
<a href="http://msdn.microsoft.com/library/en-us/vccore98/html/_crt__vsnprintf.2c_._vsnwprintf.asp"><i>_vsntprintf()</i></a>
function call to
'clean up' after it:<br>
<br>
<code>
<pre>	// ensure NULL termination
	szBuffer[sizeof (szBuffer) / sizeof (TCHAR) - 1] = NULL;
</pre>
</code>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Typo</b><br>
<br>
On page 39, Chapter 2, <i>Internationalization and This Book</i>,
the text mentions the following at the end of the first paragraph:<br>

<br>

"<i>If you replace _vsntprintf in SCRNSIZE.C with the Windows function wprintf
(you'll also have to eliminate the second argument to the function),
the Unicode version of SCRNSIZE.C will not run under Windows 98
because Windows 98 does not implement wprintfW.</i>"<br>

<br>

However,
<a href="http://msdn.microsoft.com/library/en-us/vccore98/html/_crt_printf.2c_.wprintf.asp">wprintf()</a>
is the wide-character version of
<a href="http://msdn.microsoft.com/library/en-us/vccore98/html/_crt_printf.2c_.wprintf.asp">printf()</a>.
Charles Petzold meant to use the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/wsprintf.asp">wsprintf()</a>
function as an example, since it is the Windows Version of the standard
<a href="http://msdn.microsoft.com/library/en-us/vccore98/html/_crt_sprintf.2c_.swprintf.asp">sprintf()</a>
function, as explained on page 36.
Therefore, the text should read:<br>

<br>

"<i>If you replace _vsntprintf in SCRNSIZE.C with the Windows function <b>wsprintf</b>
(you'll also have to eliminate the second argument to the function),
the Unicode version of SCRNSIZE.C will not run under Windows 98
because Windows 98 does not implement <b>wsprintfW</b>.</i>"<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter3"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 3 - Windows and Messages</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Typo</b><br>
<br>
On page 42, Chapter 3, <i>An Architectural Overview</i>, it states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 42, Chapter 3, <i>An Architectural Overview</i>
</th>
</tr>
<tr>
<td>
<i>How does the application know that the user has changed the window's size?
For programmers accustomed to only conventional character-mode programming,
there is no mechanism for the operating system to convey information of this
sort to the user.</i>
</td>
</tr>
</tbody></table>

<br>

I believe Charles Petzold meant to write:<br>
<br>
"<i>...to convey information of this sort to the <b>programmer</b>.</i>"

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>
On page 55, Chapter 3, <i>Registering the Window Class</i>,
during the explaining the following statement:<br>
<br>
<code>
wndclass.hCursor = LoadCursor (NULL, IDC_ARROW) ;<br>
</code>
<br>
It states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 55, Chapter 3, <i>Registering the Window Class</i>
</th>
</tr>
<tr>
<td>
<i>This handle is assigned to the <i>bCursor</i> field of the WNDCLASS structure.</i>
</td>
</tr>
</tbody></table>

<br>

Charles Petzold meant to write <i><b>h</b>Cursor</i>, not <i><b>b</b>Cursor</i>
(<i>that is: an <b>H</b> instead of a <b>B</b></i>).
In the italics font of the text, they look very similar.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Apps Hungarian Notation vs. Systems Hungarian Notation</b><br>
<br>

On page 50, there is a section called 'Hungarian Notation'.
It describes a variable-naming convention devised by
<a href="http://en.wikipedia.org/wiki/Charles_Simonyi">Charles Simonyi</a>.
Charles Simonyi's original model is known as Apps Hungarian Notation.
However, Charles Petzold's interpretation of his convention is <i>incorrect</i>.
This infamous model is known as Systems Hungarian Notation.
Charles Petzold gives a simple explanation of this interpretation
it in his text which indicates his mistake:<br>

<br>

"<i>Very simply, the variable name begins with a lowercase letter or letters
that denote the <b>data type</b> of the variable.</i>"<br>

<br>

The mistake is "data type".  In 
<a href="http://msdn.microsoft.com/library/en-us/dnvs600/html/HungaNotat.asp">Charles Simonyi's original paper</a>,
he mentions the word 'type', and apparently, everyone took this to mean
the variable's data type.
Charles Simonyi clearly states in his paper, under <i>Type Calculus</i>:<br>

<br>

"<i>...the concept of "type" in this context is determined by the set of operations that
can be applied to a quantity.
The test for type equivalence is simple: could the same set of operations be meaningfully
applied to the quantities in questions?
If so, the types are thought to be the same.
If there are operations that apply to a quantity in exclusion of others, the type of
the quantity is different.</i>"<br>

<br>

For example, you may have two variables of type <i>int</i>.
One could be the x-coordinate of a pixel in a bitmap,
and the other could store the length of a string.
According to Charles Petzold's model, Systems Hungarian Notation,
you would prefix both variables with <i>i</i>, because they are both of the
same data type, <i>int</i>.
However, in proper Apps Hungarian Notation, as meant by Charles Simonyi,
the variable names would be prefixed by their 'type',
perhaps <i>x</i> for the x-coordinate, and <i>cch</i>, meaning count of characters,
for the string length.
In Apps Hungarian Notation, you can easily distinguish that these two variables
have no business being in the same expression together,
as they are not of the same 'type'.<br>

<br>

Joel Spolsky brought up this information a couple of times on his
<a href="http://www.joelonsoftware.com/">Joel on Software</a> weblog.
In particular, the following articles mention it:<br>

<br>

<a href="http://www.joelonsoftware.com/articles/FogBugzIII.html">Joel on Software: The Road to FogBugz 4.0: Part III</a><br>
<a href="http://www.joelonsoftware.com/articles/Wrong.html">Joel on Software: Making Wrong Code Look Wrong</a><br>

<br>

I highly recommend reading Joel's essays,
as they provide a great explanation
of Charles Simonyi's original idea, Apps Hungarian Notation.
With examples, he explains why it works so well
and why the infamous Systems Hungarian Notation, as explained by Charles Petzold,
isn't as good.<br>

<br>

As
<a href="http://msdn.microsoft.com/library/en-us/dnprogwin/html/intro.asp">Charles Petzold is one of only seven people</a>
to win the Windows Pioneer Award,
for his contribution to the success of Windows,
he is largely responsible for disseminating Systems Hungarian Notation outside of Microsoft.
Although, it should be noted that Charles Petzold explained this notation
because it is what the Windows programmers used.
It is very convenient to know the notation used by the WIndows programmers
when attempting to understand Windows API functions and structures,
which Charles Petzold delves into often.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.joelonsoftware.com/">Joel Spolsky</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter4"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 4 - An Exercise in Text Output</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Misleading Text</b><br>
<br>

On page 99, Chapter 4, <i>Scroll Bar Range and Position</i>,
the explanation of <i>SetScrollRange()</i> states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 99, Chapter 4, <i>Scroll Bar Range and Position</i>
</th>
</tr>
<tr>
<td>
<i>(If you will be calling other functions that affect the appearance of the
scroll bar after you call </i>SetScrollRange<i>, you'll probably want to set
</i>bRedraw<i> to FALSE to avoid excessive redrawing.)</i>
</td>
</tr>
</tbody></table>

<br>

This is somewhat misleading.  Perhaps saying
"<i>If you will be <b>immediately</b> calling other functions...</i>"
is clearer.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>
On Page 114, Chapter 4, <i>The New SYSMETS</i>,
in the SYSMETS3.C program, the following code exists:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 114, Chapter 4, <i>SYSMETS3.C</i>
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_VSCROLL:
               // Get all the vertial scroll bar information

          si.cbSize = sizeof (si) ;
          si.fMask  = SIF_ALL ;
          GetScrollInfo (hwnd, SB_VERT, &amp;si) ;

               // Save the position for comparison later on

          iVertPos = si.nPos ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

This code is <b>ok</b>
(<i>with the exception of the misspelling of <b>vertical</b></i>),
but this code was copied to page 115 like so:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 115, Chapter 4, <i>SYSMETS3.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_HSCROLL:
               // Get all the vertial scroll bar information

          si.cbSize = sizeof (si) ;
          si.fMask  = SIF_ALL ;

               // Save the position for comparison later on

          GetScrollInfo (hwnd, SB_HORZ, &amp;si) ;
          iHorzPos = si.nPos ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

This is not ok.  The first comment should say
"<i>Get all the <b>horizontal</b> scroll bar information</i>",
and the <i>GetScrollInfo()</i> call should be before the second comment.<br>

<br>

Please note that the above typo also occurs in both
future versions of the program in
SYSMETS4.C on pages 227 - 228, Chapter 6,
and in
SYSMETS.C on pages 321 - 322, Chapter 7.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Typo</b><br>
<br>
On page 118, Chapter 4, <i>The New SYSMETS</i>,
the text mentions using "SB_SLOWMACHINE".
This should be "<b>SM</b>_SLOWMACHINE".

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Scroll Bar Code Explanation</b><br>
<br>
On pages 114 - 116, Chapter 4, <i>The New SYSMETS</i>,
in the SYSMETS3.C program, the vertical scroll bar is
handled differently than the horizontal scroll bar.<br>
<br>
Firstly, the vertical scroll bar processes
the scroll bar value SB_THUMBTRACK, which is sent
repeatedly until the user releases the mouse button.
The horizontal scroll bar processes only the
SB_THUMBPOSITION scroll bar value,
which is sent when the user has dragged the
scroll box (<i>thumb</i>) and released the mouse button.
So, the vertical scroll bar continually updates the
window as the user moves it, and horizontal scroll bar
only updates the window after the user stops moving it.
Resize the window so that both scroll bars appear,
and you can see for yourself.
Charles Petzold must not have processed the SB_THUMBTRACK
for the horizontal scroll bar to show off the differences
between the two, as both messages contain the same information
in their messages (<i>i.e. The high-order word of wParam indicates
the position of the scroll box</i>),
you can actually use the same processing code
for both.  Simply changing SB_THUMBPOSITION to SB_THUMBTRACK
'fixes' the horizontal scroll bar so that it responds immediately
to scroll bar movements.<br>
<br>
Secondly, during the update of the window,
the vertical scroll bar calls ScrollWindow() and
UpdateWindow().  The horizontal scroll bar only
calls ScrollWindow().  The reason is that the vertical
scroll bar continually updates, whereas the horizontal
scroll bar does not.  If UpdateWindow() was not called, on a slow machine, you
could have a potential situation where the window's contents
are being scrolled as the user moves the mouse, but the
invalid area is not updated until the user stops moving the
mouse.  This is due to the fact that WM_PAINT is a low
priority message.
An UpdateWindow() call makes it the absolute highest priority message
for just that one call, by sending a WM_PAINT message directly to the window procedure,
bypassing the application's message queue.
This UpdateWindow() call is not required for
the horizontal scroll bar processing, as it only handles
the SB_THUMBPOSITION scroll bar value, and therefore,
the display is only update once - not continuously.<br>
<br>
Please note that the above code differences also exist
in both future versions of the program in SYSMETS4.C on pages 227 - 229, Chapter 6,
and in SYSMETS.C on pages 321 - 323, Chapter 7. 

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a>
and <a href="http://cboard.cprogramming.com/showthread.php?s=&amp;threadid=43852">Ariod</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Typo</b><br>
<br>
On page 111, Chapter 4, <i>How Low Can You Scroll?</i>,
the following line in the sample code in the middle of the page has a typo:<br>
<br>
<code>
si.cbMask = SIF_RANGE | SIF_PAGE;<br>
</code>
<br>
The <a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/scrollbars/scrollbarreference/scrollbarstructures/scrollinfo.asp">SCROLLINFO structure</a>
has no <i>cbMask</i> field.  The field's name should be <i><b>f</b>Mask</i>,
as described on page 109, like so:<br>
<br>
<code>
si.<b>f</b>Mask = SIF_RANGE | SIF_PAGE;<br>
</code>
<br>

<p align="right"><i>Credit: Ricardo Gamez</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter5"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 5 - Basic Drawing</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Figure Typos</b><br>
<br>

On page 136, Chapter 5, <i>The Size of the Device</i>,
Figure 5-4 has two typos.
<i>tmExternalLeading</i> should be changed to <i>tm<b>Internal</b>Leading</i>,
and in the caption, <i>FONTMETRIC</i> should be changed to <i><b>TEXT</b>METRIC</i>.

<p align="right"><i>Credit: Doug Beleznay</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Source Code Omission</b><br>
<br>

On page 148, Chapter 5, <i>Straight Lines</i>,
in the SINEWAVE.C program,
there is a missing <i>EndPaint()</i> call to match the
<i>BeginPaint()</i> call within handling the WM_PAINT message.
The following line of code should be inserted immediately
before the <i>return()</i> call that concludes the WM_PAINT
message processing:<br>
<br>
<code>
          EndPaint (hwnd, &amp;ps) ;
</code>

<p align="right"><i>Credit: Ross Driedger</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Typo</b><br>
<br>

On page 143, Chapter 5, <i>Setting Pixels</i>,
the text states:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 143, Chapter 5, <i>Setting Pixels</i> - Error
</th>
</tr>
<tr>
<td>
<i>Even though the Windows GPI includes </i>SetPixel<i> and </i>GetPixel<i> functions,
 they are not commonly used.</i>
</td>
</tr>
</tbody></table>

<br>

However, I believe that <i>GPI</i> should be <i>GDI</i>:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 143, Chapter 5, <i>Setting Pixels</i> - Correction
</th>
</tr>
<tr>
<td>
<i>Even though the Windows G<b>D</b>I includes </i>SetPixel<i> and </i>GetPixel<i> functions,
 they are not commonly used.</i>
</td>
</tr>
</tbody></table>

<br>

I believe this, as opposed to <i>API</i> (<i>Application Programming Interface</i>) suggested by
<a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a>,
as the previous two paragraphs were just speaking about the
Windows GDI (<i>Graphics Device Interface</i>)
and the <i>SetPixel()</i> and <i>GetPixel()</i> functions.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a>, based on 
<a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a>'s report</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Correction</b><br>
<br>

On pages 167 - 168, Chapter 5, <i>Drawing Modes</i>, starting at the bottom of page 167
continuing into page 168, the text states:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Pages 167 - 168, Chapter 5, <i>Drawing Modes</i> - Error
</th>
</tr>
<tr>
<td>
<i>The R2_NOT drawing mode always inverts the destination color to determine the color of the line,
regardless of the color of the pen. For example, a line drawn on a cyan destination will appear as magenta.</i>
</td>
</tr>
</tbody></table>

<br>

Cyan is 00FFFF (<i>in RRGGBB</i>).  The inverse of this is FF0000, which is red.  Magenta is
purple - a combination of blue and red, FF00FF.  Therefore, the text should state:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Pages 167 - 168, Chapter 5, <i>Drawing Modes</i> - Correction
</th>
</tr>
<tr>
<td>
<i>The R2_NOT drawing mode always inverts the destination color to determine the color of the line,
regardless of the color of the pen. For example, a line drawn on a cyan destination will appear as <b>red</b>.</i>
</td>
</tr>
</tbody></table>

<br>

<p align="right"><i>Credit: Peter Ehrhart</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Miscalculation</b><br>
<br>

On page 137, Chapter 5, <i>The Size of the Device</i>,
in the third last paragraph,
Petzold mentions that a 17-inch monitor would have an actual display size of about 12 inches by 9 inches.
However, those are the values for a viewable diagonal of 15 inches.
<a href="http://www.consumersearch.com/www/computers/17_and_19_inch_crt_monitors/fullstory.html">The viewable size of 17-inch monitor is normally close to 16 inches.</a>
This would make the actual display size about 12.8 inches by 9.6 inches, which would round to 13 inches by 10 inches.
The figures he creates are used only for a quick approximation.
Therefore, I am not sure if he created these figures quickly by guessing that the viewable size of a 17-inch
monitor is 15 inches, or that he was thinking of a 15-inch monitor when he did the calculations,
and assumed that the viewable size was 15 inches, as well.
The fact that he uses the words "the actual display size" indicates that he is well
aware of the fact that the viewable size is smaller than the monitor size.
In either case, he is slightly wrong, but the numbers are close enough
to the real values for him to get his point across.

<br>

<p align="right"><i>Credit: <a href="http://daniberg.com/">Dani Berg</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Reference Mistake</b><br>
<br>

On page 190, Chapter 5, <i>The MM_ISOTROPIC Mapping Mode</i>,
the last paragraph states:<br>
<br>
"<i>GetDeviceCaps with the HORZRES and VERTRES indexes return the dimensions of the device in millimeters.</i>"<br>
<br>
The paragraph should state:<br>
<br>
"<i>GetDeviceCaps with the HORZ<b>SIZE</b> and VERT<b>SIZE</b> indexes return the dimensions of the device in millimeters.</i>"<br>
<br>
On the 
<a href="http://msdn.microsoft.com/library/en-us/gdi/devcons_88s3.asp">MSDN GetDeviceCaps function page</a>,
it states that HORZSIZE and VERTSIZE return the width and height, in millimeters, of the physical screen.
It also states that HORZRES and VERTRES return the width and height, in pixels, of the screen.
You can see that Charles Petzold used these parameters correctly in the code preceding the paragraph,
he merely referred to the wrong parameters during his explanation.<br>

<br>

<p align="right"><i>Credit: Khoguan Pan</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Insignificant Misprint</b><br>
<br>

On page 167, Chapter 5, <i>Drawing Modes</i>,
in the first column under the horizontal line in the table
about all sixteen ROP2 drawing modes,
the word 'Results' should be 'Result'.
Yes, it's minor, but this keeps in synch with
the tables on pages 658 and 660 in Chapter 14.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Missing Parameter</b><br>
<br>

On page 183, Chapter 5, <i>Working with MM_TEXT</i>,
the second section of code shows how to use the
<a href="http://msdn.microsoft.com/library/en-us/gdi/cordspac_7lbs.asp">SetWindowOrgEx() function</a>:<br>

<code>
<pre>     SetWindowOrgEx (hdc, 0, cyChar * iVscrollPos) ;
</pre>
</code>

But, it is missing the final (fourth) paramter:

<code>
<pre>     SetWindowOrgEx (hdc, 0, cyChar * iVscrollPos<b>, NULL</b>) ;
</pre>
</code>

This last paramter is a pointer to a
<a href="http://msdn.microsoft.com/library/en-us/gdi/rectangl_0tiq.asp">POINT structure</a>
that receives the previous origin of the window.
If it is NULL, as in all of Petzold's cases, the parameter is not used.<br>

<br>

<p align="right"><i>Credit: DollfaceYY</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Mistype</b><br>
<br>

On page 187, Chapter 5, <i>The Metric Mapping Modes</i>,
the code at the very top of the page references a
<i>DptoLP() function</i>.
The second letter, 'p', in the function name should be capitalized:
<a href="http://msdn.microsoft.com/library/en-us/gdi/cordspac_6rqo.asp">D<b>P</b>toLP()</a>.<br>

<br>

<p align="right"><i>Credit: DollfaceYY</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 10: Missing Parameter</b><br>
<br>

On page 189, Chapter 5, <i>The MM_ISOTRPOIC Mapping Mode</i>,
the code at the very top of the page references the
<a href="http://msdn.microsoft.com/library/en-us/gdi/cordspac_3c6d.asp">SetMapMode() function</a>.
It takes two parameters, but only one is passed.
It should be called like so:<br>
<code>
<pre>SetMapMode (<b>hdc,</b> MM_ISOTROPIC) ;
</pre>
</code>

You can see correct usage of this function
on the previous page, page 188.<br>

<br>

<p align="right"><i>Credit: DollfaceYY</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter6"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 6 - The Keyboard</b></font></a>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Typo</b><br>
<br>
On Page 227, Chapter 6, in the SYSMETS4.C program, the following code exists:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 227, Chapter 6, <i>SYSMETS4.C</i>
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_VSCROLL:
               // Get all the vertical scroll bar information

          si.cbSize = sizeof (si) ;
          si.fMask  = SIF_ALL ;
          GetScrollInfo (hwnd, SB_VERT, &amp;si) ;

               // Save the position for comparison later on

          iVertPos = si.nPos ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

This code is <b>ok</b>, but this code was copied to page 228 like so:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 228, Chapter 6, <i>SYSMETS4.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_HSCROLL:
               // Get all the vertical scroll bar information

          si.cbSize = sizeof (si) ;
          si.fMask  = SIF_ALL ;

               // Save the position for comparison later on

          GetScrollInfo (hwnd, SB_HORZ, &amp;si) ;
          iHorzPos = si.nPos ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

This is not ok.  The first comment should say
"<i>Get all the <b>horizontal</b> scroll bar information</i>",
and the <i>GetScrollInfo()</i> call should be before the second comment.<br>

<br>

Please note that the above typo also occurs in
the prior version of the program in 
SYSMETS3.C on pages 114 - 115, Chapter 4,
and in the final version of the program in
SYSMETS.C on pages 321 - 322, Chapter 7.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>

On page 264, Chapter 6, <i>Caret Functions</i>,
in the second to last paragraph,
the sentence should be changed from
<i>DestroyWindow</i> to <i>Destroy<b>Caret</b></i>.

<p align="right"><i>Credit: John Dlugosz and Doug Yip</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Scroll Bar Code Explanation</b><br>
<br>
On pages 227 - 229, Chapter 6, <i>Enhancing SYSMETS for the Keyboard</i>,
in the SYSMETS4.C program, the vertical scroll bar is
handled differently than the horizontal scroll bar.<br>
<br>
Firstly, the vertical scroll bar processes
the scroll bar value SB_THUMBTRACK, which is sent
repeatedly until the user releases the mouse button.
The horizontal scroll bar processes only the
SB_THUMBPOSITION scroll bar value,
which is sent when the user has dragged the
scroll box (<i>thumb</i>) and released the mouse button.
So, the vertical scroll bar continually updates the
window as the user moves it, and horizontal scroll bar
only updates the window after the user stops moving it.
Resize the window so that both scroll bars appear,
and you can see for yourself.
Charles Petzold must not have processed the SB_THUMBTRACK
for the horizontal scroll bar to show off the differences
between the two, as both messages contain the same information
in their messages (<i>i.e. The high-order word of wParam indicates
the position of the scroll box</i>),
you can actually use the same processing code
for both.  Simply changing SB_THUMBPOSITION to SB_THUMBTRACK
'fixes' the horizontal scroll bar so that it responds immediately
to scroll bar movements.<br>
<br>
Secondly, during the update of the window,
the vertical scroll bar calls ScrollWindow() and
UpdateWindow().  The horizontal scroll bar only
calls ScrollWindow().  The reason is that the vertical
scroll bar continually updates, whereas the horizontal
scroll bar does not.  If UpdateWindow() was not called, on a slow machine, you
could have a potential situation where the window's contents
are being scrolled as the user moves the mouse, but the
invalid area is not updated until the user stops moving the
mouse.  This is due to the fact that WM_PAINT is a low
priority message.
An UpdateWindow() call makes it the absolute highest priority message
for just that one call, by sending a WM_PAINT message directly to the window procedure,
bypassing the application's message queue.
This UpdateWindow() call is not required for
the horizontal scroll bar processing, as it only handles
the SB_THUMBPOSITION scroll bar value, and therefore,
the display is only update once - not continuously.<br>
<br>
Please note that the above code differences also exist
in the prior version of the program in SYSMETS3.C on pages 114 - 116, Chapter 4,
and in the final version of the program in
SYSMETS.C on pages 321 - 323, Chapter 7. 

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a>
and <a href="http://cboard.cprogramming.com/showthread.php?s=&amp;threadid=43852">Ariod</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Typo</b><br>
<br>
On page 243, Chapter 6, <i>The Foreign-Language Keyboard Problem</i>,
in the middle of the second paragraph, a starting parenthesis appears
with no closing parenthesis at the end of the paragraph.<br>

<br>

Please note: This erratum is obviously of no
real concern to the reader.
It is only included for completeness, in case
Charles Petzold reviews this page for corrections to the next
version of
<i><a href="http://www.charlespetzold.com/ProgWinEditions.html">Programming Windows</a></i>.<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Typo</b><br>
<br>
On pages 244, Chapter 6, <i>Character Sets and Fonts</i>,
in the third last paragraph on the page, the text speaks about
bitmap fonts.  In one occasion, the text refers to
"Bitmaps fonts", which is just a typo for "Bitmap fonts".<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Memory Deallocation</b><br>
<br>
On pages 271, Chapter 6, in the TYPER.C program,
the text buffer is not deallocated when the application terminates.
Add the following code to the WM_DESTORY message handler
to free the memory of the buffer before the application ends:<br>

<code>
<pre>          if (pBuffer != NULL)
               free (pBuffer) ;
</pre>
</code>

<p align="right"><i>Credit: Olivier Langlois</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter7"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 7 - The Mouse</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Typo</b><br>
<br>
On page 303, Chapter 7, <i>Child Windows in CHECKER</i>,
the top of the page mentions using the <i>SetWindowWord()</i> function,
when the program actually uses the <i>SetWindow<b>Long</b>()</i> function.
The <i>SetWindowWord()</i> function is obsolete.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>
On Page 321, Chapter 7, <i>THE MOUSE WHEEL</i>,
in the SYSMETS.C program, the following code exists:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 321, Chapter 7, <i>SYSMETS.C</i>
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_VSCROLL:
               // Get all the vertical scroll bar information

          si.cbSize = sizeof (si) ;
          si.fMask  = SIF_ALL ;
          GetScrollInfo (hwnd, SB_VERT, &amp;si) ;

               // Save the position for comparison later on

          iVertPos = si.nPos ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

This code is <b>ok</b>, but this code was copied to page 322 like so:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 322, Chapter 7, <i>SYSMETS.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_HSCROLL:
               // Get all the vertical scroll bar information

          si.cbSize = sizeof (si) ;
          si.fMask  = SIF_ALL ;

               // Save the position for comparison later on

          GetScrollInfo (hwnd, SB_HORZ, &amp;si) ;
          iHorzPos = si.nPos ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

This is not ok.  The first comment should say
"<i>Get all the <b>horizontal</b> scroll bar information</i>",
and the <i>GetScrollInfo()</i> call should be before the second comment.<br>

<br>

Please note that the above typo also occurs in
both prior version of the program in 
SYSMETS3.C on pages 114 - 115, Chapter 4,
and in
SYSMETS4.C on pages 227 - 228, Chapter 6.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Source Code Error</b><br>
<br>

On page 316, Chapter 7, <i>The BLOKOUT2 Program</i>,
in the BLOKOUT2.C program,
there is a signed/unsigned mismatch
in the WM_MOUSEMOVE and WM_LBUTTONUP message processing:<br>
<br>
<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 316, Chapter 7, <i>BLOKOUT2.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_MOUSEMOVE :
          if (fBlocking)
          {
               SetCursor (LoadCursor (NULL, IDC_CROSS)) ;
               
               DrawBoxOutline (hwnd, ptBeg, ptEnd) ;
               
               ptEnd.x = LOWORD (lParam) ;
               ptEnd.y = HIWORD (lParam) ;
               
               DrawBoxOutline (hwnd, ptBeg, ptEnd) ;
          }
          return 0 ;
          
     case WM_LBUTTONUP :
          if (fBlocking)
          {
               DrawBoxOutline (hwnd, ptBeg, ptEnd) ;
               
               ptBoxBeg   = ptBeg ;
               ptBoxEnd.x = LOWORD (lParam) ;
               ptBoxEnd.y = HIWORD (lParam) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>
The results of the LOWORD and HIWORD macros should be cast to short values
before being assigned to the fields of the POINT structures:<br>
<br>
<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 316, Chapter 7, <i>BLOKOUT2.C</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_MOUSEMOVE :
          if (fBlocking)
          {
               SetCursor (LoadCursor (NULL, IDC_CROSS)) ;
               
               DrawBoxOutline (hwnd, ptBeg, ptEnd) ;
               
               ptEnd.x = <b>(short)</b> LOWORD (lParam) ;
               ptEnd.y = <b>(short)</b> HIWORD (lParam) ;
               
               DrawBoxOutline (hwnd, ptBeg, ptEnd) ;
          }
          return 0 ;
          
     case WM_LBUTTONUP :
          if (fBlocking)
          {
               DrawBoxOutline (hwnd, ptBeg, ptEnd) ;
               
               ptBoxBeg   = ptBeg ;
               ptBoxEnd.x = <b>(short)</b> LOWORD (lParam) ;
               ptBoxEnd.y = <b>(short)</b> HIWORD (lParam) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: Paul Middleton</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Source Code Omission</b><br>
<br>

On Page 318, Chapter 7, <i>THE MOUSE WHEEL</i>,
in the SYSMETS.C program,
there are two macros omitted in the source code
in the book.  This erratum is only partially stated within
the <code>readme.txt</code> file that accompanies
the text book:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
\readme.txt
</th>
</tr>
<tr>
<td>
<code>
<pre>Some programs use features that are new with Windows 98 and Windows
NT 5. At the time of the creation of this CD, the Windows header
files included with Visual C++ 6 and distributed via MSDN and the
Microsoft web site did not assume Windows 98 development as a
default. Thus, to use Windows 98 features, a #define statement must
appear before the #include statement for the Windows header files,
like this:

    #define WINVER 0x0500
    #include <windows.h>

This #define statement is included in the appropriate programs on
the CD but is not shown in the program listings in the book.
</windows.h></pre>
</code>
</td>
</tr>
</tbody></table>

<br>

I will fully explain this particular situation:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 318, Chapter 7, <i>SYSMETS.C</i> - Incorrect
</th>
</tr>
<tr>
<td>
<code>
<pre>/*---------------------------------------------------
   SYSMETS.C -- Final System Metrics Display Program 
                (c) Charles Petzold, 1998

  ---------------------------------------------------*/

#include &lt;windows.h&gt;
#include "sysmets.h"
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

The two definitions are:<br>
<br>
<code>
<pre><b>#define WINVER 0x0500
#define _WIN32_WINNT 0x0500   // for Mouse Wheel support</b>
</pre>
</code>

The source code on the companion CD has the two macros defined:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
\Chap07\SysMets\<i>SYSMETS.C</i> - Correct
</th>
</tr>
<tr>
<td>
<code>
<pre>/*---------------------------------------------------
   SYSMETS.C -- Final System Metrics Display Program 
                (c) Charles Petzold, 1998
  ---------------------------------------------------*/

<b>#define WINVER 0x0500
#define _WIN32_WINNT 0x0500   // for Mouse Wheel support</b>
#include &lt;windows.h&gt;
#include "sysmets.h"
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

If you omit the following macro:<br>
<br>
<code>
#define WINVER 0x0500<br>
</code>
<br>

The program will not have access to the following required definitions:<br>
<br>
<code>
<pre>SM_XVIRTUALSCREEN
SM_YVIRTUALSCREEN
SM_CXVIRTUALSCREEN
SM_CYVIRTUALSCREEN
SM_CMONITORS
SM_SAMEDISPLAYFORMAT
</pre>
</code>

If you omit the following macro:<br>
<br>
<code>
#define _WIN32_WINNT 0x0500<br>
</code>
<br>
The program will not have access to the following required definitions:<br>
<br>
<code>
<pre>SPI_GETWHEELSCROLLLINES
WHEEL_DELTA
WM_MOUSEWHEEL
</pre>
</code>

Also, the text book lacks any explanation of why these definitions are
required or what exactly WINVER and _WIN32_WINNT mean.
Basically, certain features, such as the mouse wheel,
depend on a particular version of Windows.
These definitions are declared using conditional code, such as the following,
in WINUSER.H:<br>
<br>
<code>
<pre>#if (_WIN32_WINNT &gt;= 0x0400) || (_WIN32_WINDOWS &gt; 0x0400)
#define WM_MOUSEWHEEL                   0x020A
#define WM_MOUSELAST                    0x020A
#else
#define WM_MOUSELAST                    0x0209
#endif /* if (_WIN32_WINNT &lt; 0x0400) */
</pre>
</code>

When you define certain macros,
you set a target version of Windows for your application.
The compiler will then detect whether your application
uses functions that are not supported on its target,
by returning <i>error C2065: undeclared identifier</i>
for all improper references.
The following URL shows a table that indicates
which macros you must define to target a particular operating system,
and will be of much value for you:
<a href="http://msdn.microsoft.com/library/en-us/winprog/winprog/using_the_windows_headers.asp">MSDN - Using the Windows Headers</a>.
Please note the warning after the table which indicates that sometimes you have to target
the next major operating system release, if the feature you require was added
to a service pack for the version of Windows you wish to target.
For example, the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowstructures/windowinfo.asp">WINDOWINFO Structure</a>
requires Windows 98, which this table states that 
WINVER must be set to at least 0x0410.  You will find that it does not work unless
you target the next major operating system release, Windows Me,
which requires WINVER to be set to at least 0x0500.<br>

<br>

In our program, we wished to set the target machine as Windows 2000,
therefore we need to explicitly define _WIN32_WINNT as 0x0500 or greater.
We defined it as 0x0500 with the following statement:<br>
<br>
<code>
#define _WIN32_WINNT 0x0500<br>
</code>
<br>
You can define the symbols with a statement like the above,
or you can specify the following compiler option:<br>
<br>
<code>
/D_WIN32_WINNT=0x0500<br>
</code>
<br>
In MSVC++ 6.0, you can specify compiler options by going to the Projects menu, Settings, C/C++ tab.

<p align="right"><i>Credit: <a href="http://www.charlespetzold.com/">Charles Petzold</a> and
<a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Scroll Bar Code Explanation</b><br>
<br>
On pages 321 - 323, Chapter 7, <i>The MOUSE WHEEL</i>,
in the SYSMETS.C program, the vertical scroll bar is
handled differently than the horizontal scroll bar.<br>
<br>
Firstly, the vertical scroll bar processes
the scroll bar value SB_THUMBTRACK, which is sent
repeatedly until the user releases the mouse button.
The horizontal scroll bar processes only the
SB_THUMBPOSITION scroll bar value,
which is sent when the user has dragged the
scroll box (<i>thumb</i>) and released the mouse button.
So, the vertical scroll bar continually updates the
window as the user moves it, and horizontal scroll bar
only updates the window after the user stops moving it.
Resize the window so that both scroll bars appear,
and you can see for yourself.
Charles Petzold must not have processed the SB_THUMBTRACK
for the horizontal scroll bar to show off the differences
between the two, as both messages contain the same information
in their messages (<i>i.e. The high-order word of wParam indicates
the position of the scroll box</i>),
you can actually use the same processing code
for both.  Simply changing SB_THUMBPOSITION to SB_THUMBTRACK
'fixes' the horizontal scroll bar so that it responds immediately
to scroll bar movements.<br>
<br>
Secondly, during the update of the window,
the vertical scroll bar calls ScrollWindow() and
UpdateWindow().  The horizontal scroll bar only
calls ScrollWindow().  The reason is that the vertical
scroll bar continually updates, whereas the horizontal
scroll bar does not.  If UpdateWindow() was not called, on a slow machine, you
could have a potential situation where the window's contents
are being scrolled as the user moves the mouse, but the
invalid area is not updated until the user stops moving the
mouse.  This is due to the fact that WM_PAINT is a low
priority message.
An UpdateWindow() call makes it the absolute highest priority message
for just that one call, by sending a WM_PAINT message directly to the window procedure,
bypassing the application's message queue.
This UpdateWindow() call is not required for
the horizontal scroll bar processing, as it only handles
the SB_THUMBPOSITION scroll bar value, and therefore,
the display is only update once - not continuously.<br>
<br>

Please note that the above code differences also exist
in both prior version of the program in SYSMETS3.C on pages 114 - 116, Chapter 4,
and in SYSMETS4.C on pages 227 - 229, Chapter 6.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a>
and <a href="http://cboard.cprogramming.com/showthread.php?s=&amp;threadid=43852">Ariod</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Typo</b><br>
<br>
On page 276, Chapter 7, <i>Client-Area Mouse Messages</i>,
on the second to last line of the page, there is a typo.<br>
<br>
The following code is incorrect:<br>
<br>
<code>
wparam &amp; MK_SHIFT<br>
</code>
<br>
The 'p' should be capitalized, like so:<br>
<br>
<code>
w<b>P</b>aram &amp; MK_SHIFT
</code>

<br>

<p align="right"><i>Credit: Brandino Andreas</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Precedence Clarification</b><br>
<br>
On page 312, Chapter 7, <i>Blocking Out a Rectangle</i>,
in the BLOKOUT1.C program,
the switch case for WM_CHAR attempts to see if the user
is in the process of making a rectangle selection
(<i>if fBlocking is true</i>)
and if the used pressed the ESC key
(<i>if wParam is equal to 0x1B</i>):<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 312, Chapter 7, BLOKOUT1.C - Improper
</th>
</tr>
<tr>
<td>
<code>
<pre>case WM_CHAR :
	if (fBlocking &amp; wParam == '\x1B')     // i.e., Escape
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

Note the use of two operators: the equality operator (==)
and the bitwise-AND operator (&amp;).
The code does not clarify which operator should be evaluated first.
Without intimate knowledge of the
<a href="http://msdn.microsoft.com/library/en-us/vclang/html/_pluslang_c.2b2b_.operators.asp">order of precedence</a>
of such operators, this <i>could</i> be a bug (<i>even though, after inspection, it is not a bug</i>).
Due to the likely chance of a bug in such code, modern compilers will return the following warning:<br>

<br>

<i>warning C4554: '&amp;' : check operator precedence for possible error; use parentheses to clarify precedence</i><br>

<br>

To make this code absolutely clear, and to avoid warning messages,
add parenthesis to clarify the precedence:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 312, Chapter 7, BLOKOUT1.C - Proper
</th>
</tr>
<tr>
<td>
<code>
<pre>case WM_CHAR :
	if (fBlocking &amp; <b>(</b>wParam == '\x1B'<b>)</b>)     // i.e., Escape
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

I should note that the code is improper only in the book.
The code on the CD that accompanies the book has the parenthesis added.<br>

<br>

<p align="right"><i>Credit: Mike Malone</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter8"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 8 - The Timer</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: WinXP Update</b><br>
<br>
On page 333, Chapter 8, <i>Method One</i>, the text states:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 333, Chapter 8, <i>Method One</i>
</th>
</tr>
<tr>
<td>
<i>Here's a revealing experiment: First invoke the
Display applet from the Control Panel, and select the Effects tab. Make sure
the "Show window contents while dragging" button is </i>unchecked<i>. Now try
moving or resizing the BEEPER1 window. This causes the program to enter a
"modal message loop." Windows prevents anything from interfering with the
move or resize operation by trapping all messages through a message loop
inside Windows rather than the message loop in your program. Most messages
to a program's window that come through this loop are simply discarded,
which is why BEEPER1 stops beeping.</i>
</td>
</tr>
</tbody></table>

<br>

I know that the book was not written for Windows XP, but I thought I would point
out that Windows XP no longer traps messages when moving / resizing a window with
the "<i>Show window contents while dragging</i>" button unchecked.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>
On page 351, Chapter 8, <i>Building an Analog Clock</i>, there is a typo.
A paragraph in the middle of the page states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 351, Chapter 8, <i>Building an Analog Clock</i>
</th>
</tr>
<tr>
<td>
<i>The </i>DrawHands<i> function draws the hour, minute, and second hands of the
clock. The coordinates defining the outlines of the hands (as they appear
when pointing straight up) are stored in an array of POINT structures.
Depending upon the time, these coordinates are rotated using the </i>RotatePoint<i>
function and are displayed with the Windows </i>Polyline<i> function. Notice that
the hour and minute hands are displayed only if the </i>bChange<i> parameter to
</i>DrawHands<i> is TRUE. When the program updates the clock hands, in most cases
the hour and minute hands will not need to be redrawn.</i>
</td>
</tr>
</tbody></table>

<br>

However, there is no <i>bChange</i> variable in <i>DrawHands</i>.
The variable is <i><b>f</b>Change</i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Test Code Remnants</b><br>
<br>
On page 354, Chapter 8, <i>USING THE TIMER FOR A STATUS REPORT</i>,
in the WHATCLR.C program, there is a line of code in the
WM_TIMER handler that is unnecessary.
It is the following line:<br>

<br>

<code>
SetPixel (hdcScreen, pt.x, pt.y, 0) ;<br>
</code>

<br>

This line of code plots a black pixel to be displayed
after reading the pixel's color.  I would assume that this
code was only used during the debugging or testing phases
of the program, and is unnecessary.
In fact, it is unwanted, as it writes to the display or on
top of other windows which is does not own.<br>
<br>
Merely remove this line for the program to operate properly.
This line only exists in the text book source code;
it does not exist in the program samples
that accompany the text book.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.gamedev.net/community/forums/viewreply.asp?ID=1561068">Strayfire</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter9"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 9 - Child Window Controls</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Typo</b><br>
<br>
On page 357, Chapter 9, <i>Child Window Controls</i>,
the first paragraph states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 357, Chapter 9, <i>Child Window Controls</i>
</th>
</tr>
<tr>
<td>
<i>Although the CHECKER1 and CHECKER2 versions of this program use only one
main window, the CHECKER3 version uses a child window for each rectangle.
The rectangles are maintained by a separate window procedure named
</i>ChildProc<i>.</i>
</td>
</tr>
</tbody></table>

<br>

However, the window procedure for the CHECKER3 program is called <i>Child<b>Wnd</b>Proc</i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>

On Page 363, Chapter 9, <i>Creating the Child Windows</i>,
the parameter list on the bottom of the page for CreateWindow
has a few typos:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 363, Chapter 9, <i>Creating the Child Windows</i>
</th>
</tr>
<tr>
<td>

<table border="0" cellpadding="5" cellspacing="0">
<tbody><tr><td valign="top">Class name</td>
<td valign="top"><pre>TEXT ("button")</pre></td></tr>
<tr><td valign="top">Window text</td>
<td valign="top"><pre>button[i].szText</pre></td></tr>
<tr><td valign="top">Window style</td>
<td valign="top"><pre>WS_CHILD ¦ WS_VISIBLE ¦ button[i].iStyle</pre></td></tr>
<tr><td valign="top">x position</td>
<td valign="top"><pre>cxChar</pre></td></tr>
<tr><td valign="top">y position</td>
<td valign="top"><pre>cyChar * (1 + 2 * i)</pre></td></tr>
<tr><td valign="top">Width</td>
<td valign="top"><pre>20 * xChar</pre></td></tr>
<tr><td valign="top">Height</td>
<td valign="top"><pre>7 * yChar / 4</pre></td></tr>
<tr><td valign="top">Parent window</td>
<td valign="top"><pre>hwnd</pre></td></tr>
<tr><td valign="top">Child window ID</td>
<td valign="top"><pre>(HMENU) i</pre></td></tr>
<tr><td valign="top">Instance handle</td>
<td valign="top"><pre>((LPCREATESTRUCT) lParam) -&gt; hInstance</pre></td></tr>
<tr><td valign="top">Extra parameters</td>
<td valign="top"><pre>NULL</pre></td></tr>
</tbody></table> 

</td>
</tr>
</tbody></table>

<br>

For the <i>Width</i> and <i>Height</i> parameter, it shows <i>xChar</i> and <i>yChar</i>.
They should be <i><b>c</b>xChar</i> and <i><b>c</b>yChar</i> as used in the x position and y position
parameters.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Text Correction</b><br>
<br>

On page 391, Chapter 9, <i>The COLORS1 Program</i>,
the second paragraph states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 391, Chapter 9, <i>The COLORS1 Program</i>
</th>
</tr>
<tr>
<td>
<i>COLORS1 creates its normal overlapped window and the 10 child windows
within the </i>WinMain<i> function using </i>CreateWindow<i>.</i>
</td>
</tr>
</tbody></table>

<br>

This is not true.  The main normal overlapped window is created from
<i>WinMain()</i>, as normal.  The 10 child windows are created in
the <i>WndProc()</i> function from within the WM_CREATE message.
It is true that all are created
with the <i>CreateWindow()</i> function, however.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Text Correction</b><br>
<br>

On page 391, Chapter 9, <i>The COLORS1 Program</i>,
the last paragraph states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 391, Chapter 9, <i>The COLORS1 Program</i>
</th>
</tr>
<tr>
<td>
<i>When the </i>WndProc<i> window procedure receives a WM_VSCROLL message, the high
word of the </i>lParam<i> parameter is the handle to the child window.</i>
</td>
</tr>
</tbody></table>

<br>

As far as I know, handles are 32-bit integers,
therefore the high word (a 16-bit number) of anything cannot be a handle.
Also, the MSVC++ 6.0 MSDN documentation on WM_VSCROLL states:<br>

<br>
<code>
"hwndScrollBar = (HWND) lParam;      // handle to scroll bar"<br>
</code>

<br>

This is consistent with your code for this example (COLORS1.C), which uses
the entire 32-bit <i>lParam</i> value as the first parameter to
<i>GetWindowLong()</i>, in this statement on page 388:<br>

<br>

<code>
"i = GetWindowLong ((HWND) lParam, GWL_ID) ;"<br>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Typo</b><br>
<br>

On page 393, Chapter 9, <i>Coloring the Background</i>,
the first paragraph states at the end:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 393, Chapter 9, <i>Coloring the Background</i>
</th>
</tr>
<tr>
<td>
<i>Just as we were able to get and set the scroll bar window procedure
using </i>GetWindowLong<i> and </i>SetWindowLong<i>,
we can get and set the handle to this
brush using </i>GetClassWord<i> and </i>SetClassWord<i>.
</i>
</td>
</tr>
</tbody></table>

<br>

<i>GetClassWord()</i> and <i>SetClassWord()</i> are obsolete.  The text should state
<i>GetClass<b>Long</b>()</i> and <i>SetClass<b>Long</b>()</i>, as in the example that follows this text, as
well as the code for COLORS1.C.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Text Correction (Possibly only for WinXP)</b><br>
<br>

On page 398, Chapter 9, The Edit Class Styles,
the text states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 398, Chapter 9, The Edit Class Styles
</th>
</tr>
<tr>
<td>
<i>For a multiline edit control, text wordwraps unless you use the
ES_AUTOHSCROLL style, in which case you must press the ENTER
key to start a new line.</i>
</td>
</tr>
</tbody></table>

<br>

This implies that wordwrapping is turned 'off' by including the ES_AUTOHSCROLL style,
I am not sure if this is the case for Win98 or WinNT, but for my
Windows XP system, wordwrapping is not dependant solely on the ES_AUTOHSCROLL style.
It is also turned 'off' by including the WS_HSCROLL window style.<br>
<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
		
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Text Correction</b><br>
<br>

On page 399, Chapter 9, <i>Edit Control Notification</i>,
the text explains the notification codes for Edit Controls, as shown:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 399, Chapter 9, <i>Edit Control Notification</i>
</th>
</tr>
<tr>
<td>

<p><i>The notification codes are shown below:</i></p>

<p>
<table cellpadding="5" width="100%">
<tbody><tr><td valign="top">EN_SETFOCUS</td>
<td valign="top"><i>Edit control has gained the input focus.</i></td></tr>
<tr><td valign="top">EN_KILLFOCUS</td>
<td valign="top"><i>Edit control has lost the input focus.</i></td></tr>
<tr><td valign="top">EN_CHANGE</td>
<td valign="top"><i>Edit control's contents will change.</i></td></tr>
<tr><td valign="top">EN_UPDATE</td>
<td valign="top"><i>Edit control's contents have changed.</i></td></tr>
<tr><td valign="top">EN_ERRSPACE</td>
<td valign="top"><i>Edit control has run out of space.</i></td></tr>
<tr><td valign="top">EN_MAXTEXT</td>
<td valign="top"><i>Edit control has run out of space on insertion.</i></td></tr>
<tr><td valign="top">EN_HSCROLL</td>
<td valign="top"><i>Edit control's horizontal scroll bar has been clicked.</i></td></tr>
<tr><td valign="top">EN_VSCROLL</td>
<td valign="top"><i>Edit control's vertical scroll bar has been clicked.</i></td></tr>
</tbody></table>
</p>

</td>
</tr>
</tbody></table>

<br>

The problem is when EN_CHANGE and EN_UPDATE.
Unlike the implications made by the table above,
for both of these messages, the control's contents have <i>already</i> changed.
The difference is <i>when</i> the message is sent.  As explained in the MSDN:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Excerpts from MSDN pages for EN_CHANGE and EN_UPDATE
</th>
</tr>
<tr>
<td>
<i>

<table cellpadding="5" width="100%">
<tbody><tr>
<td valign="top">
EN_CHANGE
</td>
<td>
<i>Unlike the EN_UPDATE notification message, this notification message is sent after the system updates the screen.</i>
</td>
</tr>
<tr>
<td valign="top">
EN_UPDATE
</td>
<td>
<i>The EN_UPDATE notification message is sent when an edit control is about to display altered text. This notification message is sent after the control has formatted the text, but before it displays the text.</i>
</td>
</tr>
</tbody></table>

</i>
</td>
</tr>
</tbody></table>

<br>

Even if a person were to take the meaning of the text's words "<i>control's contents</i>"
as the actual displaying of characters (<i>which is, perhaps, what Charles Petzold meant</i>),
the messages are explained backwards.  EN_UPDATE is sent <i>before</i> the display
is changed (<i>allowing the program to modify the size of the control before it
happens</i>), and EN_CHANGE is sent after the display is changed.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Source Code Typo</b><br>
<br>

On page 413, Chapter 9, <i>A head for Windows</i>,
the HEAD.C file uses window subclassing.  The following is the
statement that sets the new windows procedure for the listbox,
and saves the old windows procedure that the list box used to call:<br>

<br>

<code>
<pre>          OldList = (WNDPROC) SetWindowLong (hwndList, GWL_WNDPROC,
                                               (LPARAM) ListProc) ;
</pre>
</code>

Note that the third parameter to <i>SetWindowLong()</i> is supposed to be a <b>LONG</b>
value, but in the program it is type cast into an LPARAM value.  The code compiles,
since LPARAM is compatible with LONG, but it is not the proper type.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	
	</tr>		
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Text Correction</b><br>
<br>

On page 391, Chapter 9, <i>The COLORS1 Program</i>,
the sentence immediately before the line of code states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 391, Chapter 9, <i>The COLORS1 Program</i> - Error
</th>
</tr>
<tr>
<td>
<i>We can use </i>GetWindowWord<i> to get the window ID number:</i><br>
<br>
<code>
i = GetWindowLong ((HWND) lParam, GWL_ID) ;
</code>
</td>
</tr>
</tbody></table>

<br>

<i>GetWindowWord()</i> is an obsolete function, and the code sample
does not use it.  It uses the proper function, <i>GetWindow<b>Long</b>()</i>.
The correct text is as follows:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 391, Chapter 9, <i>The COLORS1 Program</i> - Correction
</th>
</tr>
<tr>
<td>
<i>We can use </i>GetWindow<b>Long</b><i> to get the window ID number:</i><br>
<br>
<code>
i = GetWindowLong ((HWND) lParam, GWL_ID) ;
</code>
</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
			
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 10: Additional Information</b><br>
<br>

On page 357, Chapter 9, <i>Child Window Controls</i>,
in the last paragraph, the text states:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
<i>Page 357, Chapter 9, <i>Child Window Controls</i>
</i></th>
</tr>
<tr>
<td>
"<i>What would message be set to?
Well, anything you want, really,
as long as the numeric value is set to WM_USER or above.
These numbers represent a range of messages that do not
conflict with the predefined WM_ messages.</i>"
</td>
</tr>
</tbody></table>

<br>
However, WM_APP is a safer alternative.  This is what MSDN
states about the differences between
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesmessages/wm_user.asp">WM_USER</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesmessages/wm_app.asp">WM_APP</a>:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
MSDN page on 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesmessages/wm_user.asp">WM_USER</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesmessages/wm_app.asp">WM_APP</a>:
</th>
</tr>
<tr>
<td>
"<i>Message numbers in the second range (<b>WM_USER</b> through 0x7FFF) can be defined and used by an application to send messages within a private window class. These values cannot be used to define messages that are meaningful throughout an application, because some predefined window classes already define values in this range. For example, predefined control classes such as BUTTON, EDIT, LISTBOX, and COMBOBOX may use these values. Messages in this range should not be sent to other applications unless the applications have been designed to exchange messages and to attach the same meaning to the message numbers.<br>
<br>
Message numbers in the third range (<b>WM_APP</b> through 0xBFFF) are available for application to use as private messages. Message in this range do not conflict with system messages.</i>"
</td>
</tr>
</tbody></table>

<br>
For example, the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxfunctions/isdialogmessage.asp">IsDialogMessage() Function</a>
can send the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxmessages/dm_getdefid.asp">DM_GETDEFID</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxmessages/dm_setdefid.asp">DM_SETDEFID</a>
messages to the window, which are defined as
WM_USER and WM_USER+1
in the winuser.h header file.
Therefore, I would suggest using WM_APP+<i>n</i> instead of WM_USER+<i>n</i>
in the creation of your own message values.<br>
<br>
I also suggest reading an article by Joseph M. Newcomer on
<i><a href="http://www.codeproject.com/dialog/MessageMgmt.asp">Message Management</a></i>,
which explains his thoughts about managing user defined messages,
and an article on Raymond Chen's blog, <i><a href="http://weblogs.asp.net/oldnewthing/">The Old New Thing</a></i>,
<i><a href="http://weblogs.asp.net/oldnewthing/archive/2003/12/02/55914.aspx">Which message numbers belong to whom?</a></i>,
which explains in detail the differences between all four types of Windows message numbers.<br>
<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
			
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 11: Better Code</b><br>
<br>

On page 368, Chapter 9, <i>Check Boxes</i>,
the book explains what you must pass in the
<i>wParam</i> parameter in a
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessage.asp">SendMessage()</a>
call when sending a
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bm_setcheck.asp">BM_SETCHECK Message</a>
to a check box control to set or remove the check mark:<br>
<br>
"<i>The wParam parameter is set to 1 to create a check mark and to 0 to remove it.</i>"<br>
<br>
While this statement is correct, the
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bm_setcheck.asp">BM_SETCHECK Message</a>
has identifiers already created that hold these values, so you need not remember them.
They are:
<ul>
<li><i>BST_CHECKED</i> is defined as 1, which sets the button state to checked.
</li><li><i>BST_UNCHECKED</i> is defined as 0, which sets the button state to cleared.
</li><li><i>BST_INDETERMINATE</i> is defined as 2, which sets the button state to grayed,
indicating an indeterminate state. (<i>This is only used for buttons with the
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonstyles.asp">BS_3STATE</a>
or
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonstyles.asp">BS_AUTO3STATE</a>
style</i>).
</li></ul>
Charles Petzold exclusively uses the numeric values, rather than the identifiers, throughout his book
(<i>with one exception: the PICKFONT.C program in Chapter 17, on page 1018</i>).
However, it would be better to use the identifiers so that your code is more readable,
and that your code continues to work in the extremely unlikely chance that these values should ever change.
Notice that this will make the nifty first
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessage.asp">SendMessage()</a>
example on page 368 a little more difficult to pull off.
An alternative is to use the
<a href="http://msdn.microsoft.com/library/en-us/vclang/html/_pluslang_Expressions_with_the_Conditional_Operator.asp">conditional operator</a>
as in the following example:<br>
<br>
<code>
<pre>SendMessage ((HWND) lParam, BM_SETCHECK, (WPARAM)
    (SendMessage ((HWND) lParam, BM_GETCHECK, 0, 0) == BST_CHECKED
        ? BST_UNCHECKED // uncheck it, if checked
        : BST_CHECKED), // check it, if unchecked
    0) ;
</pre>
</code>
<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

			
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 12: Source Code Bug</b><br>
<br>
On page 415, Chapter 9, <i>HEAD.C</i>,
the <i>ListProc()</i> function
exists as our own window procedure for the list box control.
This is known as
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowprocedures/aboutwindowprocedures.asp">windows subclassing</a>,
first explained on page 393, Chapter 9, <i>Windows Subclassing</i>.
This windows procedure is run first,
to handle additional functionality desired
(<i>in this case, we wish for the ENTER key press to signal a double click on the current selection</i>).
Our windows procedure call the original windows procedure
to handle all of the pre-programmed functionality of the window.<br>
<br>
A bug exists within this windows procedure.
The following <i>if</i> statement contains the bug:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 415, Chapter 9, <i>HEAD.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>     if (message == WM_KEYDOWN &amp;&amp; wParam == VK_RETURN)
          SendMessage (GetParent (hwnd), WM_COMMAND, 
                       MAKELONG (1, LBN_DBLCLK), (LPARAM) hwnd) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

The problem is in the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/makelong.asp">MAKELONG Macro</a>.
It combines two WORDs to create a LONG.
The first parameter is the low-order WORD,
the second is the high-order WORD.
The LONG we are creating is the WPARAM parameter for the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_command.asp">WM_COMMAND Notification</a>
we are sending to the list box window to simulate a double click.
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_command.asp">WM_COMMAND</a>
expects its WPARAM parameter to have the notification code stored in the high-order WORD,
and the identifier of the control in the low-order WORD.
The high-order WORD is correct, as it equals
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/listboxes/listboxreference/listboxmessages/lbn_dblclk.asp"><i>LBN_DBLCLK</i></a>,
which is the proper notification code for a double click.
The low-order WORD is incorrect, although it contains the proper numeric constant.
It should be the identifier of the control,
which is <i>ID_LIST</i>, defined at the top of the program on page 411,
which is passed to the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/createwindow.asp">CreateWindow()</a>
function on page 413 to create the list box.
If this definition were to ever change, then the window subclassing would not work.
Change <i>ID_LIST</i> to anything other than 1, and you will see our subclassed windows procedure fail.
Although the program, as is, still <i>works</i>, it is still a <i>bug</i>.
Why?  Because the code does not maintain the usage of this value automatically throughout itself,
which is the purpose of the definition to begin with.
The definition also helps ensure the code is readable, to yourself and others.<br>
<br>
Fix the bug by changing the <i>1</i> to <i>ID_LIST</i>, as follows:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 415, Chapter 9, <i>HEAD.C</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>     if (message == WM_KEYDOWN &amp;&amp; wParam == VK_RETURN)
          SendMessage (GetParent (hwnd), WM_COMMAND, 
                       MAKELONG (<b>ID_LIST</b>, LBN_DBLCLK), (LPARAM) hwnd) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

Now you can change <i>ID_LIST</i> to any value you want,
except, of course, the value of the other child windows in its parent.
In this case, set it to anything other than what <i>ID_TEXT</i> is set to,
and the windows subclassing will still work as expected, unlike before.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

			
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 13: Improper Subclass Implementation</b><br>
<br>
On page 385, Chapter 9, in the <i>COLORS1.C</i> program,
and on page 411, Chapter 9, in the <i>HEAD.C</i> program,
the programs use
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowprocedures/aboutwindowprocedures.asp">windows subclassing</a>.
However, the code does not remove the subclass when the window terminates.
As explain in
<a href="http://weblogs.asp.net/oldnewthing/archive/2003/11/11/55653.aspx">Raymond Chen's blog</a>:
"<i>One gotcha that isn't explained clearly in the documentation is that
you must remove your window subclass before the window being subclassed is destroyed.</i>"<br>
<br>
Because the code in these programs have nothing to clean up, they are technically ok.
However, if the subclass allocated memory or did something else which had to be cleaned up before termination,
then they would be improper.  It is best to explicitly clean up all subclassed windows to ensure proper code.
Note the available functions at your disposal mentioned in Raymond Chen's article,
which are explained on the
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/userex/subclassingcontrols.asp">MSDN article, Subclassing Controls</a>.<br>

<br>

The problem also exists on page 1336, Chapter 22, in the <i>WAKEUP.C</i> program.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

			
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 14: Logic Error</b><br>
<br>
On page 407, Chapter 9, <i>A Simple List Box Application</i>, in the <i>ENVIRON.C</i> program,
the <i>FillListBox</i> function has a logic error.
The function uses the
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/getenvironmentstrings.asp">GetEnvironmentStrings</a>
function to
receive a pointer to the environment block,

and the
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/freeenvironmentstrings.asp">FreeEnvironmentStrings</a>
function to free this block.
As you can see within the code, the function stores the results of GetEnvironmentStrings
into <i>pVarBlock</i>, and then later passes this variable to FreeEnvironmentStrings.
The problem is, is that <i>pVarBlock</i> is modified in the meantime.
If you were to check the return value for FreeEnvironmentStrings,
you will see it is 0, indicating an error.
Calling
<a href="http://msdn.microsoft.com/library/en-us/debug/base/getlasterror.asp">GetLastError</a>
will show the error code 87 (<i>ERROR_INVALID_PARAMETER</i>).<br>
<br>

To fix this, we must merely store the original return value of GetEnvironmentStrings
in a variable that will not be modified, and pass this unchanged value to FreeEnvironmentStrings.
This can be accomplished as follows:<br>
<br>

Change this line of code:
<code>
<pre>pVarBlock = GetEnvironmentStrings () ; // Get pointer to environment block 
</pre>
</code>
Into this:
<code>
<pre><b>TCHAR* pEBlock;</b>
<b>pEBlock</b> = GetEnvironmentStrings () ;	// Get pointer to environment block
pVarBlock<b> = pEBlock</b>;
</pre>
</code>
<br>

And change this line of code:
<code>
<pre>FreeEnvironmentStrings (pVarBlock) ; 
</pre>
</code>
Into this:
<code>
<pre>FreeEnvironmentStrings (<b>pEBlock</b>) ;
</pre>
</code>

<br>

<p align="right"><i>Credit: John Callas</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter10"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 10 - Menus and Other Resources</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Text Correction</b><br>
<br>

On page 471, Chapter 10, <i>Loading the Accelerator Table</i>,
the last paragraph states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 471, Chapter 10, <i>Loading the Accelerator Table</i>
</th>
</tr>
<tr>
<td>
<i>As with icons, cursors, and menus,
you can use a number for the accelerator table name and then use that
number in the </i>LoadAccelerators<i> statement with the MAKEINTRESOURCE macro or
enclosed in quotation marks and preceded by a # character.</i>
</td>
</tr>
</tbody></table>

<br>

The last part should read: "<i>...or enclosed in the TEXT macro with quotation marks and preceded by a #
character.</i>" as it was explained on page 426, Chapter 10, <i>Getting a Handle on Icons</i>:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 426, Chapter 10, <i>Getting a Handle on Icons</i>
</th>
</tr>
<tr>
<td>
<i>You can reference the icon using one of two methods. The obvious one is this:</i><br>

<br>

<code>
hIcon = LoadIcon (hInstance, MAKEINTRESOURCE (125)) ;<br>
</code>

<br>

<i>The obscure method is this:</i><br>

<br>

<code>
hIcon = LoadIcon (hInstance, TEXT ("#125")) ;<br>
</code>

<br>

<i>Windows recognizes the initial # character as prefacing a number in ASCII form.</i>
</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>		
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Source Code Error</b><br>
<br>

On page 476, Chapter 10, the POPPAD2.C has an error in its code.
The WM_COMMAND section of the code reads as follows:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
page 476, Chapter 10, <i>POPPAD2.C</i>
</th>
</tr>
<tr>
<td>
<pre>case WM_COMMAND:
     if (lParam)
     {
          if (LOWORD (lParam) == ID_EDIT &amp;&amp;
                    (HIWORD (wParam) == EN_ERRSPACE ||
                     HIWORD (wParam) == EN_MAXTEXT))
               MessageBox (hwnd, TEXT ("Edit control out of space."),
                           szAppName, MB_OK | MB_ICONSTOP) ;
          return 0 ;
     }
     else ...
</pre>
</td>
</tr>
</tbody></table>

<br>

The following line:<br>
<br>
<code>
           if (LOWORD (lParam) == ID_EDIT &amp;&amp;<br>
</code>
<br>
should be:<br>
<br>
<code>
           if (LOWORD (<b>w</b>Param) == ID_EDIT &amp;&amp;<br>
</code>

<br>

<i>lParam</i> is a HWND, which is the handle of the control (<i>which can be NULL, if
it is not a control</i>), which we have already tested to make sure we are processing
a control.  <i>wParam</i>'s HIWORD is the notification code, and its LOWORD is the
control id, which is what should be tested against ID_EDIT.<br>
<br>
Without this fix, the code compiles and runs fine, with the exception that
the message box for an 'out of space' error is not displayed if the edit control is
filled.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>		

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Misleading Text</b><br>
<br>

On page 441, Chapter 10, <i>Defining the Menu</i>,
the text mentions that a \a character in the menu caption character
string will right justify the text that follows it:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 441, Chapter 10, <i>Defining the Menu</i>
</th>
</tr>
<tr>
<td>
<i>For items in popup menus, you can use the columnar tab character \t in
the character string. Text following the \t is placed in a new column
spaced far enough to the right to accommodate the longest text string in
the first column of the popup. We'll see how this works when we look at
keyboard accelerators toward the end of this chapter. A \a in the character
string right-justifies the text that follows it.</i>
</td>
</tr>
</tbody></table>

<br>

Some clarification is needed:  The \a does not merely right-justify
text that follows it, it also acts as a tab character to move text
the follows it into a new column.
Also, the \a character does not work with the \t tab character at the same time
(<i>whether it is in the same menu item,
or even in a different menu item in the same menu</i>).
They are to be used mutually exclusive of each other, in the same menu,
as they both refer to two <i>different</i> tab columns.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>		
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Additional Information</b><br>
<br>

On page 471, Chapter 10, <i>The Accelerator Table</i>,
the text fails to method the possibility of using the /a
character, which acts as a tab character as well, except
the text is right-justified.<br>
<br>
Please note that you cannot use both the /a and /t characters
within the same menu (<i>even for different menu items</i>),
as they both refer to two <i>different</i> tab positions.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>		
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Source Code Typos</b><br>
<br>

On page 481, Chapter 10, <i>Processing the Menu Options</i>,
the page shows logic used in the POPPAD2.C program,
but the identifiers for each message defined in RESOURCE.H (and used in
poppad2.c) differ from the ones shown here.
Specifically, use the following table to replace
the incorrect identifiers with the correct ones:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 481, Chapter 10, <i>Processing the Menu Options</i>
</th>
</tr>
<tr>
<td align="center">

<table border="1" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Incorrect Identifiers
</th>
<th>
Corrected Identifiers
</th>
</tr>
<tr>
<td>
<pre>case IDM_UNDO :

case IDM_CUT :

case IDM_COPY :
 
case IDM_PASTE :

case IDM_DEL :

case IDM_SELALL :

case IDM_ABOUT :

case IDM_EXIT :
</pre>
</td>
<td>
<pre>case IDM_<b>EDIT_</b>UNDO :

case IDM_<b>EDIT_</b>CUT :

case IDM_<b>EDIT_</b>COPY :
 
case IDM_<b>EDIT_</b>PASTE :

case IDM_<b>EDIT_CLEAR</b> :

case IDM_<b>EDIT_SELECT_ALL</b> :

case IDM_<b>APP_</b>ABOUT :

case IDM_<b>APP_</b>EXIT :
</pre>
</td>
</tr>
</tbody></table>

</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>		
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Source Code Typos</b><br>
<br>

On page 481, chapter 10, <i>Processing the Menu Options</i>,
the following program code has a typo in it:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 481, chapter 10, <i>Processing the Menu Options</i>
</th>
</tr>
<tr>
<td>
<pre>case IDM_DEL :
     SendMessage (hwndEdit, WM_DEL, 0, 0) ;
     return 0 ;
</pre>
</td>
</tr>
</tbody></table>

<br>

The WM_DEL message does not exist.  It should be WM_<b>CLEAR</b>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Source Code Error</b><br>
<br>

On page 434, Chapter 10, <i>Custom Resources</i>,
in the POEPOEM.C program, there is a mistake with
the WM_VSCROLL message.<br>
<br>
The switch statement in the book is like so:<br>
<br>
<code>
          switch (wParam)<br>
</code>
<br>
It should be:<br>
<br>
<code>
          switch (<b>LOWORD(</b>wParam<b>)</b>)<br>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Source Code Errors</b><br>
<br>

On page 435, Chapter 10, <i>Custom Resources</i>,
in the POEPOEM.C program, there is a mistake with
the WM_VSCROLL message, where it handles the 
SB_THUMBPOSITION scroll bar value.<br>
<br>
The book uses the following code:<br>
<br>
<code>
               iPosition = LOWORD (lParam) ;<br>
</code>
<br>
The code should read as follows:<br>
<br>
<code>
               iPosition = <b>HI</b>WORD (<b>w</b>Param) ;<br>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Correction</b><br>
<br>

On page 472, Chapter 10, <i>Translating the Keystrokes</i>,
the first sentence in the third paragraph mentions:<br>
<br>
"<i>The hwnd parameter in TranslateMessage looks a little out of place because it's not required in the other three functions in the message loop.</i>"<br>
<br>
It should read:<br>
<br>
"<i>The hwnd parameter in <b>TranslateAccelerator</b> looks a little out of place because it's not required in the other three functions in the message loop.</i>"<br>
<br>
The
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/translatemessage.asp">TranslateMessage</a>
does not have a hwnd parameter, and the other three functions
that do no have a hwnd parameter that the text refers to are
GetMessage, TranslateMessage and DispatchMessage.
<a href="http://msdn.microsoft.com/library/en-us/winui/WinUI/WindowsUserInterface/UserInput/KeyboardAccelerators/KeyboardAcceleratorReference/KeyboardAcceleratorFunctions/TranslateAccelerator.asp">TranslateAccelerator</a>
is the only function out of the four mentioned in the code example on page 471, that
the text is speaking about, that has a hwnd parameter.

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 10: Improved Explanation</b><br>
<br>

On page 428, Chapter 10, <i>Using Customized Cursors</i>,
the text explains that the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowclasses/windowclassreference/windowclassfunctions/setclasslong.asp">SetClassLong function</a>
(<i>since superseded by the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowclasses/windowclassreference/windowclassfunctions/setclasslongptr.asp">SetClassLongPtr function</a></i>)
can be used to allow the cursor to appear differently over a window.
However, the text fails to mention the implications of the fact that this function changes the window class of the window handle passed in.
Changing the window's class affects all windows created with this class, not just the window whose handle you passed in.
If you wish to affect only one particular window, such as making a static control into a hypertext link (<i>clickable URL</i>)
in which the cursor looks like a hand when it passes over it, then you should use the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/cursors/cursorreference/cursorfunctions/setcursor.asp">SetCursor function</a>
in response to the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/mouseinput/mouseinputreference/mouseinputmessages/wm_mousemove.asp">WM_MOUSEMOVE notification</a>
of that window.  This can only be done with Window Subclassing (<i>explained in Chapter 9, page 393</i>),
which affects only the particular window whose behaviour you wish to modify.

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 11: Alternate Method</b><br>
<br>

On page 428, Chapter 10, <i>Using Customized Cursors</i>,
the text explains to use the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/mouseinput/mouseinputreference/mouseinputmessages/wm_mousemove.asp">WM_MOUSEMOVE Notification</a>
to perform a
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/cursors/cursorreference/cursorfunctions/setcursor.asp">SetCursor function</a>
call.
However, it is more precise, but no better, to use the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/cursors/cursorreference/cursormessages/wm_setcursor.asp">WM_SETCURSOR Notification</a>
to perform this call.  Please note the unique return value required for WM_SETCURSOR:<br>
"<i>If an application processes this message, it should return TRUE to halt further processing or FALSE to continue.</i>"

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 12: Clean Up Mistake</b><br>
<br>
On page 456, Chapter 10, <i>Floating Popup Menus</i>, in the POPMENU.C program,
the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmessages/wm_destroy.asp">WM_DESTROY</a>
handler is missing some code for proper clean up.

On page 455, the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menufunctions/loadmenu.asp">LoadMenu() function</a>
is called within the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmessages/wm_create.asp">WM_CREATE</a> handler.
But this menu is never destroyed with
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menufunctions/destroymenu.asp">DestroyMenu()</a>
in the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmessages/wm_destroy.asp">WM_DESTROY</a> handler.<br>

<br>

The 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menufunctions/destroymenu.asp">MSDN documentation on DestroyMenu()</a>
states:<br>
"<i>Before closing, an application must use the <b>DestroyMenu</b> function to destroy a menu not assigned to a window.
A menu that is assigned to a window is automatically destroyed when the application closes.</i>"<br>

<br>

I believe it means that the menu is automatically destroyed when the window is destroyed.
Also, I believe what is meant by 'assigned to a window' is when a menu is passed into the

<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/createwindow.asp">CreateWindow()</a> function
with the <i>hMenu</i> parameter,
which identifies the menu to be used with the window.
Note that the <i>hMenu</i> parameter can be NULL, which indicates that the class menu will be used.
Either way, a menu is 'attached' to the window, and will be automatically destroyed when the window is destroyed.<br>

<br>

To fix this bug, add a DestroyMenu() call
as the first statement in the WM_DESTROY handler, like so:
<code>
<pre>	case WM_DESTROY:
		<b>DestroyMenu(hMenu);</b>
		PostQuitMessage (0) ;
		return 0 ;
</pre>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 13: Context Menu Mistake</b><br>
<br>
On page 455, Chapter 10, <i>Floating Popup Menus</i>, in the POPMENU.C program,
Charles Petzold uses the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/mouseinput/mouseinputreference/mouseinputmessages/wm_rbuttonup.asp">WM_RBUTTONUP Notification</a>
to determine if the user clicked the right mouse button and released it,
thus signaling the desire for a context menu to appear.
However, a context menu should appear in multiple ways:
<ol>
<li>The right mouse button was clicked and released.
</li><li>Shift+F10 was pressed.
</li><li>The context menu key was pressed on the keyboard.
</li></ol>
Thus, using only WM_RBUTTONUP is improper.
The proper way to handle a context menu is with the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_contextmenu.asp">WM_CONTEXTMENU Notification</a>.
Observant readers will note that the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_contextmenu.asp">MSDN page for WM_CONTEXTMENU</a> states its purpose <i>incorrectly</i>:<br>

<br>

"<i>The <b>WM_CONTEXTMENU</b> message notifies a window that the user clicked the right mouse button (<i>right-clicked</i>) in the window.</i>"<br>

<br>

The MSDN documentation is wrong!
The WM_CONTEXTMENU message <i>actually</i> notifies a window
that the user desires a context menu to appear (which could happen in any of the above mentioned ways).<br>
<br>
Thus, we will have to replace this incorrect code:
<code>
<pre>     case WM_RBUTTONUP:
          point.x = LOWORD (lParam) ;
          point.y = HIWORD (lParam) ;
          ClientToScreen (hwnd, &amp;point) ;
          
          TrackPopupMenu (hMenu, TPM_RIGHTBUTTON, point.x, point.y, 
                          0, hwnd, NULL) ;
          return 0 ;
</pre>
</code>
with the following correct code:
<code>
<pre>     case <b>WM_CONTEXTMENU:</b>
          <b>point.x = GET_X_LPARAM (lParam) ;
          point.y = GET_Y_LPARAM (lParam) ;	
          if ((point.x == -1) &amp;&amp; (point.y == -1))
          {
               point.x = 0;
               point.y = 0;
               ClientToScreen (hwnd, &amp;point);
          }</b>

          TrackPopupMenu (hMenu, TPM_RIGHTBUTTON, point.x, point.y, 
                          0, hwnd, NULL) ;
          return 0 ;
</pre>
</code>
You will also need to include the following line at the top of the program,
which is required for the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/get_x_lparam.asp">GET_X_LPARAM</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/get_y_lparam.asp">GET_Y_LPARAM</a>
macros:<br>

<br>

<code>
#include &lt;windowsx.h&gt;<br>
</code>

<br>

Explanation of new code:<br>

<ul>
<li>
Note that the call to
<a href="http://msdn.microsoft.com/library/en-us/gdi/cordspac_2tny.asp">ClientToScreen()</a>
is no longer needed to convert the coordinates from the <i>lParam</i> parameter,
since 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_contextmenu.asp">WM_CONTEXTMENU</a>
returns the coordinates in screen coordinates already.
We do, however, use it to convert the client area coordinates (0,0) into screen coordinates
within the if-statement whose purpose is explained below.<br>

<br>

</li><li>
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menumessages/wm_contextmenu.asp">WM_CONTEXTMENU</a>
returns (-1,-1) for the (x,y) coordinates if the context menu
was created from the keyboard, as there was no mouse click.
The
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/loword.asp">LOWORD</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/hiword.asp">HIWORD</a>
macros return a 
<a href="http://msdn.microsoft.com/library/en-us/winprog/winprog/windows_data_types.asp">WORD type</a>,
which is an
<code>unsigned short</code>, 
which isn't good, since it doesn't allow storage of negative screen coordinates
that could occur on multiple monitor systems,
and it makes it complicated to test them against (-1,-1).
Therefore, I replaced these with new macros that were made
specifically for extracting coordinate data
from the <i>lParam</i> parameter:
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/get_x_lparam.asp">GET_X_LPARAM</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/get_y_lparam.asp">GET_Y_LPARAM</a>.
These return the proper <i>signed</i> values.<br>

<br>

</li><li>
The WM_CONTEXTMENU documentation states:<br>

<br>

"<i>If the context menu is generated from the keyboard — for example, if the user types SHIFT+F10 —
then the x- and y-coordinates are -1 and the application should display the context menu
at the location of the current selection rather than at (xPos, yPos).</i>"<br>

<br>

Since we do not have a selection, I chose to use the the upper-left corner of the client area,
which is (0,0) in client area coordinates.  I use the
<a href="http://msdn.microsoft.com/library/en-us/gdi/cordspac_2tny.asp">ClientToScreen() function</a>
to convert this into the needed screen coordinates.
Note that it is a bad idea to use the current position of the mouse,
since the mouse could be positioned over another window, and it would
appear as though the context menu is owned by the incorrect window..<br>
</li></ul>


<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 14: </b><br>
<br>

On page 450, Chapter 10, <i>Custom Resources</i>, the last two lines read:<br>

<code>
<pre>	iSelection = wParam ; 
	CheckMenuItem (hMenu, iSelection, MF_CHECKED) ;
</pre>
</code>

You will note on page 447, in <i>MENUDEMO.C</i>, the above was quoted
from the following line:<br>

<code>
<pre>	iSelection = <b>LOWORD(</b>wParam<b>)</b> ;
</pre>
</code>

The proper code is in the program, not the text.
Thus, the text should be corrected as follows:<br>

<code>
<pre>	iSelection = <b>LOWORD(</b>wParam<b>)</b> ;
	CheckMenuItem (hMenu, iSelection, MF_CHECKED) ;
</pre>
</code>

Also, the text explaining the code, which is directly above it,
must be changed, as well.  Change the incorrect text:<br>

<br>

"<i>The iSelection value is set to the <b>value</b> of wParam, and the new background color is checked:</i>"<br>

<br>

to the following:<br>

<br>

"<i>The iSelection value is set to the <b>low-order word</b> of wParam, and the new background color is checked:</i>"<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis and <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 15: Source Code Typos</b><br>
<br>

On page 480, Chapter 10, <i>Enabling Menu Items</i>,
the page shows two code statements
that are used in the POPPAD2.C program,
but the identifiers for each message defined in RESOURCE.H
(and used in poppad2.c) differ from the ones shown here.<br>

<br>

Specifically, change:<br>

<code>
<pre>	EnableMenuItem (wParam, IDM_UNDO,
</pre>
</code>

into:<br>

<code>
<pre>	EnableMenuItem (wParam, IDM_<b>EDIT_</b>UNDO,
</pre>
</code>

And, change:<br>

<code>
<pre>	EnableMenuItem (wParam, IDM_PASTE,
</pre>
</code>

into:<br>

<code>
<pre>	EnableMenuItem (wParam, IDM_<b>EDIT_</b>PASTE,
</pre>
</code>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 16: Source Code Typos</b><br>
<br>

On page 508, Chapter 10, <i>The OK and Cancel Buttons</i>,
in the case statement at the bottom of the page,
the following:<br>

<code>
<pre>	case IDM_ABOUT:
</pre>
</code>

should be:<br>

<code>
<pre>	case IDM_<b>APP_</b>ABOUT:
</pre>
</code>

You can see this proper name on page 503,
in the ABOUT2.RC file.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter11"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 11 - Dialog Boxes</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Source Code Correction</b><br>
<br>

On page 506, Chapter 11, <i>Working with Dialog Box Controls</i>,
there is an explanation of the <i>SendDlgItemMessage()</i>
function:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 506, Chapter 11, <i>Working with Dialog Box Controls</i>
</th>
</tr>
<tr>
<td>
<code>
SendDlgItemMessage (hDlg, id, iMsg, wParam, lParam) ;<br>
</code>

<br>

<i>It is equivalent to</i><br>

<br>

<code>
SendMessage (GetDlgItem (hDlg, id), id, wParam, lParam) ;<br>
</code>

</td>
</tr>
</tbody></table>

<br>

Note that the second parameter (<i>the second </i>id<i> in the statement</i>)
in the <i>SendMessage()</i> example is incorrect.
It should be <b><i>iMsg</i></b>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Source Code Typo</b><br>
<br>

On page 512, Chapter 11, <i>Painting on the Dialog Box</i>,
it explains:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 512, Chapter 11, <i>Painting on the Dialog Box</i>
</th>
</tr>
<tr>
<td>
<i>In </i>AboutDlgProc<i>, the window handle </i>hCtrlBlock<i>
had been set during the processing of the WM_INITDIALOG message:</i><br>

<br>

<code>
hCtrlBlock = GetDlgItem (hDlg, IDD_PAINT) ;<br>
</code>

</td>
</tr>
</tbody></table>

<br>

However, the control id is not IDD_PAINT.  It is ID<b>C</b>_PAINT.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Source Code Correction</b><br>
<br>

On page 519, Chapter 11, <i>Defining Your Own Controls</i>,
the sample code for the EllipPush window class (<i>at
the top of the page</i>) has an error.  This line:<br>
<br>
<code>
wndclass.hbrBackground = (HBRUSH) (COLOR_WINDOW + 1) ;<br>
</code>
<br>
should be:<br>
<br>
<code>
wndclass.hbrBackground = (HBRUSH) (COLOR_<b>BTNFACE</b> + 1) ;<br>
</code>
<br>
just as it is in the source code of ABOUT3.C.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Explanation Improvement</b><br>
<br>

On page 523, Chapter 11, <i>Differences Between Modal and Modeless Dialog Boxes</i>,
the text explains how to end a modeless dialog box with
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/destroywindow.asp">DestroyWindow()</a>.
However, it fails to mention that the parent window will destroy it when it
ends, even though this is the method you use for termination with COLORS2.C,
and it is implied by the explanation of COLORS2.C's message loop on pages
528 - 529.<br>
<br>
I think it would be clearer if the text explained
that the dialog box is destroyed at the end of the program,
even if you do not destroy it yourself.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Text Format Inconsistency</b><br>
<br>

On page 538, Chapter 11, <i>The Common Dialog Boxes</i>,
the last paragraph states a reference to:
<i>/Platform SDK/User Interface Services/User Input/Common Dialog Box Library</i>.
However, it is not italicized, like the rest of the references to the MSDN
Library.<br>
<br>
Please note: This erratum is obviously of no
real concern to the reader.
It is only included for completeness, in case
Charles Petzold reviews this page for corrections to the next
version of
<i><a href="http://www.charlespetzold.com/ProgWinEditions.html">Programming Windows</a></i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Calculation Error</b><br>
<br>

On page 490, Chapter 11, <i>The Dialog Box and Its Template</i>,
at the end of the second paragraph on the page,
the text states:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 490, Chapter 11, <i>The Dialog Box and Its Template</i> - Error
</th>
</tr>
<tr>
<td>
<i>Thus, for this particular dialog box, the upper left corner
of the dialog box is 5 characters from the left edge of the 
main window's client area and 2-1/2 characters from the top edge.
The dialog itself is 40 characters wide and 10 characters high.</i>
</td>
</tr>
</tbody></table>

<br>

However, these sentences should be:<br>

<br>
   
<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 490, Chapter 11, <i>The Dialog Box and Its Template</i> - Correction
</th>
</tr>
<tr>
<td>
<i>Thus, for this particular dialog box, the upper left corner of
the dialog box is <b>8</b> characters from the left edge of the main
window's client area and <b>4</b> characters from the top edge. The 
dialog itself is <b>45</b> characters wide and <b>12-1/2</b> characters high.</i>
</td>
</tr>
</tbody></table>

<br>

As explained at the start of the same paragraph in the text:
"<i>The numbers are based on the size of the font used for the
dialog box (</i>in this case, an 8-point MS Sans Serif font<i>):
x-coordinates and width are expressed in units of 1/4 of an average character width;
y-coordinates and height are expressed in units of 1/8 of the character height.</i>"<br>
<br>

The dialog template in question is shown below,
with the coordinates in question bolded:<br>
<br>

<code>
<pre>ABOUTBOX DIALOG DISCARDABLE  <b>32, 32, 180, 100</b>
STYLE DS_MODALFRAME | WS_POPUP
FONT 8, "MS Sans Serif"

BEGIN
    DEFPUSHBUTTON   "OK",IDOK,66,80,50,14
    ICON            "ABOUT1",IDC_STATIC,7,7,21,20
    CTEXT           "About1",IDC_STATIC,40,12,100,8
    CTEXT           "About Box Demo Program",IDC_STATIC,7,40,166,8
    CTEXT           "(c) Charles Petzold, 1998",IDC_STATIC,7,52,166,8
END
</pre>
</code>

<br>

The first two coordinates (<i>32, 32</i>) are the location of top-left corner of the dialog box
in respect to the window's client area's top-left corner.
The x coordinate is 32 units from the edge.
With a unit equaling 1/4 of an average character width, it is
<a href="http://www.google.com/search?q=32*%281%2F4%29%3D">32 * 1/4 = 8</a>
characters from the edge.
Likewise, 
the y coordinate is 32 units from the edge.
With a unit equaling 1/8 of an average character width, it is
<a href="http://www.google.com/search?q=32*%281%2F8%29%3D">32 * 1/8 = 4</a>
characters from the edge.<br>
<br>

The next two coordinates (<i>180, 100</i>) specify the size of the dialog box.
The width coordinate is 180 units.
With a unit equaling 1/4 of an average character width, it is
<a href="http://www.google.com/search?q=180*%281%2F4%29%3D">180 * 1/4 = 45</a>
characters wide.
Likewise, 
the height coordinate is 100 units.
With a unit equaling 1/8 of an average character width, it is
<a href="http://www.google.com/search?q=100*%281%2F8%29%3D">100 * 1/8 = 12-1/2</a>
characters high.
   
<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Error</b><br>
<br>

On page 496, Chapter 11, <i>Variations on a Theme</i>,
the table at the top of the page shows the following
two default window styles:<br>

<br>

<table border="1" cellspacing="0" cellpadding="5" bgcolor="e0e0e0">
<tbody><tr>
<th><i>Control Type</i></th>
<th><i>Window Class</i></th>
<th><i>Window Style</i></th>
</tr>
<tr>
<td><a href="http://msdn.microsoft.com/library/en-us/tools/tools/groupbox_control.asp">GROUPBOX</a></td>
<td>button</td>
<td>BS_GROUPBOX | WS_TABSTOP</td>
</tr>
<tr><td><a href="http://msdn.microsoft.com/library/en-us/tools/tools/listbox_control.asp">LISTBOX</a></td>
<td>listbox</td>
<td>LBS_NOTIFY | WS_BORDER | WS_VSCROLL</td>
</tr>
</tbody></table>

<br>

However
<a href="http://msdn.microsoft.com/library/en-us/tools/tools/resource_definition_statements.asp">Microsoft's documentation</a>
for these controls state that
if you do not specify any window style then you will get only the following:<br>

<br>

<table border="1" cellspacing="0" cellpadding="5" bgcolor="e0e0e0">
<tbody><tr>
<th><i>Control Type</i></th>
<th><i>Window Class</i></th>
<th><i>Window Style</i></th>
</tr>
<tr>
<td><a href="http://msdn.microsoft.com/library/en-us/tools/tools/groupbox_control.asp">GROUPBOX</a></td>
<td>button</td>
<td>BS_GROUPBOX</td>
</tr>
<tr><td><a href="http://msdn.microsoft.com/library/en-us/tools/tools/listbox_control.asp">LISTBOX</a></td>
<td>listbox</td>
<td>LBS_NOTIFY | WS_BORDER</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Error</b><br>
<br>

On page 518, Chapter 11, <i>Defining Your Own Controls</i>,
the statement at the bottom of the page employs the style <i>TABGRP</i>
which does not seem to be defined anywhere:<br>
<br>

<code>
CONTROL "OK" IDOK, "EllipPush", <b>TABGRP</b>, 64, 60, 32, 14<br>
</code>

<br>

It is probably intended to mean <i>WS_TABSTOP | WS_GROUP</i>,
as the text shows on page 517, in <i>ABOUT3.RC (excerpts)</i>:<br>

<br>

<code>
<pre>ABOUTBOX DIALOG DISCARDABLE  32, 32, 180, 100
STYLE DS_MODALFRAME | WS_POPUP
FONT 8, "MS Sans Serif"
BEGIN
    CONTROL         "OK",IDOK,"EllipPush",<b>WS_GROUP | WS_TABSTOP</b>,73,79,32,14
    ICON            "ABOUT3",IDC_STATIC,7,7,20,20
    CTEXT           "About3",IDC_STATIC,40,12,100,8
    CTEXT           "About Box Demo Program",IDC_STATIC,7,40,166,8
    CTEXT           "(c) Charles Petzold, 1998",IDC_STATIC,7,52,166,8
END
</pre>
</code>
  
A search on
<a href="http://www.google.com/search?q=TABGRP">Google</a>
reveals that in most cases, when a programmer uses <i>TABGRP</i>,
they define it as a macro like so:<br>
<br>
<code>
#define TABGRP (WS_TABSTOP | WS_GROUP)<br>
</code>
<br>
This is consistent with the styles used in the code.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Typo</b><br>
<br>

On page 564, Chapter 11, <i>Search and Replace</i>,
the first paragraph makes a reference to POPFIND.C in Figure 10-11.
This should be Figure 11-11.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 10: Further Explanation</b><br>
<br>

On page 562, Chapter 11, <i>POPPAD Revisited</i>,
the book introduces the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/commondialogboxlibrary/commondialogboxreference/commondialogboxstructures/openfilename.asp">OPENFILENAME Structure</a>.
It explains that the program POPPAD.C sets the <i>hwndOwner</i> field of the structure to be
the window who owns the dialog box to be made.
However, neither Charles Petzold nor MSDN states what potential problems may occur if you set
this field to be NULL.  NULL indicates that the dialog box has no owner.<br>
<br>
If the dialog box has no owner, it acts like a modeless dialog box, rather than a modal dialog box.
This has the unfortunate side effect that the user can interact with the program's main window just
as if the dialog box did not exist.  A user could even request the application to shut down while
the dialog box is still open.  It is therefore a good idea to always give a File Open or File Save
dialog box an owner.<br>
<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 11: Cleaner Code</b><br>
<br>

On page 522, Chapter 11, <i>Differences Between Model and Modeless Dialog Boxes</i>,
the book explains how to modify the message loop for handling messages
of a modeless dialog box.
In both code sections on this page, the book uses the following comparison
to see if the modeless dialog box is currently active:<br>

<br>

<code>
hDlgModeless == 0<br>
</code>

<br>

While this code <i>works perfectly</i>, the MSDN team recommends a 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/usingdialogboxes.asp">different method</a>,
by using the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/iswindow.asp">IsWindow()</a>
function:<br>

<br>

<code>
!IsWindow(hDlgModeless)<br>
</code>

<br>

To ensure clarity, making this change will result in the following full line of code
in both code segments:<br>

<br>

<code>
if (<b>!IsWindow(hDlgModeless)</b> ¦¦ !IsDialogMessage (hDlgModeless, &amp;msg))<br>
</code>

<br>

This use of the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/iswindow.asp">IsWindow()</a>
function will replace the original example code
in any of the places that it appears elsewhere in the book.
Please note that it may exist in one of three different formats,
which all mean the exact same thing:
<ul>
<li><code>hDlgModeless == 0</code>
</li><li><code>hDlgModeless == NULL</code>
</li><li><code>!hDlgModeless</code>
</li></ul>
NULL is defined as 0.  It is the value of a pointer that points to nothing.
Therefore, comparing a handle to 0 or NULL is the same thing; you are asking
whether or not the handle points to an object that exists or not.
The
<a href="http://msdn.microsoft.com/library/en-us/vccelng/htm/operator_11.asp">Logical-NOT operator</a>
(!), when applied to a pointer whose value is 0 (<i>equivalent to false</i>),
 will return <i>true</i>.
If applied to a pointer whose value is not equal to 0 (<i>equivalent to true</i>),
it will return <i>false</i>.
Therefore, this is identical to merely comparing the pointer to NULL or 0.<br>
<br>
Please note that this original, in one of its three forms,
exists elsewhere in the book in the following locations:
<ul>
<li> Page 525, Chapter 11, in the COLORS2.C program
</li><li> Page 541, Chapter 11, in the POPPAD.C program
</li><li> Page 630, Chapter 13, in the PRINT3.C program
</li><li> Page 632, Chapter 13, <i>Adding a Printing Dialog Box</i>
</li><li> Page 634, Chapter 13, in the POPPRNT.C program
</li><li> Page 1010, Chapter 17, in the PICKFONT.C program
</li></ul>
I have not included an erratum for each of these cases
in this list, because the original code is <i>not wrong</i>.
This erratum merely explains, what the MSDN team believes to be,
a nicer solution.  As you can see, even if you do not use the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/iswindow.asp">IsWindow()</a>
function, there are at least three methods that Charles Petzold himself
uses to accomplish the same task.  It is really personal preference,
although it is desirable to have some consistency in your code.
Also, the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/iswindow.asp">IsWindow()</a>
may be much clearer to some,
especially to other programmers that may read your code.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 12: Typo</b><br>
<br>

On page 505, Chapter 11, <i>Working with Dialog Box Controls</i>,
the book states:<br>
<br>
"<i>You might recall from Chapter 9 that checking and unchecking
a button requires that you send the child window control a BM_CHECK message.</i>"<br>
<br>
There is no BM_CHECK message.
The actual message name is
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bm_setcheck.asp">BM_SETCHECK</a>,
as explained in Chapter 9, on pages 366 to 369.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 13: Implementation Error</b><br>
<br>

On page 523, Chapter 11, <i>Differences Between Modal and Modeless Dialog Boxes</i>,
and identically on page 529, Chapter 11, <i>The New COLORS Program</i>,
the book shows the following code sample:<br>
<br>
<code>
<pre>case WM_CLOSE :
     DestroyWindow (hDlg) ;
     hDlgModeless = NULL ;
     break ;
</pre>
</code>

This shows an example how to handle the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmessages/wm_close.asp">WM_CLOSE message</a>
for a modeless dialog box.
(<i>The WM_CLOSE message is sent to the dialog box procedure
when the '<u>C</u>lose' option from the system menu is selected,
the close 'x' button is pressed,
or the user presses ALT+F4 when the dialog box is in focus.</i>)
You need not always handle the WM_CLOSE message,
as there is default processing available if you do not handle it.
As explained on the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxprogrammingconsiderations.asp">Dialog Box Programming Considerations</a>
MSDN page,
its default processing is as follows:<br>
<br>
"<i>(It) posts the
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/buttons/buttonreference/buttonmessages/bn_clicked.asp">BN_CLICKED notification</a>
message to the dialog box,
specifying IDCANCEL as the control identifier.
If the dialog box has an IDCANCEL control identifier and the control is currently disabled,
the procedure sounds a warning and does not post the message.</i>"<br>
<br>
This basically states that if you let the dialog box procedure handle the WM_CLOSE message
itself, the default action is to
<a target="_top" href="http://jasondoucette.com/books/pw5/pw5errata.html#simulatebuttonpress">simulate a button press</a>
of the 'Cancel' button
(<i>which has the IDCANCEL control identifier by default when designing a
<a href="http://msdn.microsoft.com/library/en-us/vcresed/html/_asug_Overview.3a_.Dialog_Editor.asp">dialog box in the resource editor</a></i>).
Likely, the processing of the 'Cancel' button press, which you must code, destroys the dialog box.<br>
<br>
The first paragraph of text on the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxprogrammingconsiderations.asp">Dialog Box Programming Considerations</a>
MSDN page
states:
"<i>a dialog box procedure ... returns TRUE if it processes a message or FALSE if it does not</i>."
However, this is not exactly true, although you should abide by it.
Whether you return TRUE or FALSE indicates whether the default processing of the message will be carried out.
If you do not process the message, you obviously wish for the default processing to be executed,
so you return FALSE.
However, if you do process the message, you may or may not want the default processing to occur.
It is <i>highly likely</i> that if you process the message,
you do not want the default processing to occur,
and thus you return TRUE.
There is little reason to allow the default processing to occur if you are doing your own processing;
this is why the text states what it does.<br>
<br>
Getting back to the code sample from the book,
you will notice it takes charge and destroys the window on its own.
However, because it calls the <i>break</i> statement, instead of returning TRUE,
the switch statement control ends.
This ends up returning FALSE.  Why?
Because all messages that are not handled by the switch statement are not processed,
and you have to let the dialog box procedure do its default
handling for these messages.  You do that by returning FALSE for
any message that passed through the switch statement.
Because the example WM_CLOSE handler decides to break out of the switch statement,
it is subjected to the same result - returning FALSE,
which means the default processing will be carried out.
This does not make much sense, since
the default processing simulates a press of the 'Cancel' button
(<i>or, more specifically, the button whose control identifier is IDCANCEL</i>).
Since the 'Cancel' button handler, if it exists in the code that this example may be used in,
will handle the destruction of the dialog box, it makes little sense for the WM_CLOSE handler to do it.
On the other hand, if there is no 'Cancel' button, then
why would you want the WM_CLOSE handler to tell the dialog box procedure to attempt to press it?<br>
<br>
Thus, the proper solution in this code sample
is to not allow the default processing, and to tell the dialog box procedure
that you have properly handled the message yourself.
The proper code is as follows:<br>
<br>

<code>
<pre>case WM_CLOSE :
     DestroyWindow (hDlg) ;
     hDlgModeless = NULL ;
     <b>return TRUE ;</b>
</pre>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 14: Incorrect Explanation</b><br>
<br>

On page 483, Chapter 11, <i>Dialog Boxes</i>,
the second sentence states:<br>

<br>

"<i>The programmer indicates that a menu item invokes a dialog box by adding an ellipsis (...) to the menu item.</i>"<br>

<br>

However, this is not necessarily so.
<a href="http://weblogs.asp.net/oldnewthing/">Raymond Chen</a>
explains the semantics of "..." (ellipses) in one of his articles:<br>

<br>

<a href="http://weblogs.asp.net/oldnewthing/archive/2004/05/17/133181.aspx">When do you put ... after a button or menu?</a><br>

"<i>Use an ellipsis if the command requires additional information before it can be performed.
Sometimes the dialog box is the command itself, such as "About" or "Properties".
Even though they display a dialog, the dialog is the result,
as opposed to commands like "Print" where the dialog is collecting additional information
prior to the result.</i>"<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 15: Correction</b><br>
<br>

On page 483, Chapter 11, <i>Dialog Boxes</i>,
the first sentence of the third paragraph states:<br>

<br>

"<i>When a program invokes a dialog box based on a template, Microsoft Windows 98 is responsible for...</i>"<br>

<br>

However, this is true for all versions of Windows, not just Windows 98.  Therefore,
it should have simply stated "<i>...Windows is responsible for...</i>".<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 15: Typo</b><br>
<br>

On page 564, Chapter 11, <i>Unicode File I/O</i>,
the first sentence on the page states:<br>

<br>

"<i>Similarly, if the file is a non-Unicode text file but the Unicode version of the program is running, the text must be converted using MultiCharToWideChar.</i>"<br>

<br>

However, there is no MultiCharToWideChar function.  It should be
<a href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp"><b>MultiByteToWideChar</b></a>.<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 17: Inconsistent Name</b><br>
<br>

On page 518, Chapter 10, <i>Defining Your Own Controls</i>,
the file ABOUT3.C uses the icon name "icon1.ico".

However, the first two programs used “about1.ico” and “about2.ico”,
so following suit, it should be “<b>about3.ico</b>”.
On page 518, the icon image itself is shown,
and Petzold calls it “ABOUT3.ICO”.<br>
<br>
The icon filename on the source CD that accompanies the book
is called “icon1.ico”.  If it was named differently, the program would not compile.
So, if you change the above to be "about3.ico", and you are using the
icon file from the source CD, you will need to rename it to “about3.ico”, as well.<br>

<br>

Please note that the filename is arbitrary.
As long as the name in the .RC file matches the actual the filename, all is well.<br>

<br>


<p align="right"><i>Credit: Hans Dwarshuis and <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 18: Miscalculation</b><br>
<br>

On page 537, Chapter 11, <i>HEXCALC: Window or Dialog Box?</i>,
the fourth line of code shows:<br>

<code>
<pre>	102 * 4 / cxChar, 122 * 8 / cyChar,
</pre>
</code>

This line should be:<br>

<code>
<pre>	102 * <b>cxChar / 4</b>, 122 * <b>cyChar / 8</b>,
</pre>
</code>

You can see this same formula used at the bottom of page 497.
On page 496, it says to refer to chapter 9 where the sizes
specified in dialog box templates are 1/4 and 1/8 of
the average character width and height respectively,
which explains these formulas.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 19: Minor Mistype</b><br>
<br>

On page 581, Chapter 11, <i>BEYOND SIMPLE CLIPBOARD USE</i>,
the first line reads:<br>
<br>
"<i>We’ve seen that transferring text <b>from</b> the clipboard requires four calls after the data has been prepared:</i>"<br>
<br>
It should be:<br>
<br>
"<i>We’ve seen that transferring text <b>to</b> the clipboard requires four calls after the data has been prepared:</i>"<br>

<br>
It is referring to the section that starts on page 572,
which explains how to transfer text to the clipboard.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter12"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 12 - The Clipboard</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Source Code Consistency</b><br>
<br>

On page 571, Chapter 12, <i>Memory Allocation</i>,
an explanation starts in the middle of the page on
how to allocate movable memory:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 571, Chapter 12, <i>Memory Allocation</i>
</th>
</tr>
<tr>
<td>
<i>First define a pointer (for example, to an </i>int<i> type) and a variable of type
GLOBALHANDLE:</i><br>

<br>

<code>
<pre>     int * p ;
     GLOBALHANDLE hGlobal ;
</pre>
</code>

Then allocate the memory. For example:<br>

<br>

<code>
     hGlobal = GlobalAlloc (GHND, 1024) ;<br>
</code>

</td>
</tr>
</tbody></table>

<br>

However, <i>GlobalAlloc()</i> returns an HGLOBAL type,
not GLOBALHANDLE.
Also, in the source code for the CLIPTEXT.C example program that follows this,
hGlobal is declared as type HGLOBAL,
not GLOBALHANDLE:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 577, Chapter 12, <i>CLIPTEXT.C</i>
</th>
</tr>
<tr>
<td>
<code>
HGLOBAL      hGlobal ;<br>
</code>
</td>
</tr>
</tbody></table>

<br>

The code compiles with either,
as both HGLOBAL and GLOBALHANDLE are <code>typedef</code>'ed as HANDLE,
but it would make more sense to maintain consistency with the source code
sample in the text, the source code of the example program,
and the MSDN library.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Source Code Omission</b><br>
<br>

On page 578, Chapter 12, <i>The Clipboard and Unicode</i>,
in the CLIPTEXT.C program,
there is missing <i>GlobalUnlock()</i> call during processing
of the IDM_EDIT_PASTE case of the WM_COMMAND message.
The following line of code should be inserted immediately before
the <i>InvalidateRect()</i> call:<br>
<br>
<code>
GlobalUnlock (hGlobal) ;
</code>

<p align="right"><i>Credit: Doug Yip</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Typo</b><br>
<br>

On page 572, Chapter 12, <i>Transferring Text to the Clipboard</i>,
the example code showing how to copy an ANSI character string to the clipboard
uses a loop to copy each individual character from the string into the
locked memory block:<br>
<br>
<pre>for (i = 0 ; i &lt; wLength ; i++)
     *pGlobal++ = *pString++ ;
</pre>

The <i>wLength</i> variable should be <i><b>i</b>Length</i>,
as mentioned in the first paragraph of this section.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td colspan="3" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/horiz.gif" height="12"></td>
	</tr>
	
	</tbody></table>

</td>

</tr>
<tr>

<td valign="top" align="center">
<a name="section2"><font size="+1"><b>Section<br>II<br><br>More<br>Graphics</b></font></a>
</td>

<td>

	<table border="0" cellpadding="0" cellspacing="0">
	
	<tbody><tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter13"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 13 - Using the Printer</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Resource File Correction</b><br>
<br>

On page 605, Chapter 13, <i>The Revised DEVCAPS Program</i>,
the program DEVCAPS2.C is used to display device capability
information for the screen and any printers hooked up to the system.
The first menu, "Device", selects the device,
and the second menu, "Capabilities", selects what capabilities to display.
The currently selected capability for this menu is checked.
However, at the start of the program, none of the menu items within
that menu are checked (<i>even though the first one is activated by default</i>).
The program should check the first menu item on start up.<br>
<br>
This can be done in a couple of different ways.
The easiest way is to go into the resource editor,
double click the "Basic Information" menu item
under the "Capabilities" menu, and check the 
"Chec<u>k</u>ed" button, as shown in the following
image:<br>
<br>
<img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chap13prob1.gif" width="418" height="307" border="1" tag="Resource Editor for DEVCAPS2.RC, Chapter 13"><br>
<br>
This will set this menu item to be checked at program start up.<br>
<br>
If you wish to set this by manually changing the DEVCAPS2.RC resource file,
shown on page 615,
you will have to add the text ", CHECKED" to the end of the line that
describes the "Basic Information" menu item, as shown in the following code:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 615, Chapter 13, <i>DEVCAPS2.RC</i> (excerpts) - Correction 
</th>
</tr>
<tr>
<td>
<code>
<pre>DEVCAPS2 MENU DISCARDABLE 
BEGIN
    POPUP "&amp;Device"
    BEGIN
        MENUITEM "&amp;Screen",                     IDM_SCREEN, CHECKED
    END
    POPUP "&amp;Capabilities"
    BEGIN
        MENUITEM "&amp;Basic Information",          IDM_BASIC<b>, CHECKED</b>
        MENUITEM "&amp;Other Information",          IDM_OTHER
        MENUITEM "&amp;Curve Capabilities",         IDM_CURVE
        MENUITEM "&amp;Line Capabilities",          IDM_LINE
        MENUITEM "&amp;Polygonal Capabilities",     IDM_POLY
        MENUITEM "&amp;Text Capabilities",          IDM_TEXT
    END
END
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

A third method to solve this problem is to add code to the
WM_CREATE message handling code to set this value to be checked.
This is not standard procedure, but I will show you how it
is done, regardless.  At the end of the WM_CREATE message
handling code on page 607, add the following:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 607, Chapter 13, <i>DEVCAPS2.C</i> - Additional Code
</th>
</tr>
<tr>
<td>
<code>
<pre>          hMenu = GetMenu (hwnd) ;
          CheckMenuItem (hMenu, nCurrentInfo, MF_CHECKED) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

The code retrieves the handle to the menu assigned to <i>hwnd</i>
with the <i>GetMenu()</i> function, and uses this as a parameter
into the <i>CheckMenuItem()</i> function to set the state of
menu item <i>nCurrentInfo</i> check mark attribute to checked.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Code Clarification</b><br>
<br>

On page 621, Chapter 13, <i>PRINTING GRAPHICS AND TEXT</i>,
the source code listing for PRINT.C has the following
statement in the WM_CREATE message handling code:<br>
<br>
<code>
AppendMenu (hMenu, 0, 1, TEXT ("&amp;Print")) ;<br>
</code>
<br>
It uses 0 as the second parameter, which is equivalent to MF_STRING.
The code should use MF_STRING to make it clear on what it is doing,
as follows:<br>
<br>
<code>
AppendMenu (hMenu, <b>MF_STRING</b>, 1, TEXT ("&amp;Print")) ;<br>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Potential Bug</b><br>
<br>

On page 621, Chapter 13, <i>PRINTING GRAPHICS AND TEXT</i>,
the source code listing for PRINT.C has a
potential bug in the WM_SYSCOMMAND message handling code:<br>
<br>
<code>
<pre>     case WM_SYSCOMMAND:
          if (wParam == 1)
          {
               ...
</pre>
</code>
<br>
Since the menu item we added was to the window menu
(<i>formerly known as the system or control menu</i>),
we must process the WM_SYSCOMMAND message.
However, the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardaccelerators/keyboardacceleratorreference/keyboardacceleratormessages/wm_syscommand.asp">MSDN page for WM_SYSCOMMAND</a>
states:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardaccelerators/keyboardacceleratorreference/keyboardacceleratormessages/wm_syscommand.asp">MSDN page for WM_SYSCOMMAND</a>
</th>
</tr>
<tr>
<td>
<i>In <b>WM_SYSCOMMAND</b> messages, the four low-order bits of the </i>wParam<i>
parameter are used internally by the system. To obtain the correct
result when testing the value of </i>wParam<i>, an application must
combine the value 0xFFF0 with the </i>wParam<i> value by using the
bitwise AND operator.</i>
</td>
</tr>
</tbody></table>

<br>

It is not clear that this is required for user created menu items,
however I have not seen any evidence that shows any problems
with using user create menu item identification numbers that
are not multiples of 16, even when using keyboard accelerators.
It may be wise to use identification numbers that are multiples
of 16, and to AND the <i>wParam</i> value within WM_SYSCOMMAND
with 0xFFF0, just in case.  This can be done as follows:<br>
<br>
<code>
<pre>     case WM_SYSCOMMAND:
          if ((wParam <b>&amp; 0xFFF0</b>) == 1)
          {          
               ...
</pre>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Source Code Error</b><br>
<br>

On page 638, Chapter 13, <i>Adding Printing to POPPAD</i>,
in the middle of the page, there is an explanation
regarding when EndDoc() is called:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 638, Chapter 13, <i>Adding Printing to POPPAD</i>
</th>
</tr>
<tr>
<td>
<i>The program breaks from the </i>for<i> loop incrementing the page number if either
</i>StartPage<i> or </i>EndPage<i> returns an error or if </i>bUserAbort<i> is TRUE. If the
return value of the abort procedure is FALSE, </i>EndPage<i> doesn't return an
error. For this reason, </i>bUserAbort<i> is tested explicitly before the next page
is started. If no error is reported, the call to </i>EndDoc<i> is made:</i><br>
<br>
<code>
<pre>if (!bError)
     EndDoc (hdcPrn) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

This does not match the code supplied in the text.
<i>hdcPrn</i> does not exist in the code, anywhere.
The code supplied in the text is as follows, which is correct:<br>

<br>

<code>
<pre>     if (bSuccess)
          EndDoc (<b>pd.hDC</b>) ;
</pre>
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Text Typo</b><br>
<br>

On page 638, Chapter 13, <i>Adding Printing to POPPAD</i>,
the text mentions <i>SetAbortDoc</i> in the first symbol in the flow chart diagram.
I can find no reference to a function of this name anywhere,
except as one of the required printer driver functions,
which are called by Windows GDI that all Windows printers must support.
I think Charles Petzold meant to write <i>SetAbort<b>Proc</b></i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Text Typo</b><br>
<br>

On page 603, Chapter 13, <i>The Printer Device Context</i>,
the word 'job' near the end of the first paragraph should be 'call'.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Source Code Typo</b><br>
<br>

On page 634, Chapter 13, <i>POPPRNT.C</i>,
there is a variable named <i>iNoiColCopy</i>
referenced several times:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 634, Chapter 13, <i>POPPRNT.C</i>
</th>
</tr>
<tr>
<td>
<code>
<pre>...
BOOL PopPrntPrintFile (HINSTANCE hInst, HWND hwnd, HWND hwndEdit, 
                       PTSTR szTitleName)
{
     static DOCINFO  di = { sizeof (DOCINFO) } ;
     static PRINTDLG pd ;
     BOOL            bSuccess ;
     int             yChar, iCharsPerLine, iLinesPerPage, iTotalLines,
                     iTotalPages, iPage, iLine, iLineNum ;
     PTSTR           pstrBuffer ;
     TCHAR           szJobName [64 + MAX_PATH] ;
     TEXTMETRIC      tm ;
     WORD            iColCopy, <b>iNoiColCopy</b> ;     
     ...
</pre>
</code>
</td>
</tr>
<tr>
<th>
Page 636, Chapter 13, <i>POPPRNT.C</i>
</th>
</tr>
<tr>
</tr><tr>
<td>
<code>
<pre>...
if (StartDoc (pd.hDC, &amp;di) &gt; 0)
{
          // Collation requires this loop and <b>iNoiColCopy</b>

     for (iColCopy = 0 ;
          iColCopy &lt; ((WORD) pd.Flags &amp; PD_COLLATE ? pd.nCopies : 1) ;
          iColCopy++)
     {
          for (iPage = 0 ; iPage &lt; iTotalPages ; iPage++)
          {
               for (<b>iNoiColCopy</b> = 0 ;
                    <b>iNoiColCopy</b> &lt; (pd.Flags &amp; PD_COLLATE ? 1 : pd.nCopies);
                    <b>iNoiColCopy</b>++)
               {
                    ...
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

In each of these cases, the variable should be called
<i>iNo<b>n</b>ColCopy</i>,
as mentioned on page 638, in the fourth paragraph.
<i>iColCopy</i> is the variable for collated copies,
and <i>i<b>Non</b>ColCopy</i> is the variable for <b>non</b>-collated copies.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Source Code Bug</b><br>
<br>

On page 604, Chapter 13, <i>GETPRNDC.C</i>,
the function <i>GetPrinterDc()</i> has a bug.
You should first notice the large <i>if-then-else</i> block
that splits the entire function into two separate, but logically identical, sections:
<ul>
<li>one for Windows 98 (<i>Windows 95, Windows 98, Windows Me, or Win32s with Windows 3.1</i>)
</li><li>one for Windows NT (<i>Windows NT 3.51, Windows NT 4.0, Windows 2000 or Windows XP</i>)
</li></ul>
Notice that both code sections exercise the same logic,
but merely use two different structures.
The bug is not caused by the structure use, so the bug is repeated in both code sections.<br>
<br>
In each code section, the function uses the same logic by making two calls to the
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_9fjn.asp">EnumPrinters()</a>
function.
The first call passes 
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_9fjn.asp">EnumPrinters()</a>
a buffer size of 0 in which to store its information,
which causes it to return a value in
<i>dwNeeded</i> that indicates how much memory is required for its buffer.
In the 'Windows 98' section, this will be a multiple of the size of the
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_8gz6.asp">PRINTER_INFO_5</a>
structure.
In the 'Windows NT' section, this will be a multiple of the size of the
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_8vle.asp">PRINTER_INFO_4</a>
structure.
Once this value is known, we can dynamically allocate a block of memory this size,
and then re-call the function with this new memory block.
The second call to 
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_9fjn.asp">EnumPrinters()</a>
passes a buffer size of <i>dwNeeded</i> (<i>the size the first call requested to have</i>),
and the location of this buffer.
This call will fill this memory block with printer information.
The <i>dwReturned</i> will store the number of structures stored in the buffer
(<i>essentially, the number of printers we enumerated</i>).<br>

<br>

So, where is the bug?
The problem appears when there are no printers installed.
The
<a href="http://msdn.microsoft.com/library/en-us/gdi/devcons_5g83.asp">CreateDC()</a>
call will fail when passed a member variable dereferenced from a pointer that
points to a block of memory zero bytes in size.  It will attempt to access memory that
it does not have the right to access.
We know when there are 0 printers,
because <i>dwReturned</i> will return a value of 0,
indicating that there are no structures in the allocated memory block.
We could merely check to see if this is 0,
and set <i>hdc</i> to NULL instead of setting it to the return value of
<a href="http://msdn.microsoft.com/library/en-us/gdi/devcons_5g83.asp">CreateDC()</a>
(<i>we cannot merely quit the function by returning NULL,
as we still have to clean up our allocated memory</i>).
This will cause <i>GetPrinterDC()</i> to return NULL when there are no printers,
which all of the programs that call <i>GetPrinterDC()</i>
(<i>FORMFEED.C, PRINT1.C, PRINT2.C, and PRINT3.C</i>)
handle correctly.<br>

<br>

However, this solution has the ugly side effect that the original
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_9fjn.asp">EnumPrinters()</a>
call would have determined that you would need to allocate 0 bytes of memory
for 0 structures.  Therefore, we can instead check the <i>dwNeeded</i> variable
after the first
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_9fjn.asp">EnumPrinters()</a>
call, and check it against 0.  Although this variable is <i>not</i> the number
of printers available, it is the number of printers available multiplied by the
size of the structure the function wishes to fill.
If the system has 0 available printers, 0 times any structure size equals 0.
So, we can solve the bug easily by adding this line of code
after the <i>first</i>
<a href="http://msdn.microsoft.com/library/en-us/gdi/prntspol_9fjn.asp">EnumPrinters()</a>
call in <i>both</i> code sections:<br>
<br>
<code>
if (dwNeeded == 0) return(NULL); // return NULL if there are no printers.<br>
</code>
<br>
You will notice that we can quit the function immediately, as there are
no memory allocations we need to clean up at this point.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter14"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 14 - Bitmaps and Bitblts</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Text Correction</b><br>
<br>

On page 646, Chapter 14, <i>Real-World Devices</i>,
at the top of the page, it states:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 646, Chapter 14, <i>Real-World Devices</i>
</th>
</tr>
<tr>
<td>
<i>To display 256 colors, the original VGA had to be switched into a 320 by
240 graphics mode, which is an inadequate number of pixels for Windows to
work properly.</i>
</td>
</tr>
</tbody></table>

<br>

However, the original VGA only documented mode 13h, which is a 320 by <b>200</b>, 256
colors, 70 Hz video mode.  The 320 x 240, 256 colors, 60 Hz video mode
is an uncommon, undocumented, tweaked video mode that is normally referred to as Mode-X
(<i>other tweaked video modes are also referred to as Mode-X, as well as
Mode-Y and Mode-Q</i>).

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Source Code Correction</b><br>
<br>

On page 654, Chapter 14, <i>Stretching the Bitmap</i>,
the program STRETCH.C calls <i>StretchBlt()</i> as
follows:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 654, Chapter 14, <i>Stretching the Bitmap</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>          StretchBlt (hdcClient, 0, 0, cxClient, cyClient,
                      hdcWindow, 0, 0, cxSource, cySource, MERGECOPY) ;
</pre>
</code>            
</td>
</tr>
</tbody></table>

<br>

This program is supposed to show off what <i>StretchBlt()</i>
can do before getting into raster-operation codes, as page 657 explains:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 657, Chapter 14, <i>The Raster Operations</i>
</th>
</tr>
<tr>
<td>
<i>The BITBLT and STRETCH programs simply copy the source bitmap to the
destination, perhaps stretching it in the process. This is the result of
specifying SRCCOPY as the last argument to the </i>BitBlt<i> and </i>StretchBlt<i>
functions.</i>
</td>
</tr>
</tbody></table>

<br>

Obviously, the <i>StretchBlt()</i> call in STRETCH.C was supposed to use SRCCOPY as
the last parameter:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 654, Chapter 14, <i>Stretching the Bitmap</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>          StretchBlt (hdcClient, 0, 0, cxClient, cyClient,
                      hdcWindow, 0, 0, cxSource, cySource, <b>SRC</b>COPY) ;
</pre>
</code>            
</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Improper Source Code File on Companion CD</b><br>
<br>

In the source code for <i>Programming Windows, 5th Edition</i>, under the
<i>\Chap14\Bounce</i> directory, there is a BOUNCE.CPP file that is empty (<i>0
bytes</i>).  I know that all of the code is made in C, so there should not be any
.CPP files.  Perhaps this was a file created by mistake, and simply was not
deleted.<br>
<br>
Please note: This erratum is obviously of no
real concern to the reader.
It is only included for completeness, in case
Charles Petzold reviews this page for corrections to the next
version of
<i><a href="http://www.charlespetzold.com/ProgWinEditions.html">Programming Windows</a></i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Source Code Errors</b><br>
<br>

On page 714, Chapter 14, <i>Bitmaps Outside the Window</i>,
the program BLOWUP.C has many bugs all based on the same cause.
They all result from the following messages:
WM_RBUTTONDOWN, WM_MOUSEMOVE, WM_LBUTTONUP and WM_RBUTTONUP:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 717 - 718, Chapter 14, <i>BLOWUP.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_RBUTTONDOWN:
          if (bCapturing)
          {
               bBlocking = TRUE ;
               ptBeg.x = LOWORD (lParam) ;
               ptBeg.y = HIWORD (lParam) ;
               ptEnd = ptBeg ;
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
          }
          return 0 ;

     case WM_MOUSEMOVE:
          if (bBlocking)
          {
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
               ptEnd.x = LOWORD (lParam) ;
               ptEnd.y = HIWORD (lParam) ;
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
          }
          return 0 ;

     case WM_LBUTTONUP:
     case WM_RBUTTONUP:
          if (bBlocking)
          {
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
               ptEnd.x = LOWORD (lParam) ;
               ptEnd.y = HIWORD (lParam) ;

</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

The MSDN with MSVC++ 6.0 incorrectly states
for each of these commands that the following is true:<br>
<br>
<code>
<pre>xPos = LOWORD(lParam);  // horizontal position of cursor
yPos = HIWORD(lParam);  // vertical position of cursor
</pre>
</code>

The program BLOWUP.C assumes that the MSVC++ 6.0 MSDN is correct, and uses these macros.
However, this is faulty, as evident when the program is run, since the
coordinates can be <i>negative</i> for each of these cases.
Both LOWORD and HIWORD return WORD values, which is <code>typedef</code>'ed to
<i>unsigned short</i>.
The
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/mouseinput/mouseinputreference/mouseinputmessages/wm_rbuttondown.asp">online MSDN</a>
fixes the comments, and states that the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/get_x_lparam.asp">GET_X_LPARAM</a>
and
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmacros/get_y_lparam.asp">GET_Y_LPARAM</a>
macros should be used:<br>
<br>
<code>
<pre>xPos = GET_X_LPARAM(lParam);
yPos = GET_Y_LPARAM(lParam);
</pre>
</code>
These two macros are available in the <i>windowsx.h</i> file.
They are defined as follows:<br>
<code>
<pre>#define GET_X_LPARAM(lp)  ((int)(short)LOWORD(lp))
#define GET_Y_LPARAM(lp)  ((int)(short)HIWORD(lp))
</pre>
</code>
Therefore, to correct BLOWUP.C, you must include the <i>windowsx.h</i> file as follows:<br>
<br>
<code>
<pre>#include &lt;windowsx.h&gt;
</pre>
</code>
Or define these macros within the code yourself.
Also, you must fix the three sections of code for the four messages
mentioned above
(<i>WM_RBUTTONDOWN, WM_MOUSEMOVE, WM_LBUTTONUP and WM_RBUTTONUP</i>)
which extract the mouse position from <i>lParam</i>, as follows:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 717 - 718, Chapter 14, <i>BLOWUP.C</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_RBUTTONDOWN:
          if (bCapturing)
          {
               bBlocking = TRUE ;
               ptBeg.x = <b>GET_X_LPARAM(lParam) ;</b>
               ptBeg.y = <b>GET_Y_LPARAM(lParam) ;</b> 
               ptEnd = ptBeg ;
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
          }
          return 0 ;

     case WM_MOUSEMOVE:
          if (bBlocking)
          {
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
               ptEnd.x = <b>GET_X_LPARAM(lParam) ;</b>
               ptEnd.y = <b>GET_Y_LPARAM(lParam) ;</b> 
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
          }
          return 0 ;

     case WM_LBUTTONUP:
     case WM_RBUTTONUP:
          if (bBlocking)
          {
               InvertBlock (hwndScr, hwnd, ptBeg, ptEnd) ;
               ptEnd.x = <b>GET_X_LPARAM(lParam) ;</b> 
               ptEnd.y = <b>GET_Y_LPARAM(lParam) ;</b> 

</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

There is another possibility, without including <i>windowsx.h</i> or defining the
macros, and that is to use the MAKEPOINTS macro to convert the <i>lParam</i>
parameter to a POINTS structure.  This solution is not so great,
as most programs use the POINT structure (<i>without the S at the end</i>),
which means you must convert it before it can be used.
The difference between the two, as defined in <i>WINDEF.H</i>, are as follows:<br>

<br>

<code>
<pre>typedef struct tagPOINT
{
    LONG  x;
    LONG  y;
} POINT;

typedef struct tagPOINTS
{
    SHORT   y;
    SHORT   x;
} POINTS;
</pre>
</code>

I recommended including <i>windowsx.h</i>,
and using the GET_X_LPARAM and GET_Y_LPARAM macros.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Source Code Omission</b><br>
<br>

On page 719, Chapter 14, <i>Bitmaps Outside the Window</i>,
in the BLOWUP.C program, there is a major bug with
the clipboard operations.
For the IDM_EDIT_CUT and IDM_EDIT_COPY cases,
there is a missing <i>CloseClipboard()</i> call.
Please insert it immediately after the <i>SetClipboardData()</i> call
to fix the bug, as follows:<br>
<br>
<code>
CloseClipboard();
</code>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Source Code Omission</b><br>
<br>

On page 657, Chapter 14, <i>The Raster Operations</i>,
there is a missing <i>SelectObject()</i> call within
the <i>DeleteObject()</i> call.
Please change the following statement:<br>
<br>
<code>
DeleteObject (hdcClient, GetStockObject (WHITE_BRUSH)) ;<br>
</code>
<br>
To this statement:<br>
<br>
<code>
DeleteObject <b>(SelectObject</b> (hdcClient, GetStockObject (WHITE_BRUSH))<b>)</b> ;<br>
</code>
<br>
Do not forget the extra closing parenthesis at the end.

<p align="right"><i>Credit: Paul Levijoki</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Typo</b><br>
<br>

On page 707, Chapter 14, <i>Nonrectangular Bitmap Images</i>,
the first sentence on the page states:<br>

<br>

"<i>If you're writing applications specifically for Windows NT, you can use the MaskBlt function to do something similar to the MASKBIT program with fewer function calls.</i>"<br>

<br>

However, the program Charles Petzold is referring to is his <b>BITMASK</b> program.
The code for this program commences on page 702.<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Typo</b><br>
<br>

On page 663, Chapter 14, <i>Creating a DDB</i>,
the following line of code, about two thirds down the page,
is missing a parenthesis:

<code>
<pre>	for iWidthBytes = (cx * cBitsPixel + 15) &amp; -15) &gt;&gt; 3 ;
</pre>
</code>

It should be changed to:

<code>
<pre>	for iWidthBytes = <b>(</b>(cx * cBitsPixel + 15) &amp; -15) &gt;&gt; 3 ;
</pre>
</code>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Typo</b><br>
<br>

On page 664, Chapter 14, <i>Creating a DDB</i>,
the second line of code on the page is missing
an equals sign:<br>

<code>
<pre>hBitMap CreateBitmapIndirect (&amp;Bitmap) ;
</pre>
</code>

It should appear as follows:<br>

<code>
<pre>hBitMap <b>=</b> CreateBitmapIndirect (&amp;Bitmap) ;
</pre>
</code>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>


	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 10: Inconsistent Code</b><br>
<br>

On page 699, Chapter 14, <i>Using Bitmaps in Menus</i>,
the majority of the page and a bit of the next
explains the code in the <i>StretchBitmap</i> function
in the GRAFMENU.C program on page 693.
However, the explanation code is inconsistent
with the program code.<br>

<br>

On page 693, the 
<i>StretchBitmap</i> function
in the GRAFMENU.C program code uses two variables
<i>cxChar</i> and <i>cyChar</i>.
They are initialized with the return values of the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxfunctions/getdialogbaseunits.asp">GetDialogBaseUnits() Function</a>.
This function returns the average width and height of characters in the system font.
You can see these two variables values being used inside a formula to set
<i>bm2.bmWidth</i> and <i>bm2.bmHeight</i>.<br>
<br>
On page 699, 
<i>cxChar</i> and <i>cyChar</i>
are not used.
Instead, a variable called <i>tm</i>
of type
<a href="http://msdn.microsoft.com/library/en-us/gdi/fontext_7ss2.asp">TEXTMETRIC</a>
is initialized with the return value of the
<a href="http://msdn.microsoft.com/library/en-us/gdi/fontext_6rlf.asp">GetTextMetrics function</a>.
This gets the average character width and the height of characters
of the currently selected font of the device context passed to it
(in this case, <i>hdc</i>).
These two values are used in the same formula as
<i>cxChar</i> and <i>cyChar</i>
were.<br>
<br>
So, both code sections are correct.
They are just inconsistent.<br>
<br>

<p align="right"><i>Credit: Hans Dwarshuis and <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 11: Inconsistent Code</b><br>
<br>

On page 700, Chapter 14, <i>Using Bitmaps in Menus</i>,
almost the entire page explains the inner workings
of GRAFMENU.C's <i>CreateMyMenu()</i> function.
You will noticed that the 
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/menus/menureference/menufunctions/appendmenu.asp?frame=true">AppendMenu() Function
</a>
is used 3 times.
In all 3 cases, the 3rd parameter is
<i>hMenuPopup</i>.
In the <i>CreateMyMenu()</i> function,
<i>hMenuPopup</i> is type cast into an <i>int</i>,
but in the code on page 700,
it is not type cast into an <i>int</i>.
This is not an issue, since this book was written
for C.  The C programming language
will cast the parameter to the proper value
implicitly.<br>

<br>

Regarding the issue of type casting, you
should be aware of the
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#cplusplus">C++ typecasting issues</a>
and
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#64bit">64-bit portability issues</a>
elsewhere in this errata list.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis and <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 12: Code Inconsistency</b><br>
<br>

On page 701, Chapter 14, <i>Using Bitmaps in Menus</i>,

the second and fourth lines of code uses the variable
<i>hBitmapHelp</i>.
This portion of the text is covering the code in GRAFMENU.C's
<i>AddHelpToSys()</i> function, on page 692.
This function uses the variable name
<i>hBitmap</i>, without the 'Help' postfix.
Of course, both sections of code are correct.
As long as you use the same variable name throughout,
the code will work.
But, since the text is explaining the program's code,
it should be consistent with it.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis and <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter15"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 15 - The Device-Independent Bitmap</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Typo</b><br>
<br>

On page 735, Chapter 15, <i>DIB Compression</i>,
the sentence before the table states <i>BI_RGB8</i>.
This should be <i>BI_<b>RLE</b>8</i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>

On page 741, Chapter 15, <i>Version 4 Header</i>,
the second to last paragraph mentions <i>BITMAPV5HEADER</i>.
However, this version of the header is not explained until page 744.
It should be <i>BITMAPV<b>4</b>HEADER</i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Typo</b><br>
<br>

On page 742, Chapter 15, <i>The Version 4 Header</i>,
at the bottom, the text refers to the <i>bV4CSType</i> field
of the <i>BITMAPV5HEADER</i> structure.
This should be <i>BITMAPV<b>4</b>HEADER</i>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Changed URL</b><br>
<br>

On page 745, Chapter 15, <i>The Version 5 Header</i>,
the first paragraph mentions that the website of
International Color Consortium
(<i>founded by Adobe, Agfa, Apple, Kodak, Microsoft, Silicon Graphics, Sun Microsystems, and others</i>)
is <a href="http://www.icc.org/"><i>http://www.icc.org</i></a>.
However, this website now belongs to the Internet Chamber of Commerce.
The International Color
Consortium website is now
<a href="http://www.color.org/"><i>http://www.color.org/</i></a>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Updated URL</b><br>
<br>

On page 745, Chapter 15, <i>The Version 5 Header</i>,
the last paragraph shows a URL which is no longer valid:
<a href="http://www.color.org/contrib/sRGB.html"><i>http://www.color.org/contrib/sRGB.html</i></a>.
Information regarding sRGB can be found at the following website:
<a href="http://www.srgb.com/srgb.html"><i>http://www.srgb.com/srgb.html</i></a>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Source Code Comment Error</b><br>
<br>

On page 772, Chapter 15, <i>The Topsy-Turvy World of DIBs</i>,
the first comments in the APOLLO11.C program state:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 772, Chapter 15, <i>APOLLO11.C</i>
</th>
</tr>
<tr>
<td>
<code>
<pre>/*----------------------------------------------
   APOLLO11.C -- Program for screen captures
                 (c) Charles Petzold, 1998
  ----------------------------------------------*/
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

Since this program is not intended for screen captures
(<i>it is for showing how to display DIBs properly</i>),
this comment is in error.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Typo</b><br>
<br>

On page 725, Chapter 15, <i>The OS/2-Style DIB</i>,
the definition of the
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_62uq.asp">BITMAPFILEHEADER</a>
struct refers to the final member as
<i>.bfOffsetBits</i> but its name is actually <i>.bfOffBits</i>.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Source Code Logic Error</b><br>
<br>

On page 747, Chapter 15, <i>DIBHEADS.C</i>,
the source code uses the following function
to append text into an edit control:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 747, Chapter 15, <i>DIBHEADS.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>void Printf (HWND hwnd, TCHAR * szFormat, ...)
{
     TCHAR   szBuffer [1024] ;
     va_list pArgList ;

     va_start (pArgList, szFormat) ;
     wvsprintf (szBuffer, szFormat, pArgList) ;
     va_end (pArgList) ;

     SendMessage (hwnd, EM_SETSEL, (WPARAM) -1, (LPARAM) -1) ;
     SendMessage (hwnd, EM_REPLACESEL, FALSE, (LPARAM) szBuffer) ;
     SendMessage (hwnd, EM_SCROLLCARET, 0, 0) ;
}
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

The logic in the first two <i>SendMessage()</i> calls has a flaw.
An application sends an
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/editcontrols/editcontrolreference/editcontrolmessages/em_setsel.asp">EM_SETSEL Message</a>
to select a range of characters in an edit control.
If start range is –1, any current selection is removed.
The caret is placed at the end of the selection indicated
by the greater of the two range values.<br>
<br>
Therefore, Charles Petzold's code deselects any currently selected text,
in preparation for the EM_REPLACESEL message.
However, he assumed that this means the caret will be placed at the end
of the edit control after any selection is deselected, since
he specified -1 as the ending position, which normally specifies the last character in the edit control.
However, this meaning does <i>not</i> get
translated into meaning the ending position for the caret.
The greater of the two ranges is -1, which is invalid, and is thus, ignored.
The caret remains where it is located.
Therefore, the inserted text is where you last placed the caret.
If you have not moved it, it remains at the end where it should be,
and there appears to be no error.<br>
<br>
The 
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/editcontrols/editcontrolreference/editcontrolmessages/em_replacesel.asp">EM_REPLACESEL Message</a>
replaces the current selection in an edit control with the specified text.
If there is no current selection, the replacement text is inserted at the current location of the caret.
Therefore, the caret must be at the end of the edit control before this is called.
The prior <i>SendMessage()</i> did not take care of this.<br>

<br>

The proper code is as follows:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 747, Chapter 15, <i>DIBHEADS.C</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>void Printf (HWND hwnd, TCHAR * szFormat, ...)
{
     TCHAR   szBuffer [1024] ;
     va_list pArgList ;

     va_start (pArgList, szFormat) ;
     wvsprintf (szBuffer, szFormat, pArgList) ;
     va_end (pArgList) ;

     <b>DWORD nChars = (DWORD)SendMessage( hwnd, WM_GETTEXTLENGTH, 0, 0 ); </b>
     SendMessage( hwnd, EM_SETSEL, <b>(WPARAM)nChars, (LPARAM)nChars</b> ); 
     SendMessage( hwnd, EM_REPLACESEL, FALSE, (LPARAM)szBuffer ); 
     SendMessage( hwnd, EM_SCROLLCARET, 0, 0 );
}
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

The
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmessages/wm_gettextlength.asp">WM_GETTEXTLENGTH Message</a>
determines the length, in characters, of the text associated with the edit control
(<i>alternatively, you could call the
</i><a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/getwindowtextlength.asp">GetWindowTextLength()</a><i>
function, which in turn sends a WM_GETTEXTLENGTH message</i>).
The following <i>SendMessage()</i> command selects one character past the last character of the edit control,
so when EM_REPLACESEL is sent, it replaces this character, which is not a character in the edit control.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a>, based on 
<a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a>'s report</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Typo</b><br>
<br>

On page 817, Chapter 15, <i>The DIB Section</i>,
in the third bullet item the phrase
"<i>during the BitBlt to StretchBlt call</i>"
should be
"<i>during the BitBlt <b>or</b> StretchBlt call</i>".

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 10: Source Code Error</b><br>
<br>

On page 810, Chapter 15, <i>The DIB Section</i>,
the source code at the top of the page shows:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 810, Chapter 15, <i>The DIB Section</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>bmih-&gt;biSize          = sizeof (BITMAPINFOHEADER) ;
bmih-&gt;biWidth         = 384 ;
bmih-&gt;biHeight        = 256 ;
bmih-&gt;biPlanes        = 1 ;
bmih-&gt;biBitCount      = 24 ;
bmih-&gt;biCompression   = BI_RGB ;
bmih-&gt;biSizeImage     = 0 ;
bmih-&gt;biXPelsPerMeter = 0 ;
bmih-&gt;biYPelsPerMeter = 0 ;
bmih-&gt;biClrUsed       = 0 ;
bmih-&gt;biClrImportant  = 0 ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

However, since <i>bmih</i> is defined like so,
at the bottom of page 809:<br>
<br>
<code>
BITMAPINFOHEADER bmih ;<br>
</code>
<br>
It is <i>not</i> a pointer.  Therefore, when you
initialize the fields of the BITMAPINFOHEADER structure,
you cannot use the indirect member access operator (-&gt;).
You must use the direct member access operator (.)
like so:<br>
<br>
<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 810, Chapter 15, <i>The DIB Section</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>bmih<b>.</b>biSize          = sizeof (BITMAPINFOHEADER) ;
bmih<b>.</b>biWidth         = 384 ;
bmih<b>.</b>biHeight        = 256 ;
bmih<b>.</b>biPlanes        = 1 ;
bmih<b>.</b>biBitCount      = 24 ;
bmih<b>.</b>biCompression   = BI_RGB ;
bmih<b>.</b>biSizeImage     = 0 ;
bmih<b>.</b>biXPelsPerMeter = 0 ;
bmih<b>.</b>biYPelsPerMeter = 0 ;
bmih<b>.</b>biClrUsed       = 0 ;
bmih<b>.</b>biClrImportant  = 0 ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 11: Source Code Comment Typo</b><br>
<br>

On page 751, Chapter 15, <i>Displaying DIB Information</i>,
the comment in the middle of the page states:<br>
<br>
"<i>// Display additional BITMAPV4HEADER fields</i>"<br>
<br>
This should state:<br>
<br>
"<i>// Display additional BITMAPV<b>5</b>HEADER fields</i>"<br>
<br>
As, the code is showing data from version 5, not 4.<br>
<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>



	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 12: Source Code Comment Typo</b><br>
<br>

On page 763, Chapter 15, <i>Pixel to Pixel</i>,
in the SHOWDIB1.C program,
the last comment on the page states:<br>
<br>
"<i>// Save the DIB to memory</i>"<br>
<br>
This should be:<br>
<br>
"<i>// Save the DIB <b>to a disk file</b></i>"<br>
<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>



	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 13: Text Typo</b><br>
<br>

On page 809, Chapter 15, <i>The DIB Section</i>,
in the fifth paragraph, it mentions the variable
<i>fColorUse</i> twice.
However, you can see at the bottom of the previous
page that the correct spelling,
to be consistent, is <i>fClrUse</i>.<br>

<br>

<p align="right"><i>Credit: Hans Dwarshuis</i></p>



	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 14: Source Code Robustness</b><br>
<br>

On page 782, Chapter 15, <i>Sequential Display</i>,
in the <i>SEQDISP.C</i> program,
the following line of code attempts to compute the size of the bitmap's pixel data:<br>
<br>
<code>
<pre>iBitsSize = bmfh.bfSize - bmfh.bfOffBits ;
</pre>
</code>

However, as you will note in my
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#adobebmp">errata for the <i>DIBHELP.C</i> program in Chapter 16</a>,
this method of computing the bitmap's pixed data is OK if the .BMP
file is legitimate.  However, if it is produced by a number of versions
of Adobe Photoshop (<i>6.0 / 6.1 / 7.0 known, for sure</i>),
then the method is incorrect.
It will compute a value 2 bytes larger than expected,
because these .BMP files have 2 extra, useless padding bytes at the end.
Please see
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#adobebmp">my errata for the <i>DIBHELP.C</i> program</a>
for full information.<br>
<br>
Please note that in the 
<i>SEQDISP.C</i> program
this variable being a value of 2 larger than expected
will not cause a crash, since it is used only to
allocate memory.  Allocating 2 bytes more memory than
necessary will not cause any problems.<br>
<br>
I would like to credit Hans Dwarshuis
for pointing out that this line of code was identical
to the line of code causing the problem in
<a href="http://jasondoucette.com/books/pw5/pw5errata.html#adobebmp">the <i>DIBHELP.C</i> program</a>,
which provoked me to investigate further.<br>

<br> 

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a>
and Hans Dwarshuis</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 15: Math Error</b><br>
<br>

On page 743, Chapter 15, <i>The Version 4 Header</i>,
at the top of the page,
it explains what the <i>FXPT2DOT30</i> type,
within the
<a href="http://msdn.microsoft.com/library/en-us/icm/icm_9tde.asp">CIEXYZ</a> structure,
represents.
It stores a fixed-point value, where the 2 most significant bits represent
the integer part, and the 30 least significant bits represent
the fractional part.<br>

<br>

Petzold correctly shows that the 32-bit hexadecimal value
0x40000000 represents the value 1.0.
However, the value 0x4800000 represents the value 1.125,
not the value 1.5.<br>

<br>

It may be easier to understand the values by looking at their binary equivalent.
Please note the following values for each bit in the 32-bit 2.30 fixed point
representation:<br>

<br>

0x80000000 = 10.00 0000 0000 0000 0000 0000 0000 0000 = 2 * 2^30 means 2<br>
0x40000000 = 01.00 0000 0000 0000 0000 0000 0000 0000 = 1 * 2^30 means 1<br>
0x20000000 = 00.10 0000 0000 0000 0000 0000 0000 0000 = 1/2 * 2^30 means 1/2<br>
0x10000000 = 00.01 0000 0000 0000 0000 0000 0000 0000 = 1/4 * 2^30 means 1/4<br>
0x08000000 = 00.00 1000 0000 0000 0000 0000 0000 0000 = 1/8 * 2^30 means 1/8<br>
0x04000000 = 00.00 0100 0000 0000 0000 0000 0000 0000 = 1/16 * 2^30 means 1/16<br>
0x02000000 = 00.00 0010 0000 0000 0000 0000 0000 0000 = 1/32 * 2^30 means 1/32<br>
0x01000000 = 00.00 0001 0000 0000 0000 0000 0000 0000 = 1/64 * 2^30 means 1/64<br>

<br>

Thus, 1.5 = 1 + 1/2 = 0x40000000 + 0x20000000 = 0x60000000,<br>
and 1.125 = 1 + 1/8 = 0x40000000 + 0x08000000 = 0x48000000.<br>

<br>

If you have the PowerToy Calculator
(one of Microsoft's 
<a href="http://www.microsoft.com/windowsxp/downloads/powertoys/xppowertoys.mspx">PowerToys</a>),
you can select 'Hexadecimal Output' from the View menu,
and test these values out yourself:<br>

<br>

<img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/fxpt2dot30.png" width="570" height="349">

<br> 

<p align="right"><i>Credit: Dave Mittleider</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter16"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 16 - The Palette Manager</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Windows XP Update</b><br>
<br>

On pages 821 - 995, Chapter 16 deals extensively
with 256 (<i>8 bit</i>) color mode.  On Windows XP,
this mode is not an option under Display Properties.
However, there is a way to make this mode available.<br>

<br>

Compile (do not run) one of the programs from Chapter 16 that
requires a 256 color mode.  (If you attempt to run the program
as-is, the system will report the error:
"<i>This program requires that the video display mode have a 256-color palette.</i>")
I would suggest SYSPAL2.C
on page 843,
as it shows the current system palette, which is
useful to see as you run some of the other programs.
Find the .exe that was created, right click on it
and select Properties.
Go to the Compatibility tab.
Under 'Display settings',
check 'Run in 256 colors' as shown below:<br>

<br>

<a href="http://jasondoucette.com/books/pw5/chap16compatibilitylarge.gif"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chap16compatibilitysmall.gif" width="335" height="117" border="1" alt="&#39;Run in 256 colors&#39; selection - click to enlarge"></a><br>
<br>
Now, run this program, and Windows XP will change
into 256 color mode.<br>

<br>

The problem with this is that Windows XP will only
stay in 256 color mode for the duration of this program.
As soon as you close it, Windows XP will switch back
into the selected color mode in Display Properties.
There is a way to work around this.<br>

<br>

<i>While you have a program running</i> in 256 color mode,
open Display Properties by right clicking on the Desktop
and selecting Properties.  Go to the Settings tab.
You will see that 'Low (8 bit)' mode is an option
under 'Color quality':<br>
<br>
<a href="http://jasondoucette.com/books/pw5/chap16displayprop1large.gif"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chap16displayprop1small.gif" width="184" height="78" border="1" alt="&#39;Low (8 bit)&#39; selection shows while in 8-bit mode - click to enlarge"></a><br>
<br>
You can now shut down the 256 color mode program,
which causes Windows XP to revert back to the old high color display mode,
but this leaves the Display Properties window open,
and the 'Low (8 bit)' selection remains.
However, this is insufficient for our needs,
as the '<u>A</u>pply' button is grayed out:<br>
<br>
<a href="http://jasondoucette.com/books/pw5/chap16displayprop2large.gif"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chap16displayprop2small.gif" width="197" height="186" border="1" alt="&#39;Low (8 bit)&#39; selection still shows when back in high color mode - click to enlarge"></a><br>
<br>
The program does not allow you to click '<u>A</u>pply'
when no selections have been changed,
as resetting the display to what it is already at is a pointless chore.
Since the program is <i>unaware</i> that the display mode
changed behind its back, this selection remains grayed out.
This also means that clicking the 'OK' button will do nothing, as well.
Luckily, there is a way to trick the program.
You will have to select another mode
(<i>just in the selection box, without pressing 'OK' or '<u>A</u>pply'</i>),
then select the 8 bit mode again.
Now you will be able to press 'OK' or '<u>A</u>pply':<br>
<br>
<a href="http://jasondoucette.com/books/pw5/chap16displayprop3large.gif"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chap16displayprop3small.gif" width="197" height="186" border="1" alt="&#39;Apply&#39; option now available - click to enlarge"></a><br>
<br>
Do so, and this will instruct the
operating system to change into the 256 color mode.
You will now be in this mode <i>permanently</i>,
until you change the Display Properties again.
It is evident that Windows XP supports 8 bit
color mode, but is attempting to make it obsolete
by excluding it from the Color quality list.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Text Typo</b><br>
<br>

On page 829, Chapter 16, <i>Displaying Gray Shades</i>,
the first paragraph mentions the GRAYS1 program.
This should be GRAYS<b>2</b>.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Source Code Logic Error</b><br>
<br>

On page 828, Chapter 16, <i>Displaying Gray Shades</i>,
in the GRAYS2.C program, the WM_PAINT code has a logic
error.  This is the original code:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 828, Chapter 16, <i>GRAYS2.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>       // Draw the fountain of grays

  for (i = 0 ; i &lt; 65 ; i++)
  {
       rect.left   = i * cxClient / 64 ;
       rect.top    = 0 ;
       rect.right  = (i + 1) * cxClient / 64 ;
       rect.bottom = cyClient ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

In the last iteration of the <i>for()</i> loop,
<i>i</i> equals 64 (<i>color #65</i>).  The following
two values will be set:<br>
<br>
<code>
<pre>rect.left   = 64 * cxClient / 64 ; 
rect.right  = 65 * cxClient / 64 ;
</pre>
</code>

<i>rect.left</i> will be set to <i>cxClient</i>,
which is the right most edge of the screen.
<i>rect.right</i> will be set to some value greater
than <i>cxClient</i>, off of the right edge of the screen.
Thus, this rectangle is outside of the client area,
and is not seen.<br>
<br>
The two divisors in this loop should be <b>65</b>,
as they are in GRAYS1.C on page 825,
not 64.  The corrected code is below:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 828, Chapter 16, <i>GRAYS2.C</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>       // Draw the fountain of grays

  for (i = 0 ; i &lt; 65 ; i++)
  {
       rect.left   = i * cxClient / <b>65</b> ;
       rect.top    = 0 ;
       rect.right  = (i + 1) * cxClient / <b>65</b> ;
       rect.bottom = cyClient ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

Please note that this same problem occurs
in the GRAYS3.C program
at the bottom of page 834.
(Thanks to Hans Dwarshuis for reminding me.)<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Another Solution</b><br>
<br>

On page 837, Chapter 16, <i>Querying the Palette Support</i>,
the text states in the first paragraph:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 837, Chapter 16, <i>Querying the Palette Support</i>
</th>
</tr>
<tr>
<td>
<i>It is useful for a Windows program to take a look at this color resolution value and behave accordingly.
For example, if the color resolution is 18, it makes no sense 
for a program to attempt to request 128 shades of gray because 
only 64 discrete shades of gray are possible. Requesting 128 shades
of gray will unnecessarily fill the hardware palette table with redundant entries.</i>
</td>
</tr>
</tbody></table>

<br>

However, you can get more than 64 shades if you increment
red, green and blue at separate times,
instead of incrementing them all by one at the same time for each new color.
The problem with this is that the colors are not pure grays,
and the human eye is very good at noticing such flaws.
However, this smoother color palette may be desired.
This same technique is also possible with other colors, as well.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Source Code Error</b><br>
<br>

In source code CD, the following code
in the WM_DISPLAYCHANGE message handler
in SYSPAL3.C is wrong:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
<i>\Chap16\SysPal3\SYSPAL3.C</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_DISPLAYCHANGE:
          if (!CheckDisplay)
               DestroyWindow (hwnd) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

It is missing the sole parameter for the 
<i>CheckDisplay()</i> function.
In the text, it is correct:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 849, Chapter 16, <i>SYSPAL3.C</i> - Correction
</th>
</tr>
<tr>
<td>
<code>
<pre>     case WM_DISPLAYCHANGE:
          if (!CheckDisplay <b>(hwnd)</b>)
               DestroyWindow (hwnd) ;
</pre>
</code>
</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 6: Improved Explanation</b><br>
<br>

The following three programs: ALLCOLOR.C on page 862,
PIPES.C on page 865, and
TUNNEL.C on page 868,
all require the PALANIM.C file on page 851.
Charles Petzold explains on page 851 that PANANIM.C
will contain overhead common to a few palette
animation programs in this chapter,
but FADER.C on page 860 is the only program
(<i>other than the original BOUNCE.C on page
855 that immediately follows PALANIM.C</i>)
which states its specific requirement for PALANIM.C.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 7: Source Code Typo</b><br>
<br>

On page 971, Chapter 16, <i>DIBBLE.RC (excerpts)</i>,
the following code has a typo:<br>
<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 971, Chapter 16, <i>DIBBLE.RC (excerpts)</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>        POPUP "&amp;Uniform Colors"
        BEGIN
            MENUITEM "&amp;1. 2R x 2G x 2B (8)",        IDM_PAL_RGB222
            MENUITEM "&amp;2. 3R x 3G x 3B (27)",       IDM_PAL_RGB333
            MENUITEM "&amp;3. 4R x 4G x 4B (64)",       IDM_PAL_RGB444
            MENUITEM "&amp;4. 5R x 5G x 5B (125)",      IDM_PAL_RGB555
            MENUITEM "&amp;5. 6R x 6G x 6B (216)",      IDM_PAL_RGB666
            MENUITEM "&amp;6. 7R x 7G x 5B (245)",      IDM_PAL_RGB775
            MENUITEM "&amp;7. 7R x 5B x 7B (245)",      IDM_PAL_RGB757
            MENUITEM "&amp;8. 5R x 7G x 7B (245)",      IDM_PAL_RGB577
            MENUITEM "&amp;9. 8R x 8G x 4B (256)",      IDM_PAL_RGB884
            MENUITEM "&amp;A. 8R x 4G x 8B (256)",      IDM_PAL_RGB848
            MENUITEM "&amp;B. 4R x 8G x 8B (256)",      IDM_PAL_RGB488
        END
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

In menu item number 7 the text "7R x 5B x 7B" should be "7R x 5<b>G</b> x 7B",
as shown below:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
Page 971, Chapter 16, <i>DIBBLE.RC (excerpts)</i> - Error
</th>
</tr>
<tr>
<td>
<code>
<pre>        POPUP "&amp;Uniform Colors"
        BEGIN
            MENUITEM "&amp;1. 2R x 2G x 2B (8)",        IDM_PAL_RGB222
            MENUITEM "&amp;2. 3R x 3G x 3B (27)",       IDM_PAL_RGB333
            MENUITEM "&amp;3. 4R x 4G x 4B (64)",       IDM_PAL_RGB444
            MENUITEM "&amp;4. 5R x 5G x 5B (125)",      IDM_PAL_RGB555
            MENUITEM "&amp;5. 6R x 6G x 6B (216)",      IDM_PAL_RGB666
            MENUITEM "&amp;6. 7R x 7G x 5B (245)",      IDM_PAL_RGB775
            MENUITEM "&amp;7. 7R x 5<b>G</b> x 7B (245)",      IDM_PAL_RGB757
            MENUITEM "&amp;8. 5R x 7G x 7B (245)",      IDM_PAL_RGB577
            MENUITEM "&amp;9. 8R x 8G x 4B (256)",      IDM_PAL_RGB884
            MENUITEM "&amp;A. 8R x 4G x 8B (256)",      IDM_PAL_RGB848
            MENUITEM "&amp;B. 4R x 8G x 8B (256)",      IDM_PAL_RGB488
        END
</pre>
</code>
</td>
</tr>
</tbody></table>

<br>

You can change this manually by opening up DIBBLE.RC
in a text editor, making the change, and saving the file.
It is easier to do this from the resource editor, however.
Simple double click the menu item from the resource editor,
and change its caption like so:<br>
<br>

<img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chap16prob7.gif" width="413" height="458" border="1" alt="Resource Editor - DIBBLE.RC - &quot;DIBBLE&quot; Menu">

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 8: Text Typo</b><br>
<br>

On page 831, Chapter 16, <i>The Palette Messages</i>,
the first sentence of the second to last paragraph
refers to QM_QUERYNEWPALETTE.
This should be <b>WM</b>_QUERYNEWPALETTE.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 9: Source Code Typo</b><br>
<br>

On page 876, Chapter 16, <i>Palettes and Packed DIBs</i>,
in the <i>PACKEDIB.C</i> program,
the statement in the <i>PackedDibCreatePalette()</i> function:<br>
<br>
<code>
<pre>plp = malloc (sizeof (LOGPALETTE) *
                    (iNumColors - 1) * sizeof (PALETTEENTRY)) ;
</pre>
</code>
<br>
should be:<br>
<br>
<code>
<pre>plp = malloc (sizeof (LOGPALETTE) <b>+</b>
                    (iNumColors - 1) * sizeof (PALETTEENTRY)) ;
</pre>
</code>
 
<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 10: Source Code Comment Error</b><br>
<br>

On page 911, Chapter 16, <i>Palettes and DIB Sections</i>,
in the <i>SHOWDIB8.C</i> program,
the following source code comment in the WM_COMMAND handling code:<br>
<br>
<code>
// If there's an existing packed DIB, free the memory<br>
</code>
<br>
should be:<br>
<br>
<code>
// If there's an existing <b>bitmap object</b>, free the memory<br></code>
<br>
 
<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 11: Source Code Comment Error</b><br>
<br>

On pages 925 and 926, Chapter 16, <i>The Information Functions</i>,
in the <i>DIBHELP.C (first part)</i> program,
the comments for <i>DibGetColor()</i> and <i>DibSetColor()</i>
are reversed. 
 
<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 12: Major Bug Causing Invalid Page Fault</b><br>
<br>

On page 928, Chapter 16, <i>Reading and Writing Pixels</i>,
in the <i>DIBHELP.C (second part)</i> program, there is an error in the source code
on this line of the <i>DibGetPixel()</i> function:<br>
<br>
<code>
case 24: return 0x00FFFFFF &amp; * (DWORD *) pPixel;<br>
</code>
<br>
The program causes the <i>DIBBLE.C</i> program on page 949
to crash due to an invalid page fault
on certain 24-bit color bitmaps,
particularly when a flip command is followed by another flip command.<br>
<br>
The crash occurs at the end of the final row when
<i>pPixel</i> is only guaranteed to point to
an RGBTRIPLE's worth (<i>3 bytes</i>) of memory in our process's address space.
But this line of code casts <i>pPixel</i> to a DWORD
and then attempts to dereference 4 bytes which is not proper.
The program does not crash on all 24-bit color DIBs because,
depending upon the bitmap's dimensions,
the 4th byte may or may not be within our process's address space.
Recall that each row in the DIB is expanded to be a multiple of 4 bytes,
if it is not already.  In the cases where expansion is needed, we
have some extra junk bytes in our process's address space and therefore
the program does not crash.  
In cases where there is no expansion
(<i>the 3 bytes we wish to address are the last 3 bytes of the DIB</i>),
the next byte may still be within our process's address space simply
because the memory that follows it is used by some other variable / structure owned by our process,
and thus the program will not crash.
This appears to be the case for the first flip command.<br>
<br>
To fix this program, the program should only read 3 bytes from <i>pPixel</i> rather than 4.
The following code type casts <i>pPixel</i> into a pointer to RGBTRIPLE,
so that we only access the 3 bytes of memory that we have to.
It then constructs a DWORD value from the RGBTRIPLE structure,
to be returned:<br>
<br>
<code>
<pre>case 24:
     {
          RGBTRIPLE rgbcolor = * (RGBTRIPLE *) pPixel;
          DWORD dwordcolor = (rgbcolor.rgbtRed   &lt;&lt; 16)
                           + (rgbcolor.rgbtGreen &lt;&lt; 8 )
                           +  rgbcolor.rgbtBlue;
          return dwordcolor ;
     }
</pre>
</code>
<br>
This is not particularly efficient, but it gets the job done,
and shows a possible method to avoid accessing memory that we should not access.
  
<p align="right"><i>Credit: code by
<a href="http://www.jasondoucette.com/">Jason Doucette</a>,
based on 
<a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a>'s report</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 13: Source Code Omission</b><br>
<br>

On page 947, Chapter 16, <i>The DIBHELP Header File and Macros</i>,
in the <i>DIBHELP.H</i> source file,
there is a function declared as follows:<br>
<br>
<code>
HDIB DibCreateFromDdb (HBITMAP hBitmap) ;<br>
</code>
<br>
This apparently was never implemented in <i>DIBHELP.C</i>.
It would have appeared after the <i>DibCopyToDib()</i> function on page 945.
   
<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 14: Source Code Logic Error</b><br>
<br>

On pages 956 and 957, Chapter 16, <i>The DIBBLE Program</i>,
in the <i>DIBBLE.C</i> program
there is a logic error that causes the program to over scroll by 1 pixel
both horizontally and vertically.
The following statement on page 956:<br>
<br>

<code>
si.nMax = DibHeight (hdib); <br>
</code>

<br>
should be: <br>
<br>

<code>
si.nMax = DibHeight (hdib) <b>- 1</b>; <br>
</code>

<br>
The following statement on page 957:<br>
<br>

<code>
si.nMax = DibWidth (hdib); <br>
</code>

<br>
should be:<br>
<br>

<code>
si.nMax = DibWidth (hdib) <b>- 1</b>; <br>
</code>

<br>
This can be observed when you load a bitmap
that is larger than the program's client area size
(<i>shrink the client area size yourself if you do not have a bitmap large enough</i>),
and scroll both scroll bars to their maximum amounts.
A zooming program, such as <a href="http://xona.com/zoomview">ZoomView</a>,
will show a white line (<i>the window's background color</i>)
a pixel thick on the bottom and right edges of the image.
 
<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 15: Source Code Bug - Memory Leak</b><br>
<br>

On page 967, Chapter 16, <i>The DIBBLE Program</i>,
in the <i>DIBBLE.C</i> source file,
in the middle of the page there is a memory leak caused by the statement:<br>
<br>
<code>
hBitmap = DibCopyToDdb (hdib, hwnd, hPalette);<br>
</code>
<br>
Before you assign a new value to <i>hBitmap</i>,
its prior value (<i>recall it is a static variable</i>)
needs to be freed using the
<a href="http://msdn.microsoft.com/library/en-us/gdi/devcons_1vsk.asp"><i>DeleteObject() function</i></a>,
like so:<br>

<br>

<code>
DeleteObject (hBitmap) ;<br>
</code>

<br>

You can see an instance of the correct method
on page 964 in response to the
IDM_EDIT_ROTATE and
IDM_EDIT_FLIP messages.<br>

<br>

On page 968, Chapter 16, <i>The DIBBLE Program</i>,
in the <i>DIBBLE.C</i> source file,
about two-thirds of the way down the page,
a similar memory leak occurs
in an identical line of code.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>	

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<a name="adobebmp"><b>Erratum 16: Source Code Robustness - Potential Buffer Overflow</b></a><br>
<br>

On page 943, Chapter 16, <i>Creating and Converting</i>,
in the <i>DIBHELP.C (third part)</i> source file,
there is an assumption made
in the <i>DibFileLoad()</i> function that is not always correct.
It appears in the following line of code,
which determines the size of a bitmap's pixel data section:<br>
<pre>dwBitsSize = bmfh.bfSize - bmfh.bfOffBits ;
</pre>
<i>bmfh.bfSize</i> is the size of the BMP file in bytes.
<i>bmfh.bfOffBits</i> is the offset to the bitmap pixel data,
from the start of the file, in bytes.
Since the bitmap pixel data is the last structure in a BMP file,
the line of code calculates the size of this structure with the
assumption that all of the information starting at the <i>bmfh.bfOffBits</i>
offset is bitmap pixel data.  After all, there is no structure that follows it,
so this seems like a reasonable assumption - and it is.<br>
<br>
To further explain, I will show a quick review of how BMP files are stored.
They are composed of three or four structures in the following sequence:
<ol>
<li><a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_62uq.asp">BITMAPFILEHEADER structure</a>
</li><li><a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_1rw2.asp">BITMAPINFOHEADER structure</a>
(<i>or <a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_7jaq.asp">BITMAPCOREHEADER structure</a>
for older OS/2-compatible BMP files</i>)
</li><li>The color table / palette information. (<i>For indexed color files only.
24-bit and 32-bit color BMP files are not indexed;
their bitmap pixel data stores the actual RGB color values,
not an index into a color table.</i>)
</li><li>The bitmap pixel data
</li></ol>
For example, in a 24-bit color BMP of size 512 x 512,
the size of the file is 786,486 bytes.  The file itself consists of the following:
<ol>
<li>The BITMAPFILEHEADER is 14 bytes.
</li><li>The BITMAPINFOHEADER is 40 bytes (<i>if this were an OS/2-compatible BMP, this
structure would be the BITMAPCOREHEADER structure, which is 12 bytes</i>).
</li><li>There is no color table, as the color data is stored in the bitmap pixel data itself.
</li><li>The bitmap pixel data needs to store 24-bits (<i>3 bytes</i>) per pixel for 512 rows
and 512 columns of pixels.
Since the size of each row
(<i><a href="http://www.google.com/search?q=512*3%3D">512 * 3 = 1,536</a></i>)
is divisible by 4, there is no extra padding on each row.
There are 512 rows of this size, making a total of 786,432 bytes
(<i><a href="http://www.google.com/search?q=1%2C536*512%3D">1,536 * 512 = 786,432</a></i>).
</li></ol>
<a href="http://www.google.com/search?q=14%2B40%2B786%2C432%3D">14 + 40 + 786,432 = 786,486</a>
bytes; the size of the file.<br>
<br>
Charles Petzold's code makes the assumption that the size of the last field
equals the size of the file minus the size of the fields that precede it
(<i>i.e. the size of the file minus the offset to where this field starts</i>).
This is a valid assumption,
except in the case where a BMP file is created that does not adhere to the
BMP file format definition.  Adobe Photoshop 6.0 / 6.1 / 7.0 is known to create BMP files
that are 2 bytes larger than expected.  These extra bytes are packed on the end
of the file, making Charles Petzold's code think the bitmap pixel data size is
2 bytes larger than expected.  When this size is passed to the
<a href="http://msdn.microsoft.com/library/en-us/fileio/base/readfile.asp"><i>ReadFile()</i> function</a>
immediately following the above line of code:<br>
<pre>bSuccess = ReadFile (hFile, ((PDIBSTRUCT) hDib)-&gt;pBits, 
                     dwBitsSize, &amp;dwBytesRead, NULL);
</pre>
...it attempts to read 2 bytes more than what it knows can fit into allocated memory,
and fails.  It returns a value of 0 into <i>dwBytesRead</i>, indicating
that it did not read a single byte from the file, and returns an extended error code 
(<i>which you must use
<a href="http://msdn.microsoft.com/library/en-us/debug/base/getlasterror.asp">GetLastError()</a>
to retrieve</i>)
of
<a href="http://msdn.microsoft.com/library/en-us/debug/base/system_error_codes__500-999_.asp">ERROR_NOACCESS (<i>998</i>)</a>,
which means, "<i>Invalid access to memory location</i>".<br>

<br>

To correct this problem we will use the BITMAPINFOHEADER information
(<i>or the BITMAPCOREHEADER information for an OS/2 bitmap</i>)
to calculate the bitmap's pixel data size.  The <i>DibFileLoad()</i>
function has a variable
called <i>pbmi</i> which points to a
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_0zn6.asp">BITMAPINFO structure</a>
(<i>when loading an OS/2 bitmap, it actually points to a
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_9yeq.asp">BITMAPCOREINFO structure</a></i>).
The first field of this structure is a BITMAPINFOHEADER structure
(<i>or a BITMAPCOREHEADER structure for an OS/2 bitmap</i>).
The data <i>pbmi</i> points to is used in a call to <i>DibCreateFromInfo()</i>,
and then it is deallocated immediately.  Before it is freed, use the following
code to extract the size of the bitmap pixel data (<i>I use C++ declarations here</i>):
<pre>DWORD RowLength;
if (dwInfoSize == 40)
{
	// handle Windows bitmap
	BITMAPINFOHEADER &amp;bmih = pbmi-&gt;bmiHeader;
	RowLength = ((bmih.biWidth * bmih.biBitCount + 31) &amp; ~31) &gt;&gt; 3 ;
	dwBitsSize = RowLength * bmih.biHeight;
}
else // dwInfoSize == 12
{
	// handle OS/2 bitmap
	BITMAPCOREHEADER &amp;bmch = ((BITMAPCOREINFO*)pbmi)-&gt;bmciHeader;
	RowLength = ((bmch.bcWidth * bmch.bcBitCount + 31) &amp; ~31) &gt;&gt; 3 ;
	dwBitsSize = RowLength * bmch.bcHeight;
}
</pre>
Note that we have two cases: one for Windows bitmaps, and one for OS/2 bitmaps.
The code in each case is conceptually the same, it just refers to two different structures
that <i>pbmi</i> may be pointing to.  Therefore, I will explain both pieces of code at the same time.
The first step is to create a reference to the
BITMAPINFOHEADER (<i>or BITMAPCOREHEADER for an OS/2 bitmap</i>) structure,
so we can access its data more easily than continually dereferencing <i>pbmi</i>.
The <i>RowLength</i> variable computes the length of each row of bitmap pixel data,
using Charles Petzold's formula from the top of page 729,
Chapter 15, <i>The DIB Pixel Bits</i>.
The total bitmap pixel data size is computed by multiplying the size
of each row by the number of rows, and stored into <i>dwBitsSize</i>.
Now, when you attempt to load a BMP file saved from Adobe Photoshop 6.0 / 6.1 / 7.0,
the size will be computed properly, and the program will not attempt to read
2 more bytes than it should.<br>
<br>

If anyone has any information regarding why Adobe Photoshop 6.0 / 6.1 / 7.0
saves BMP files with an extra two junk bytes at the end, or has any information
on other software packages that save BMPs in an improper way, please
contact me at the email address located at the bottom of this page.<br>
<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 17: Better Code</b><br>
<br>

On page 916, Chapter 16, <i>A LIBRARY FOR DIBS</i>,
the text explains that you may want to create your own handle to a bunch of information that
the interface should know nothing about.  Only the implementation will know what this
handle actually is.  On this page, Petzold creates an HDIB handle, defined like so:<br>
<pre>typedef void * HDIB ;
</pre>
All the interface knows is that it is a pointer.  It doesn't know what it points to. 
It actually points to a structure. The implementation knows this,
and will type cast this handle to a pointer to that type, and then proceed
to access its fields.<br>
<br>
What's wrong with all of this?  Nothing, except all handles that are declared in this manner
are <i>all</i> pointers to void.  Thus, they <i>all</i> have the same type.
This means that you could pass a handle to a function expecting another handle, and the compiler
will not complain.  The solution to this mess is to do what the Windows programmers
do.  You can declare a handle using a clever definition DECLARE_HANDLE like so:<br>
<pre>DECLARE_HANDLE (HDIB) ;
</pre>
DECLARE_HANDLE is defined in winnt.h as follows:<br>
<pre>#ifdef STRICT
typedef void *HANDLE;
#define DECLARE_HANDLE(name) struct name##__ { int unused; }; typedef struct name##__ *name
#else
typedef PVOID HANDLE;
#define DECLARE_HANDLE(name) typedef HANDLE name
#endif
</pre>
First of all, you'll notice there are two different possible declarations of DECLARE_HANDLE 
depending on whether
<a href="http://msdn.microsoft.com/library/en-us/sdkintro/sdkintro/strict_type_checking.asp">STRICT</a>
is defined or not.  If it is not defined, you can see that using DECLARE_HANDLE
does nothing more than define the type as a pointer to void:<br>
<pre>typedef PVOID HANDLE;
#define DECLARE_HANDLE(name) typedef HANDLE name
</pre>
This is the same as what we originally had.
When STRICT is defined, however, things are better (and look more complicated):<br>
<pre>typedef void *HANDLE;
#define DECLARE_HANDLE(name) struct name##__ { int unused; }; typedef struct name##__ *name
</pre>
What exactly is the STRICT definition?  Allow me to quote
<a href="http://msdn.microsoft.com/library/en-us/sdkintro/sdkintro/using_strict.asp">MSDN</a>:
"<i>When you define the STRICT symbol, you enable features that require more care in declaring and using types. This helps you write more portable code. This extra care will also reduce your debugging time. Enabling STRICT redefines certain data types so that the compiler does not permit assignment from one type to another without an explicit cast. This is especially helpful with Windows code. Errors in passing data types are reported at compile time instead of causing fatal errors at run time.</i>"<br>
<br>
It is <i>highly recommended</i> that you define STRICT.
Getting back to DECLARE_HANDLE, let's break its definition down.
First, it declares a structure with a unique
name, that has a single field:<br>
<pre>struct name##__ { int unused; };
</pre>
The structure's name will be the name you pass to DECLARE_HANDLE with an additional two underscores
padded on the end.
Then, the handle that you wish to declare is declared as a pointer
to this structure:<br>
<pre>typedef struct name##__ *name
</pre>
Therefore, each handle you declare with DECLARE_HANDLE points to a <i>unique</i>
type.  Thus, you cannot accidentally pass a handle to a function desiring a handle to something else.<br>
<br>
(You will notice that all of this only pertains to C++.
It is not an issue in C, since it does not have type checking.
It allows just about anything to be type cast to anything else,
whether you want to or not.)<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 18: Code Logic Incorrect</b><br>
<br>

On page 936, Chapter 16, <i>Creating and Converting</i>,
in the <i>DIBHELP.C</i> program (third part),
the function <i>DibCreate()</i> has a logic error.<br>
<br>
As explained on page 946, in the second paragraph:<br>
<br>
"DibCreate<i> is probably a more likely function than </i>DibCreateFromInfo<i> to be called from application programs.
The first three arguments provide the pixel width and height and the number of bits per pixel.
The last argument can be set to 0 for a color table of default size
or to a nonzero value to indicate a smaller color table than would otherwise be implied by the bit count.</i>"<br>
<br>
Thus, there are two choices for the <i>cColors</i> parameter.
The default is 0, in which the function will compute the proper color table size.
Any non-zero value states you are specifying the color table size.<br>
<br>
Move on to the code at the top of page 936:<br>

<code>
<pre>     if (cColors != 0)
          cEntries = cColors ;
     else if (cBits &lt;= 8)
          cEntries = 1 &lt;&lt; cBits ;
</pre>
</code>

You will notice that the first section determines a value for <i>cEntries</i>,
which is the color table size (the number of entries in the color table).
The first part of the if-statement correctly takes the non-zero value
for <i>cColors</i>, and sets the color table size to the specification
passed in:<br>

<code>
<pre>     if (cColors != 0)
          cEntries = cColors ;
     ...
</pre>
</code>

The else clause implies what to do when <i>cColors</i> is zero.
In this case it is <i>supposed</i> to set the color table size
to what the bit count implies.  But, <i>all</i> that exists
in the else clause is:<br>

<code>
<pre>     if (cBits &lt;= 8)
          cEntries = 1 &lt;&lt; cBits ;
</pre>
</code>

It checks <i>only</i> those bitmaps that have 8-bits per color or less!
For 16-bit (or larger) color bitmaps, <i>cEntries</i> is not even set!<br>
<br>
The solution is simple.  For 16-bit (or larger) color bitmaps, no color
table exists, thus <i>cEntries</i> should be set to 0.
Fix the entire if-else-statement as follows:<br>

<code>
<pre>     if (cColors != 0)
     {
          // cColors is non-zero, meaning cColors IS the color table size.

          cEntries = cColors ;
     }
     else
     {
          // cColors is zero, meaning the color table size should
          // be set to the size implied by the color bit count.

          if (cBits &lt;= 8)
              cEntries = 1 &lt;&lt; cBits ;
          else
              cEntries = 0 ;
     }
</pre>
</code>

Please note:  We are not done.
Read the next errata for further information about what is wrong
with the following line of code that <i>uses</i> the
<i>cEntries</i> value.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 19: Code Logic Incorrect</b><br>
<br>

On page 936, Chapter 16, <i>Creating and Converting</i>,
in the <i>DIBHELP.C</i> program (third part),
the function <i>DibCreate()</i> has a logic error.<br>
<br>
After the if-statement that sets the <i>cEntries</i>
variable (please see previous errata for information
on how this is computed incorrectly),
it is used to determine the size of a memory allocation
in the following line of code:<br>

<code>
<pre>     dwInfoSize = sizeof (BITMAPINFOHEADER) + (cEntries - 1) * sizeof (RGBQUAD);
</pre>
</code>

The bug is due to the fact that when <i>cEntries</i> is 0,
we store a size into <i>dwInfoSize</i> that is 4 bytes
smaller than the
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_1rw2.asp">BITMAPINFOHEADER structure</a>.
Since the function continues on to fill this structure, we'll overrun the allocated memory.<br>

<br>

Where did this bug come from?
Likely, it is copied from code on page 727, in Chapter 15, where Petzold states:<br>
<br>
"<i>If you need to allocate a structure of PBITMAPCOREINFO for an 8-bit DIB, you can do it like so:<br>
<code>pbmci = malloc (sizeof (BITMAPCOREINFO) + 255 * sizeof (RGBTRIPLE)) ;</code>
</i>"<br>

<br>

But, this code is correct, as he wants a color table sized 256,
and the
<a href="http://windowssdk.msdn.microsoft.com/en-us/library/ms532362.aspx">BITMAPCOREINFO structure</a>
already has one <i>RGBTRIPLE</i> structure, so we need 255 more.  That is, one less than the total number we need.
But, <i>BITMAPCOREINFO</i> is for OS/2 style bitmaps.
If you continue reading Chapter 15 to page 731, you'll see that,
for Windows style bitmaps,
it is the 
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_0zn6.asp">BITMAPINFO structure</a>
we wish to deal with.  And it is the one
that already contains one <i>RGBQUAD</i> structure, <i>not</i> the 
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_1rw2.asp">BITMAPINFOHEADER structure</a>.
Thus the code on page 936 merely uses the wrong structure.<br>

<br>

So, this bug can be fixed by changing the code like so:<br>

<code>
<pre>     dwInfoSize = sizeof (BITMAPINFO) + (cEntries - 1) * sizeof (RGBQUAD);
</pre>
</code>

Some background information, for further reading:<br>

<br>

The
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_0zn6.asp">BITMAPINFO structure</a>
is defined like so:<br>

<code>
<pre>typedef struct tagBITMAPINFO 
{ 
  BITMAPINFOHEADER bmiHeader; 
  RGBQUAD          bmiColors[1]; 
} BITMAPINFO;
</pre>
</code>

You will note that the first field is a 
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_1rw2.asp">BITMAPINFOHEADER structure</a>.<br>

<br>

For regular 16-bit, 24-bit, and 32-bit DIBs, there is no color table required,
and when you call the
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_233i.asp">CreateDIBSection() function</a>,
although it wants a pointer to <i>BITMAPINFO</i> for its second parameter,
it is content with getting a pointer to <i>BITMAPINFOHEADER</i>.
This is the first field of <i>BITMAPINFO</i>, so it is basically a <i>BITMAPINFO</i> without the color table.<br>

<br>

So, because <i>DibCreate()</i> on page 935 is creating a
<i>BITMAPINFO</i> to be passed to the <i>DibCreateFromInfo()</i>
function, which passes it directly into the
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_233i.asp">CreateDIBSection() function</a>,
it is OK if we create our <i>BITMAPINFO</i> with <i>just</i>
the first field.<br>

<br>

Thus, <i>both</i> of the following pieces of code accomplish the same thing,
and fixes the bug:<br>

<code>
<pre>     dwInfoSize = sizeof (BITMAPINFO)       + (cEntries - 1) * sizeof (RGBQUAD);
     dwInfoSize = sizeof (BITMAPINFOHEADER) +  cEntries      * sizeof (RGBQUAD);
</pre>
</code>

Thus, a pointer to just a <i>BITMAPINFOHEADERHEADER</i>
is the same thing as a pointer to a <i>BITMAPINFO</i> structure
without the <i>bmiColors</i> field set.
And, either is good enough to be passed to our <i>DibCreateFromInfo()</i>
function, and to the 
<a href="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_233i.asp">CreateDIBSection() function</a>.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter17"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 17 - Text and Fonts</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Source Code Bug</b><br>
<br>

On page 1012, Chapter 17, <i>The PICKFONT Program</i>, in the <i>PICKFONT.C</i> program,
the first statement on the page is a
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessage.asp">SendMessage()</a>
call.
This is run after the user selects either menu selection from the <i>Device</i> menu.
It is supposed to send a fake message that indicates the 'OK' button was pressed,
which causes the handler of the 'OK' button to be run,
which starts at the bottom of page 1016.
The problem is that the message is not being sent to the proper window.
It should be sent to the button's owner, the dialog box,
not to the main window, which does not own the 'OK' button.<br>
<br>
You can fix the problem by changing the first parameter in the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessage.asp">SendMessage()</a>
call from
<i>hwnd</i> to <i>hdlg</i>, like so:<br>

<br>

<code>
SendMessage (<b>hdlg</b>, WM_COMMAND, IDOK, 0) ;<br>
</code>

<br>

Please note that a similar
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessage.asp">SendMessage()</a>
call exists in the middle of page 1013,
but this one properly sends the message to the proper window.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Typo</b><br>
<br>

On page 1026, Chapter 17, <i>The Logical Font Structure</i>,
the sentence following the one containing this source code:<br>

<br>

<code>
LOGFONT lf ;<br>
</code>

<br>

states:<br>

<br>

"<i>When finish, you call CreateFontIndirect with a pointer to the structure:</i>"<br>

<br>

It should state:<br>

<br>

"<i>When finish<b>ed</b>, you call CreateFontIndirect with a pointer to the structure:</i>"<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Typo</b><br>
<br>

On page 1030, Chapter 17, <i>The Logical Font Structure</i>,
the table on the top of the page mentions the FW_DONTCARE identifier.
However, this identifier is indented for the lfWeight field
of the <a href="http://msdn.microsoft.com/library/en-us/gdi/fontext_1wmq.asp">LOGFONT structure</a>,
as explained on page 1028.
The identifier should be <b>FF_DONTCARE</b> for the lfPitchAndFamily field.<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Typo</b><br>
<br>

On page 1058, Chapter 17, <i>Simple Text Formatting</i>,
the following source code line is in error:<br>

<br>

<code>
TCHAR * szText [] = TEXT ("Hello, how are you?") ;<br>
</code>

<br>

The asterisk (*) should be removed.  Once this is done, you will be declaring the variable
szText as an array of TCHAR.  It will be initialized and sized to the length of the following
string, including the ending NULL character.<br>

<br>

Removing the square brackets [] would also be accepted.  In this case, you are declaring the
variables szText as a pointer to TCHAR.  It will be initialized to point to the string
literal that follows it.<br>

<br>

Including both the asterisk (*) and the square brackets [] indicates that you with to
declare szText as an array of pointer to TCHAR.

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter18"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 18 - Metafiles</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Example Programs Requirements</b><br>
<br>

Some of the example programs in Chapter 18 require files
that are created by earlier programs within the same
chapter, as explained in 
the <code>readme.txt</code> file that accompanies
the text book:<br>

<br>

<table border="1" bgcolor="e0e0e0" cellspacing="0" cellpadding="5">
<tbody><tr>
<th>
\readme.txt
</th>
</tr>
<tr>
<td>
<code>
<pre>Some of the programs in Chapter 18 create files that are used by
other programs in the chapter. Thus, these programs must be run in
a specific order.
</pre>
</code>
</td>
</tr>
</tbody></table>

<p align="right"><i>Credit: <a href="http://www.charlespetzold.com/">Charles Petzold</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="3" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/horiz.gif" height="12"></td>
	</tr>
	
	</tbody></table>

</td>

</tr>
<tr>

<td valign="top" align="center">
<a name="section3"><font size="+1"><b>Section<br>III<br><br>Advanced<br>Topics</b></font></a>
</td>

<td>

	<table border="0" cellpadding="0" cellspacing="0">
	
	<tbody><tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter19"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 19 - The Multiple-Document Interface</b></font></a>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Usability Warning</b><br>
<br>

Take heed to the following note from
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/multipledocumentinterface.asp">MSDN's page on Multiple Document Interface</a>:<br>
<br>
"<i>MDI is an application-oriented model.
Many new and intermediate users find it difficult to learn to use MDI applications.
Therefore, many applications are switching to a document-oriented model.
Therefore, you may want to consider other models for your user interface.
However, you can use MDI for applications which do not easily fit into an
existing model until a more suitable model is introduced.</i>"<br>
<br>

<p align="right"><i>Credit: <a href="http://www.microsoft.com/msdn">Microsoft Developer Network</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Information Source</b><br>
<br>

On page 1195, Chapter 19, <i>The Child Document Windows</i>,
in the last paragraph of the page, it states which messages
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/multipledocumentinterface/multipledocumentinterfacereference/multipledocumentinterfacefunctions/defmdichildproc.asp"><i>DefMDIChildProc</i></a>
should handle, even if your child window procedure does something with them, or not.
This information was acquired from the
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/multipledocumentinterface/multipledocumentinterfacereference/multipledocumentinterfacefunctions/defmdichildproc.asp">MSDN page on the <i>DefMDIChildProc</i> Function</a>,
which also explains <i>DefMDIChildProc</i>'s response to handling each message.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Program Bug</b><br>
<br>

On page 1187, Chapter 19, <i>A SAMPLE MDI IMPLEMENTATION</i>,
in the MDIDEMO.C program,
there is a program bug that can cause a division by zero error,
which will crash the program.
Take a look at the following four assignment statements at the top of the page:<br>
<code>
<pre>xLeft   = rand () % pRectData-&gt;cxClient ;
xRight  = rand () % pRectData-&gt;cxClient ;
yTop    = rand () % pRectData-&gt;cyClient ;
yBottom = rand () % pRectData-&gt;cyClient ;
</pre>
</code>
When the window size is zero, this causes a division by zero
(<i>a modulus operation is actually a division operation in which the
remainder is returned instead of the quotient</i>).<br>
<br>
There is also a less subtle bug that is caused by this code.
Since the boundaries of a rectangle to be drawn are computed
using the window's current size in the modulus operation,
the resultant random coordinates will
never touch the rightmost column or the bottommost row.
This is a result of the fact that the
<a href="http://msdn.microsoft.com/library/en-us/gdi/fillshap_6kth.asp">Rectangle()</a>
function "<i>excludes the bottom and right edges</i>",
as does all of the Windows GDI functions.<br>
<br>
To resolve both of these issues at the same time, change the code to the following:<br>
<code>
<pre>xLeft   = rand () % <b>(</b>pRectData-&gt;cxClient <b>+ 1)</b> ;
xRight  = rand () % <b>(</b>pRectData-&gt;cxClient <b>+ 1)</b> ;
yTop    = rand () % <b>(</b>pRectData-&gt;cyClient <b>+ 1)</b> ;
yBottom = rand () % <b>(</b>pRectData-&gt;cyClient <b>+ 1)</b> ;
</pre>
</code>
This ensures that the random coordinates that are chosen for the rectangle include
the rightmost column and bottommost row, and also avoids any possibility of passing
a zero value into the modulus operation.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter20"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 20 - Multitasking and Multithreading</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Synchronization Errors</b><br>
<br>

On pages 1205 - 1207, Chapter 20, <i>Random Rectangles Revisited</i>,
the RNDRCTMT.C program has a problem with synchronization.
Occasionally, when the user closes the program, the main window
is destroyed, yet the thread drawing the rectangles is still
running.  This causes the following line of code:
<pre>hdc = GetDC (hwnd);
</pre>
to store a device context for the entire screen
(<i>as if </i>GetDC()<i> were passed NULL</i>) into <code>hdc</code>.
Through experimentation
on my Windows XP system, this may cause it to draw the
border of the rectangle before the thread is terminated
(<i>if it gets this far, it does not get a chance to fill
it with the current brush - perhaps because the brush has
been deleted by this point</i>).
This leaves the remnants of the rectangle's border on whatever
window was behind RNDRCTMT.  The border is usually near the upper-left
corner of the entire screen, as the coordinates passed to the
<i>Rectangle()</i> function were in relation to the entire screen,
not the destroyed window's client area.  However, the remnants are
usually deleted in most cases, as the destruction of the main window
of RNDRCTMT causes WM_PAINT messages to be sent to all windows beneath it that
are now visible.  A lot of programs merely repaint their entire window,
erasing the artifact left over.
The best chance to see this artifact is to run the program
over the desktop window only (<i>i.e. let RNDRCTMT be the only window open; minimize all others</i>).
Ensure that the desktop has repainted itself fully
(<i>by waiting for all of the desktop icons to appear</i>)
before closing down RNDRCTMT.  This precaution is necessary
as the program slows down repainting of the desktop after you
have minimized the IDE window of your compiler.  This is to ensure that
Windows will not be in the middle of processing a WM_PAINT message for the
desktop window when you close the application, as this repainting may
paint over the artifact left over upon program termination.
Once this is ensured, close
RNDRCTMT.  It may take a few tries, but you will eventually see the remnants
of an unfinished rectangle - just its border remains.  Since the WM_PAINT message
to the desktop <i>only</i> repaints the area that was covered by RNDRCTMT,
this rectangle border remains in view.<br>
<br>
There is a second problem with synchronization.  This one is easier to detect.
Simply shrink the window down so that its client area size is zero.  The section of the code
that follows may cause an error:
<pre>          if (cxClient != 0 || cyClient != 0)
          {
               xLeft   = rand () % cxClient ;
               xRight  = rand () % cxClient ;
               yTop    = rand () % cyClient ;
               yBottom = rand () % cyClient ;
</pre>
Even though <i>cxClient</i> and <i>cyClient</i> are checked to ensure they are not zero,
because the application is not synchronized properly, these values can change before
they are used in the following four assignment statements.  If they become
zero during the execution of these assignment statements,
the <i>if</i> statement will be too late to catch the problem, and a division by zero
will occur (<i>the modulus operator (%) is a division</i>).  This will crash the program.<br>
<br>
There is a third problem in RNDRCTMT.C.  The fact that the thread function <i>Thread()</i>
never exits is improper.  You are supposed to end a thread started by
<i><a href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt__beginthread.2c_._beginthreadex.asp">_beginthread()</a></i>
by calling 
<i><a href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt__endthread.2c_._endthreadex.asp">_endthread</a></i>
explicitly or
by letting the thread function return (<i>which automatically calls the </i>_endthread()<i> function</i>).
RNDRCTMT does neither.<br>
<br>
I should note that Charles Petzold intended this program to be a simple introduction
to how multithreaded applications work.  It is meant to be a sample program to show
only a few of the necessary components of a multithreaded application.
He later speaks of such problems that exist in these sample applications on page
1226, Chapter 20, <i>Any Problems?</i>  The chapter then goes on to explain how to resolve
such problems.  Therefore, there is not much need to attempt to fix this problem
until the remainder of the chapter has been reviewed.  It was intentional that
the specifics of multithreading was taught incrementally throughout the chapter,
which results in these first sample programs being incomplete.<br>
<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: APIENTRY vs WINAPI Usage Inconsistency</b><br>
<br>

The MULTI1.C program 
(<i>on pages 1209 - 1215, Chapter 20, </i>The Programming Contest Problem<i></i>),
the MULTI2.C program
(<i>on pages 1216 - 1224, Chapter 20, </i>The Multithreading Solution<i></i>), and
the BIGJOB1.C program
(<i>on pages 1230 - 1233, Chapter 20, </i>The BIGJOB1 Program<i></i>)
all use the APIENTRY
calling convention several times
instead of the standard WINAPI
calling convention used throughout the rest of the book.<br>

<br>
However, APIENTRY is defined as WINAPI
in <code>windef.h</code> like so:
<pre>#define APIENTRY    WINAPI
</pre>
It does not matter which one you choose,
as they are the same calling convention.
They are both directly or indirectly defined as
<a href="http://msdn.microsoft.com/library/en-us/vccore98/html/_core___stdcall.asp">__stdcall</a>.
It is the calling convention used to call Win32 API functions.
Please refer to the 
<a href="http://msdn.microsoft.com/library/en-us/vccore98/html/_core___stdcall.asp">MSDN page for __stdcall</a>
to view its implementation.<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Correction</b><br>
<br>

On page 1230, Chapter 20, <i>The BIGJOB1 Program</i>,
the second sentence within the first paragraph mentions
incrementing an integer.  In the actual program, BIGJOB1.C,
the variable that is incremented, <code>A</code>, is of type <code>double</code>,
which is a floating point type.

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Improved Explanation</b><br>
<br>

On page 1241, Chapter 20, <i>THREAD LOCAL STORAGE</i>,
Charles Petzold explains a <i>possibility</i> of how
Thread Local Storage may be implemented with the
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlsalloc.asp">TlsAlloc()</a>,
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlssetvalue.asp">TlsSetValue()</a>,
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlsgetvalue.asp">TlsGetValue(),</a>
and 
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlsfree.asp">TlsFree()</a> 
functions.
His explanation is certainly plausible,
and this 'under the hood' detailing of the 
four Thread Local Storage functions
helps a new user understand their purpose for existing,
and they will find their usage easier as a result.<br>

<br>

However, the explanation is not correct.
The 
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlsalloc.asp">TlsAlloc()</a>
function returns a TLS index.  While this function's
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlsalloc.asp">MSDN page</a>
does not explain exactly what the TLS index is
(<i>Charles thought it may be a pointer to allocated memory</i>),
the 
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlssetvalue.asp">TlsSetValue()</a> 
and 
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/tlsgetvalue.asp">TlsGetValue() MSDN pages</a>
explain a little more.
They both state that they were implemented with speed as the primary goal.
In this regard, the only parameter validation that is performed on each is to ensure
that the TLS index passed in is in the range 0 through
(<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/thread_local_storage.asp">TLS_MINIMUM_AVAILABLE</a>
– 1).  Thus, the TLS indices are not pointers.<br>

<br>

The
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/thread_local_storage.asp">Thread Local Storage</a>
MSDN page explains exactly how the system implements Thread Local Storage.
Please refer to it for further explanation.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 5: Correction</b><br>
<br>

On page 1234, Chapter 20, <i>The BIGJOB1 Program</i>,
the last paragraph mentions a KillThread function.
However, there is no such function.
Charles Petzold must have meant
<a href="http://msdn.microsoft.com/library/en-us/dllproc/base/terminatethread.asp">TerminateThread</a>.<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter21"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 21 - Dynamic-Link Libraries</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Source Code Typo</b><br>
<br>

On page 1249, Chapter 21, <i>The Test Program</i>,
the <i>szAppName[]</i> array is initialized with the value "StrProg" 
which is obviously a cut and paste error indicating that Charles Petzold wrote 
the StrProg program on page 1258 first,
and then modified it to become the EdrTest program on page 1249.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Source Code Error</b><br>
<br>

On page 1253, Chapter 21, <i>Shared Memory in DLLs</i>,
the following definition of the call-back function within the calling program has an error:<br>
<br>
<code>
EXPORT BOOL CALLBACK GetStrCallBack (PSTR pString, PVOID pParam)<br>
</code>
<br>
The <i>EXPORT</i> storage-class attribute should not exist,
as this function is within the calling program, not the DLL.
Therefore, its definition should be as follows:<br>
<br>
<code>
BOOL CALLBACK GetStrCallBack (PSTR pString, PVOID pParam)<br>
</code>
<br>
You will note its actual definition within the <i>STRPROG.C</i> calling program
on page 1260 is proper, as follows:<br>
<br>
<code>
BOOL CALLBACK GetStrCallBack (PTSTR pString, CBPARAM * pcbp)<br>
</code>
<br>

<p align="right"><i>Credit: Ruben Soto</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Logic Error</b><br>
<br>

On page 1257, Chapter 21, <i>Shared Memory in DLLs</i>,
in the STRLIB.C file, the GetStringsA function has a logic error.
The return value from the pfnGetStrCallBack call is checked,
and can cause a return before pAnsiStr is freed.
Therefore, the line of code that frees pAnsiStr should be placed
before the if-statement that checks the value of bReturn,
but after it is used in the pfnGetStrCallBack call.<br>

<br>

<p align="right"><i>Credit: Gary Kato</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Typo</b><br>
<br>

On page 1248, Chapter 21, <i>A Simple DLL</i>,
the third line states,
"<i>EDRLIB.<b>H</b> also includes a function named DllMain, which takes the place of WinMain in a DLL.</i>"
The text should state <i>EDRLIB.<b>C</b></i><br>

<br>

<p align="right"><i>Credit: Walt Mendenhall</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter22"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 22 - Sound and Music</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Source Code Logic Error</b><br>
<br>

On page 1294, Chapter 22, <i>Generating Sine Waves in Software</i>,
in the <i>SINEWAVE.C</i> program,
there is a bug since the call to <i>waveOutUnprepareHeader()</i>
follows the call to <i>waveOutClose()</i>.
After the call to <i>waveOutClose()</i> the hWaveOut is no longer valid 
yet is being used in the call to <i>waveOutUnprepareHeader()</i>.

<p align="right"><i>Credit: <a href="http://www.computersciencelab.com/PetzoldErrata.htm">John Kopplin</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: Source Code Logic Error</b><br>
<br>

On page 1292, Chapter 22, <i>Generating Sine Waves in Software</i>,
in the <i>SINEWAVE.C</i> program,
there are bugs in the handling of the IDC_ONOFF message,
where it allocates memory.  The following code contains the bugs:<br>

<br>

<code>
<pre>pWaveHdr1 = malloc (sizeof (WAVEHDR)) ;
pWaveHdr2 = malloc (sizeof (WAVEHDR)) ;
pBuffer1  = malloc (OUT_BUFFER_SIZE) ;
pBuffer2  = malloc (OUT_BUFFER_SIZE) ;

if (!pWaveHdr1 || !pWaveHdr2 || !pBuffer1 || !pBuffer2)
{
     if (!pWaveHdr1) free (pWaveHdr1) ;
     if (!pWaveHdr2) free (pWaveHdr2) ;
     if (!pBuffer1)  free (pBuffer1) ;
     if (!pBuffer2)  free (pBuffer2) ;
</pre>
</code>

You will notice that when
<a href="http://msdn.microsoft.com/library/en-us/vclib/html/_CRT_malloc.asp">malloc()</a>
fails to allocate the desired memory block, it returns NULL.  NULL is defined as 0.
If it succeeds, it returns an address which is never equivalent to 0.
C / C++ defines <i>false</i> as 0, and any non-zero
integer as <i>true</i>.
Therefore using an address as the expression in an
<a href="http://msdn.microsoft.com/library/en-us/vccelng/htm/statem_9.asp">if statement</a>
will result in the statement that follows it to be executed if
the address actually points to something, like so:<br>

<br>

<code>
<pre>pMemory = malloc (<i>bytestoallocate</i>) ;

if (pMemory)
{
     <i>malloc was successful.</i>
}
else
{
     <i>malloc failed.</i>
}
</pre>
</code>

You will note, in Charles Petzold's code, that he places a
<a href="http://msdn.microsoft.com/library/en-us/vccelng/htm/operator_11.asp">Logical-NOT operator</a> (!)
before the address, which reverses the logic, like so:<br>

<br>

<code>
<pre>pMemory = malloc (<i>bytestoallocate</i>) ;

if (!pMemory)
{
     <i>malloc failed.</i>
}
else
{
     <i>malloc was successful.</i>
}
</pre>
</code>

Therefore, his code actually attempts to deallocate only the
memory that failed to allocate.  We wish to deallocate the memory
that was successfully allocated.  The correct code is as follows;
fixed simply by removing the
<a href="http://msdn.microsoft.com/library/en-us/vccelng/htm/operator_11.asp">Logical-NOT operators</a> (!):<br>

<br>

<code>
<pre>pWaveHdr1 = malloc (sizeof (WAVEHDR)) ;
pWaveHdr2 = malloc (sizeof (WAVEHDR)) ;
pBuffer1  = malloc (OUT_BUFFER_SIZE) ;
pBuffer2  = malloc (OUT_BUFFER_SIZE) ;

if (!pWaveHdr1 || !pWaveHdr2 || !pBuffer1 || !pBuffer2)
{
     if (pWaveHdr1) free (pWaveHdr1) ;
     if (pWaveHdr2) free (pWaveHdr2) ;
     if (pBuffer1)  free (pBuffer1) ;
     if (pBuffer2)  free (pBuffer2) ;
</pre>
</code>

This is a nice example to demonstrate why this is poorly written code,
and what should be done to improve it.
It is common for C / C++
programmers to write code as tightly as possible, and if they can avoid
an explicit check of an address to NULL, they will do so.  What does this accomplish?
It does not make the final code faster, and even if it did, it would be
so negligible that it would not be worth it for this sole reason.
It makes the code much harder to read.  Even once you are used to such code,
it can come back to bite you in the leg because it is hard to read.
The evidence above shows that even highly experienced C programmers
can make this mistake.  In the end, such code serves no other purpose than to
save a few keystrokes which does not make up for all of the potential
problems that come along with it.
I highly recommend the following code, instead:<br>

<br>

<code>
<pre>pWaveHdr1 = malloc (sizeof (WAVEHDR)) ;
pWaveHdr2 = malloc (sizeof (WAVEHDR)) ;
pBuffer1  = malloc (OUT_BUFFER_SIZE) ;
pBuffer2  = malloc (OUT_BUFFER_SIZE) ;

if (!pWaveHdr1 || !pWaveHdr2 || !pBuffer1 || !pBuffer2)
{
     if (pWaveHdr1 <b>!= NULL</b>) free (pWaveHdr1) ;
     if (pWaveHdr2 <b>!= NULL</b>) free (pWaveHdr2) ;
     if (pBuffer1 <b>!= NULL</b>)  free (pBuffer1) ;
     if (pBuffer2 <b>!= NULL</b>)  free (pBuffer2) ;
</pre>
</code>

<p align="right"><i>Credit: Ruben Soto</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Typo</b><br>
<br>

On page 1404, Chapter 22, <i>RIFF File I/O</i>,
the second sentence on the page states:<br>

<br>

"<i>Following the mmioWrite call to write the string szSoftware, a call to mmioAscent using mmckinfo[2] fills in the chunk size field for this chunk.</i>"<br>

<br>

However, it should read:<br>

<br>

"<i>Following the mmioWrite call to write the string szSoftware, a call to
<a href="http://msdn.microsoft.com/library/en-us/multimed/htm/_win32_mmioascend.asp">mmioAscen<b>d</b></a>
using mmckinfo[2] fills in the chunk size field for this chunk.</i>"<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>




	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Improper Subclass Implementation</b><br>
<br>
On page 1336, Chapter 22, in the <i>WAKEUP.C</i> program
the program uses
<a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowprocedures/aboutwindowprocedures.asp">windows subclassing</a>.
However, the code does not remove the subclass when the window terminates.
As explain in
<a href="http://weblogs.asp.net/oldnewthing/archive/2003/11/11/55653.aspx">Raymond Chen's blog</a>:
"<i>One gotcha that isn't explained clearly in the documentation is that
you must remove your window subclass before the window being subclassed is destroyed.</i>"<br>
<br>
Because the code in this program has nothing to clean up, it is technically ok.
However, if the subclass allocated memory or did something else which had to be cleaned up before termination,
then it would be improper.  It is best to explicitly clean up all subclassed windows to ensure proper code.
Note the available functions at your disposal mentioned in Raymond Chen's article,
which are explained on the
<a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/userex/subclassingcontrols.asp">MSDN article, Subclassing Controls</a>.<br>

<br>

The problem also exists on page 385, Chapter 9, in the <i>COLORS1.C</i> program,
and on page 411, Chapter 9, in the <i>HEAD.C</i> program.<br>

<br>

<p align="right"><i>Credit: <a href="http://www.jasondoucette.com/">Jason Doucette</a></i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>

	<tr>
	<td colspan="2" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/chapter.gif" height="64" valign="center">
	<a name="chapter23"><font size="+1"><b>&nbsp;&nbsp;&nbsp;&nbsp;Chapter 23 - A Taste of the Internet</b></font></a>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 1: Source Code Error</b><br>
<br>

On page 1429, Chapter 23, <i>The Update Demo</i>,
in the UPDDEMO.C program
the <i>InternetOpen()</i> call should have a last argument of 0.
Charles Petzold has not implemented a call-back function
so he cannot use asynchronous I/O.<br>
<br>
To correct this error, change the following lines of code from this:<br>
<br>
<code>
<pre>      hIntSession = InternetOpen (szAppName, INTERNET_OPEN_TYPE_PRECONFIG,
                                 NULL, NULL, INTERNET_FLAG_ASYNC) ;
</pre>
</code>
<br>
To these following lines:<br>
<br>
<code>
<pre>     hIntSession = InternetOpen (szAppName, INTERNET_OPEN_TYPE_PRECONFIG,
                                 NULL, NULL, <b>0</b>) ;
</pre>
</code>
 
<p align="right"><i>Credit: Kia Vang</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 2: FTP Site Down</b><br>
<br>

On page 1423, Chapter 23, <i>The Update Demo</i>,
the UPDDEMO.C program attempts to access files in
the directory <i>/ProgWin/UpdDemo</i> on the FTP server
on <i>cpetzold.com</i>:<br>

<br>

<code>
<pre>     // Information for FTP download

#define FTPSERVER TEXT ("<b>ftp.cpetzold.com</b>")
#define DIRECTORY TEXT ("<b>cpetzold.com/ProgWin/UpdDemo</b>")
#define TEMPLATE  TEXT ("UD??????.TXT")
</pre>
</code>

As mentioned in the
<a target="_top" href="http://www.jasondoucette.com/books/pw5/pw5errata.html#chapter-1">About Author</a>
section above, the domain <i>cpetzold.com</i> is no longer up.
The author's new domain is
<i><a href="http://www.charlespetzold.com/">www.charlespetzold.com</a></i>.
There is an FTP server set up on 
<i>charlespetzold.com</i>,
<i><a href="ftp://ftp.charlespetzold.com/">ftp.charlespetzold.com</a></i>,
but there is no
<i>/ProgWin/UpdDemo</i> directory.  The only directories that exist are
those for 
<a href="http://www.charlespetzold.com/ProgWinEditions.html">previous versions of Programming Windows</a>.
Without an appropriate FTP server with the appropriate files, this program
cannot be tested.<br>
<br>
If any one has an FTP server that they can lend for use with this
errata page, please contact me, and let me know.  I can then include
appropriate information here, so readers can change their source code
to test this program.<br>

<br>

<p align="right"><i>Credit: Paul Hornby</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 3: Typo</b><br>
<br>

On page 1418, Chapter 23, <i>The NETTIME Program</i>,
the first sentence in the paragraph starting just below the middle of the page states:<br>

<br>

"<i>NETTIME next calls WSAAsynchSelect, which is another Windows-specific sockets function.</i>"<br>

<br>

However, the function
<a href="http://msdn.microsoft.com/library/en-us/winsock/winsock/wsaasyncselect_2.asp">WSAAsyncSelect</a>,
is misspelled.  It should not have an 'h':<br>

<br>

"<i>NETTIME next calls <b>WSAAsyncSelect</b>, which is another Windows-specific sockets function.</i>"<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td width="60" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/vertical.gif">&nbsp;</td>
	<td>
	<table border="0" cellpadding="10" cellspacing="0" width="100%">
	<tbody><tr>
	<td>
	<b>Erratum 4: Typo</b><br>
<br>

On page 1422, Chapter 23, <i>Overview of the FTP API</i>,
the last sentence on the page states:<br>

<br>

"<i>It incorporates FtpFileOpen, FileCreate, InternetReadFile, WriteFile, InternetCloseHandle, and CloseHandle calls.</i>"<br>

<br>

However, the function FileCreate does not exist.
It should be
<a href="http://msdn.microsoft.com/library/en-us/fileio/base/createfile.asp">CreateFile</a>.<br>

<br>

<p align="right"><i>Credit: Kim Gräsman</i></p>

	</td>
	</tr>
	</tbody></table>
	</td>
	</tr>
	
	<tr>
	<td colspan="3" background="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/horiz.gif" height="12"></td>
	</tr>

	</tbody></table>

</td>

</tr>
</tbody></table>

</td>
</tr>
</tbody></table>

<br>

<center><table width="90%"><tbody><tr><td>
<p>
<b>Submissions:</b><br>
<br>
I am no longer accepting errata submissions, as I have no further time to update this page.
Thank you all for your submissions and attention.  I hope this page has helped.<br>
<br>
<b>History:</b><br>
<br>
I bought <i>Programming Windows, 5th Edition</i> to learn Windows programming, and was quite excited to see that it was
about 1,500 pages, since I knew that meant it would teach it in depth, and with intimate precision, which is how
I love to learn.  I need to know how things work at the lowest level.  This desire for low level workings is what
attracted me to assembly language ever since I first programmed in the 2nd grade, and it also brought my attention
to the 'assembly language' of Windows, the Win32 API -- the low level functions that are handling all that neat GUI stuff
in the background.<br>
<br>
So as I traversed the book with great attention, took everything in, and tested it all to make sure I understood it at
the root level. I extended every example and concept to beyond what the book stated, to make sure all my understandings were solid.
I did not merely want to get something working on the screen.  By doing so, I ran across a number of errors and issues
within the book.
While this list of errors is extensive, many are minor, and I do not believe that I have done anything special. 
Anyone with the proper attention to learn the issues at hand, for real, will arrive at the same conclusions.<br>
<br>
For each issue,
I sent Charles an email.  I didn't expect this, but soon I had sent over 50 of these emails.
I finally
<a href="http://www.jasondoucette.com/books/pw5/pw5errata.html#chapter0">reported a potentially critical issue with a
core construct: the Message Loop</a>.
This is intrinsic to not only every Windows program in the book, but to every Windows program ever made.
As this book is the <i>bible to Windows programming</i>
-- Charles is one of only seven people (and the only author) to receive the
<a href="http://en.wikipedia.org/wiki/Windows_Pioneers">Windows Pioneer Award</a> for his work --
it means a lot of Windows programs were made using it and prior versions.
So this disturbed him, and I was concerned greatly.<br>
<br>
Essentially, the GetMessage() function within the Message Loop
is not checked for errors.  Consider that even several MSDN pages also gave examples that did not check it for errors.
This was in complete contradiction to the GetMessage() page itself, which explicitly states to avoid exactly such code!
The issue is that what is 'left' in the "msg" variable when there is an error is undefined, thus code that doesn't check errors
will translate and dispatch unknown data.
(<a href="http://www.jasondoucette.com/books/pw5/pw5errata.html#chapter0">You can read more about my analysis of what you should do with in my errata.</a>)<br>
<br>
In any case, Charles wrote me back after that doozie, and stated that if I made a public page with my errata, that he would link to my errata page from his, 
<a href="http://www.charlespetzold.com/pw5/">which he did</a>.
He then sent me a copy of his new <a href="http://www.charlespetzold.com/wpf/">Applications = Code + Markup</a> book
signed with a humorous message:<br>
<br>
</p><center>
<a href="http://www.charlespetzold.com/"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/CharlesPetzoldsSignatureToJason.png" width="438" height="163"></a><br>
<table cellspacing="0" cellpadding="0"><tbody><tr><td>
<pre>
TO JASON DOUCETTE,
   THE INDEFATIGABLE CHRONICLER
        OF MY BLUNDERS.
       CHARLES PETZOLD
</pre>
</td></tr></tbody></table>
</center>
<br>
Take care,<br>
<b><i>Jason Doucette</i></b><br>

<br>

<center>
<font size="-2">
<a href="http://www.amazon.com/exec/obidos/ASIN/157231995X/stephenhawkin-20"><img src="./Programming Windows, 5th Edition, Errata Addendum - Jason Doucette_files/pw5cover.jpg" width="125" height="170" alt="Click to purchase Programming Windows, Fifth Edition by Charles Petzold"><br>
Click to Purchase Book<br>
</a>
</font>
</center>

<p></p>
</td></tr></tbody></table></center>

<br>

<center>

<!--
<a href='/index.html' target="_top"><img src="/back.gif" width=19 height=18 border=0> Back to Main Resume Page <img src="/back.gif" width=19 height=18 border=0></a><br>
<br>
-->

<table bgcolor="9C9BB8" cellpadding="2" cellspacing="0" border="0" width="100%">
<tbody><tr>
<td>

	<table bgcolor="E5E5E5" width="100%">
	<tbody><tr>
	<td>

	&nbsp;

	</td>
	</tr>
	</tbody></table>

</td>
</tr>
</tbody></table>

</center>


</font>

<center>

70,668
visitors since July 21<sup>st</sup>, 2003<br>
2,069,293
total page views since May 13<sup>th</sup>, 1999<br>

<center>
<table bgcolor="9C9BB8" cellpadding="2" cellspacing="0" border="0"><tbody><tr><td>
<table bgcolor="E5E5E5"><tbody><tr><td align="center">
<font size="-2" face="arial">
<script language="JavaScript">
<!--
	// get date/time
	D = new Date(document.lastModified);
	yy = D.getYear();
	if (yy <= 9) { yy = "200" + yy }
	else if (yy <= 99) { yy = "20" + yy }
	else if (yy <= 999) { yy = yy + 1900  }
	document.write("Copyright &copy; "+yy);
// -->
</script>Copyright © 2020
<a href="http://www.jasondoucette.com/">Jason Allen Doucette</a> / <a href="http://xona.com/">Xona Games</a>™
</font>
</td></tr></tbody></table>
</td></tr></tbody></table>
</center>

</center>



</body></html>